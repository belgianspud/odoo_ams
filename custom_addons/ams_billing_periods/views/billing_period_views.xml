<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Billing Period Form View -->
    <record id="view_billing_period_form" model="ir.ui.view">
        <field name="name">ams.billing.period.form</field>
        <field name="model">ams.billing.period</field>
        <field name="arch" type="xml">
            <form string="Billing Period">
                <header>
                    <button name="action_set_as_default" type="object" string="Set as Default" 
                            class="oe_highlight" invisible="is_default"/>
                    <button name="toggle_active" type="object" string="Archive" 
                            class="btn-secondary" invisible="not active"/>
                    <button name="toggle_active" type="object" string="Unarchive" 
                            class="btn-secondary" invisible="active"/>
                </header>
                <sheet>
                    <widget name="web_ribbon" title="Default" bg_color="bg-success" invisible="not is_default"/>
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active"/>
                    
                    <div class="oe_title">
                        <div class="oe_edit_only">
                            <label for="name"/>
                        </div>
                        <h1>
                            <field name="name" placeholder="e.g., Monthly Billing"/>
                        </h1>
                        <div class="oe_edit_only">
                            <label for="code"/>
                        </div>
                        <h3>
                            <field name="code" placeholder="e.g., MONTHLY"/>
                        </h3>
                    </div>

                    <group>
                        <group string="Basic Information">
                            <field name="active"/>
                            <field name="is_default"/>
                            <field name="sequence"/>
                        </group>
                        <group string="Duration Configuration">
                            <field name="duration_value"/>
                            <field name="duration_unit"/>
                            <field name="total_days" readonly="1"/>
                            <field name="period_summary" readonly="1"/>
                        </group>
                    </group>
                    
                    <group string="Description">
                        <field name="description" nolabel="1" placeholder="Optional description of this billing period..."/>
                    </group>

                    <notebook>
                        <page string="Period Details" name="details">
                            <div class="oe_form_box_info oe_text_center">
                                <div class="oe_form_field">
                                    <strong>Billing Period Summary:</strong>
                                    <p class="oe_grey">
                                        Duration: <field name="period_summary" readonly="1" nolabel="1"/>
                                        <br/>
                                        Total Days: <field name="total_days" readonly="1" nolabel="1"/>
                                        <span invisible="not is_default"><br/>★ Default Period</span>
                                    </p>
                                </div>
                            </div>
                            
                            <group string="Configuration Details">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fa fa-clock-o mr-2 text-primary"></i>
                                            <span><strong>Duration:</strong> <field name="duration_value" readonly="1" nolabel="1"/> <field name="duration_unit" readonly="1" nolabel="1"/></span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fa fa-calendar mr-2 text-info"></i>
                                            <span><strong>Approximate Days:</strong> <field name="total_days" readonly="1" nolabel="1"/></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center mb-2" invisible="not is_default">
                                            <i class="fa fa-star mr-2 text-warning"></i>
                                            <span>Default Billing Period</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fa fa-sort-numeric-asc mr-2 text-secondary"></i>
                                            <span><strong>Display Order:</strong> <field name="sequence" readonly="1" nolabel="1"/></span>
                                        </div>
                                    </div>
                                </div>
                            </group>
                        </page>
                        <page string="Usage Guidelines" name="guidelines">
                            <div class="alert alert-info">
                                <h5><i class="fa fa-info-circle"></i> Billing Period Guidelines</h5>
                                <ul class="mb-0">
                                    <li><strong>Default Period:</strong> Used for new subscriptions when no specific period is selected</li>
                                    <li><strong>Duration Value:</strong> Numeric component (1, 3, 12, etc.)</li>
                                    <li><strong>Duration Unit:</strong> Time unit (days, weeks, months, years)</li>
                                    <li><strong>Total Days:</strong> Calculated approximate duration for comparison</li>
                                    <li><strong>Sequence:</strong> Controls display order in lists and dropdowns</li>
                                </ul>
                            </div>
                            
                            <div class="alert alert-success">
                                <h5><i class="fa fa-lightbulb-o"></i> Common Billing Periods</h5>
                                <ul class="mb-0">
                                    <li><strong>Monthly:</strong> 1 Month (ideal for subscription services)</li>
                                    <li><strong>Quarterly:</strong> 3 Months (common for membership dues)</li>
                                    <li><strong>Semi-Annual:</strong> 6 Months (moderate commitment)</li>
                                    <li><strong>Annual:</strong> 12 Months (most common for memberships)</li>
                                    <li><strong>Biennial:</strong> 24 Months (longer-term commitments)</li>
                                </ul>
                            </div>
                            
                            <div class="alert alert-warning" invisible="active">
                                <strong>Note:</strong> This billing period is currently archived and cannot be used for new subscriptions.
                            </div>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Billing Period List View -->
    <record id="view_billing_period_list" model="ir.ui.view">
        <field name="name">ams.billing.period.list</field>
        <field name="model">ams.billing.period</field>
        <field name="arch" type="xml">
            <list string="Billing Periods" sample="1" default_order="sequence">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="code"/>
                <field name="duration_value"/>
                <field name="duration_unit"/>
                <field name="period_summary"/>
                <field name="total_days"/>
                <field name="is_default" widget="boolean_toggle"/>
                <field name="active" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- Billing Period Kanban View -->
    <record id="view_billing_period_kanban" model="ir.ui.view">
        <field name="name">ams.billing.period.kanban</field>
        <field name="model">ams.billing.period</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" sample="1" default_order="sequence">
                <field name="name"/>
                <field name="code"/>
                <field name="duration_value"/>
                <field name="duration_unit"/>
                <field name="period_summary"/>
                <field name="total_days"/>
                <field name="is_default"/>
                <field name="active"/>
                <field name="sequence"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click #{!record.active.raw_value ? 'o_kanban_color_10' : ''}">
                            <div class="o_kanban_card_header">
                                <div class="o_kanban_card_header_title">
                                    <div class="o_primary">
                                        <field name="name"/>
                                        <t t-if="record.code.raw_value">
                                            <small class="text-muted"> [<field name="code"/>]</small>
                                        </t>
                                        <t t-if="record.is_default.raw_value">
                                            <span class="badge badge-warning ml-1">★ Default</span>
                                        </t>
                                    </div>
                                    <div class="o_secondary">
                                        <field name="period_summary"/>
                                    </div>
                                </div>
                                <div class="o_kanban_manage_button_section">
                                    <a class="o_kanban_manage_toggle_button" href="#">
                                        <i class="fa fa-ellipsis-v" role="img" aria-label="Manage" title="Manage"/>
                                    </a>
                                </div>
                            </div>
                            <div class="o_kanban_card_content">
                                <div class="o_kanban_card_manage_pane dropdown-menu" role="menu">
                                    <a role="menuitem" type="edit" class="dropdown-item">Edit</a>
                                    <a role="menuitem" name="action_set_as_default" type="object" class="dropdown-item" t-if="!record.is_default.raw_value">Set as Default</a>
                                    <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                </div>
                                <div class="container o_kanban_card_content o_visible">
                                    <div class="row">
                                        <div class="col-8 o_kanban_primary_left">
                                            <div class="mb2">
                                                <i class="fa fa-clock-o text-muted mr-1"></i>
                                                <strong><field name="duration_value"/> <field name="duration_unit"/></strong>
                                            </div>
                                            <div class="mb2">
                                                <i class="fa fa-calendar text-muted mr-1"></i>
                                                <span><field name="total_days"/> days</span>
                                            </div>
                                        </div>
                                        <div class="col-4 o_kanban_primary_right text-right">
                                            <div class="mb2">
                                                <span class="badge badge-secondary">#<field name="sequence"/></span>
                                            </div>
                                            <t t-if="!record.active.raw_value">
                                                <span class="badge badge-pill badge-danger">Archived</span>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Billing Period Search View -->
    <record id="view_billing_period_search" model="ir.ui.view">
        <field name="name">ams.billing.period.search</field>
        <field name="model">ams.billing.period</field>
        <field name="arch" type="xml">
            <search string="Billing Periods">
                <field name="name" string="Period Name" filter_domain="[('name', 'ilike', self)]"/>
                <field name="code" string="Code" filter_domain="[('code', 'ilike', self)]"/>
                <field name="duration_unit" string="Duration Unit"/>
                <field name="period_summary"/>
                
                <!-- Duration Unit Filters -->
                <filter string="Daily" name="daily" domain="[('duration_unit', '=', 'days')]"/>
                <filter string="Weekly" name="weekly" domain="[('duration_unit', '=', 'weeks')]"/>
                <filter string="Monthly" name="monthly" domain="[('duration_unit', '=', 'months')]"/>
                <filter string="Yearly" name="yearly" domain="[('duration_unit', '=', 'years')]"/>
                
                <separator/>
                
                <!-- Common Periods -->
                <filter string="Short Term (≤30 days)" name="short_term" domain="[('total_days', '&lt;=', 30)]"/>
                <filter string="Medium Term (31-180 days)" name="medium_term" domain="[('total_days', '&gt;', 30), ('total_days', '&lt;=', 180)]"/>
                <filter string="Long Term (&gt;180 days)" name="long_term" domain="[('total_days', '&gt;', 180)]"/>
                
                <separator/>
                
                <!-- Status Filters -->
                <filter string="Default Period" name="default" domain="[('is_default', '=', True)]"/>
                <filter string="Active" name="active" domain="[('active', '=', True)]"/>
                <filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>
                
                <group expand="0" string="Group By">
                    <filter string="Duration Unit" name="group_duration_unit" 
                            context="{'group_by': 'duration_unit'}"/>
                    <filter string="Default Status" name="group_default" 
                            context="{'group_by': 'is_default'}"/>
                    <filter string="Status" name="group_active" 
                            context="{'group_by': 'active'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Billing Period Action -->
    <record id="action_billing_period" model="ir.actions.act_window">
        <field name="name">Billing Periods</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">ams.billing.period</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first billing period!
            </p>
            <p>
                Billing periods define the duration for subscription cycles, membership renewals,
                and recurring billing. Set up periods like monthly, quarterly, or annual billing
                to match your association's revenue cycle.
            </p>
            <p>
                <strong>Common examples:</strong> Monthly (1 month), Quarterly (3 months), 
                Annual (12 months), Biennial (24 months)
            </p>
        </field>
    </record>

    <!-- Billing Period Menu -->
    <menuitem id="menu_billing_period"
              name="Billing Periods"
              parent="base.menu_administration"
              action="action_billing_period"
              sequence="15"
              groups="base.group_system"/>
</odoo>