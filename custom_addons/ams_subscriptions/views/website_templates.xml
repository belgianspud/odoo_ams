<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Subscription Shop Page -->
    <template id="subscription_shop" name="Subscription Shop" page="True">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                
                <!-- Hero Section -->
                <section class="s_banner pt96 pb96" data-snippet="s_banner" data-name="Banner" style="background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%);">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-lg-6 pt16 pb16">
                                <h1 class="display-3 text-white mb-3">
                                    Join Our Association
                                </h1>
                                <p class="lead text-white mb-4">
                                    Connect with professionals, access exclusive resources, and advance your career with our membership subscriptions.
                                </p>
                                <a href="#subscriptions" class="btn btn-light btn-lg">
                                    <i class="fa fa-arrow-down"/> Explore Memberships
                                </a>
                            </div>
                            <div class="col-lg-6 pt16 pb16">
                                <div class="text-center">
                                    <i class="fa fa-users fa-8x text-white opacity-75"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Subscription Products Section -->
                <section class="pt64 pb64" id="subscriptions">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 text-center mb-5">
                                <h2 class="display-4 mb-3">Choose Your Membership</h2>
                                <p class="lead text-muted">
                                    Select the subscription that best fits your professional needs and goals.
                                </p>
                            </div>
                        </div>

                        <!-- Subscription Types Filter -->
                        <div class="row mb-4">
                            <div class="col-lg-12">
                                <div class="d-flex justify-content-center">
                                    <div class="btn-group" role="group" aria-label="Subscription filters">
                                        <button type="button" class="btn btn-outline-primary active" data-filter="all">All</button>
                                        <button type="button" class="btn btn-outline-primary" data-filter="membership">Membership</button>
                                        <button type="button" class="btn btn-outline-primary" data-filter="chapter">Chapters</button>
                                        <button type="button" class="btn btn-outline-primary" data-filter="publication">Publications</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Subscription Products Grid -->
                        <div class="row">
                            <t t-foreach="subscription_products" t-as="product">
                                <div class="col-lg-4 col-md-6 mb-4" t-attf-data-category="#{product.subscription_type_id.code}">
                                    <div class="card h-100 shadow-sm subscription-card">
                                        <t t-if="product.website_ribbon_text">
                                            <div class="ribbon-wrapper">
                                                <div class="ribbon bg-primary">
                                                    <span t-esc="product.website_ribbon_text"/>
                                                </div>
                                            </div>
                                        </t>
                                        
                                        <div class="card-header text-center" 
                                             t-attf-style="background: linear-gradient(135deg, #{product.subscription_type_id.marketing_color or '#2E8B57'}, #{product.subscription_type_id.marketing_color or '#3CB371'});">
                                            <h4 class="card-title text-white mb-0">
                                                <span t-field="product.name"/>
                                            </h4>
                                            <p class="text-white-50 mb-0">
                                                <span t-field="product.subscription_type_id.short_description"/>
                                            </p>
                                        </div>

                                        <div class="card-body d-flex flex-column">
                                            <!-- Pricing -->
                                            <div class="text-center mb-4">
                                                <h2 class="display-4 text-primary mb-0">
                                                    <span t-field="product.list_price" 
                                                          t-options="{'widget': 'monetary', 'display_currency': product.currency_id}"/>
                                                </h2>
                                                <small class="text-muted">
                                                    per <span t-field="product.recurring_period"/>
                                                </small>
                                            </div>

                                            <!-- Features -->
                                            <div class="flex-grow-1">
                                                <ul class="list-unstyled">
                                                    <li class="mb-2">
                                                        <i class="fa fa-check text-success me-2"/> Access to member resources
                                                    </li>
                                                    <li class="mb-2">
                                                        <i class="fa fa-check text-success me-2"/> Professional networking
                                                    </li>
                                                    <li class="mb-2" t-if="product.subscription_type_id.code == 'membership'">
                                                        <i class="fa fa-check text-success me-2"/> Chapter participation
                                                    </li>
                                                    <li class="mb-2" t-if="product.subscription_type_id.voting_rights">
                                                        <i class="fa fa-check text-success me-2"/> Voting rights
                                                    </li>
                                                    <li class="mb-2" t-if="product.auto_renewal">
                                                        <i class="fa fa-check text-success me-2"/> Auto-renewal available
                                                    </li>
                                                    <li class="mb-2" t-if="product.subscription_type_id.code == 'publication'">
                                                        <i class="fa fa-check text-success me-2"/> Monthly publications
                                                    </li>
                                                </ul>
                                            </div>

                                            <!-- CTA Button -->
                                            <div class="text-center mt-auto">
                                                <a t-attf-href="/shop/product/#{product.id}" 
                                                   class="btn btn-primary btn-lg">
                                                    <i class="fa fa-shopping-cart"/> Choose This Plan
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Additional Info -->
                                        <div class="card-footer text-center bg-light">
                                            <small class="text-muted">
                                                <t t-if="product.is_recurring">
                                                    <i class="fa fa-refresh"/> Auto-renewable
                                                </t>
                                                <t t-if="product.website_published">
                                                    <i class="fa fa-globe"/> Available online
                                                </t>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>

                        <!-- No products message -->
                        <div class="row" t-if="not subscription_products">
                            <div class="col-lg-12">
                                <div class="alert alert-info text-center" role="alert">
                                    <h4 class="alert-heading">No Subscription Products Available</h4>
                                    <p>We're currently updating our subscription offerings. Please check back soon!</p>
                                    <hr/>
                                    <p class="mb-0">
                                        <a href="/contactus" class="btn btn-primary">Contact Us for Information</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Benefits Section -->
                <section class="pt64 pb64 bg-light">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 text-center mb-5">
                                <h2 class="display-4 mb-3">Member Benefits</h2>
                                <p class="lead text-muted">
                                    Discover what makes our association membership valuable for your career.
                                </p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="text-center">
                                    <div class="mb-3">
                                        <i class="fa fa-users fa-3x text-primary"></i>
                                    </div>
                                    <h4>Professional Networking</h4>
                                    <p class="text-muted">
                                        Connect with industry professionals, join local chapters, and build meaningful relationships.
                                    </p>
                                </div>
                            </div>

                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="text-center">
                                    <div class="mb-3">
                                        <i class="fa fa-graduation-cap fa-3x text-primary"></i>
                                    </div>
                                    <h4>Continuing Education</h4>
                                    <p class="text-muted">
                                        Access workshops, webinars, and professional development programs to advance your skills.
                                    </p>
                                </div>
                            </div>

                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="text-center">
                                    <div class="mb-3">
                                        <i class="fa fa-book fa-3x text-primary"></i>
                                    </div>
                                    <h4>Exclusive Resources</h4>
                                    <p class="text-muted">
                                        Get access to industry publications, research reports, and member-only content.
                                    </p>
                                </div>
                            </div>

                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="text-center">
                                    <div class="mb-3">
                                        <i class="fa fa-calendar fa-3x text-primary"></i>
                                    </div>
                                    <h4>Events &amp; Conferences</h4>
                                    <p class="text-muted">
                                        Attend exclusive member events, conferences, and chapter meetings in your area.
                                    </p>
                                </div>
                            </div>

                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="text-center">
                                    <div class="mb-3">
                                        <i class="fa fa-certificate fa-3x text-primary"></i>
                                    </div>
                                    <h4>Certification Programs</h4>
                                    <p class="text-muted">
                                        Enhance your credentials with our professional certification and credential programs.
                                    </p>
                                </div>
                            </div>

                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="text-center">
                                    <div class="mb-3">
                                        <i class="fa fa-handshake-o fa-3x text-primary"></i>
                                    </div>
                                    <h4>Career Support</h4>
                                    <p class="text-muted">
                                        Access job boards, career counseling, and professional mentorship opportunities.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Chapters Section -->
                <section class="pt64 pb64" t-if="subscription_types.filtered(lambda t: t.code == 'chapter')">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 text-center mb-5">
                                <h2 class="display-4 mb-3">Local Chapters</h2>
                                <p class="lead text-muted">
                                    Connect with professionals in your area through our local chapters.
                                </p>
                            </div>
                        </div>

                        <div class="row">
                            <t t-foreach="request.env['ams.chapter'].sudo().search([('active', '=', True)], limit=6)" t-as="chapter">
                                <div class="col-lg-4 col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">
                                                <span t-field="chapter.name"/>
                                            </h5>
                                            <p class="card-text">
                                                <small class="text-muted">
                                                    <i class="fa fa-map-marker"/> 
                                                    <span t-field="chapter.city"/>, <span t-field="chapter.state_province"/>
                                                </small>
                                            </p>
                                            <p class="card-text">
                                                <span t-field="chapter.short_description"/>
                                            </p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-muted">
                                                    <i class="fa fa-users"/> <span t-field="chapter.active_member_count"/> members
                                                </small>
                                                <t t-if="chapter.chapter_fee > 0">
                                                    <span class="badge badge-success">
                                                        <span t-field="chapter.chapter_fee" 
                                                              t-options="{'widget': 'monetary', 'display_currency': chapter.currency_id}"/>
                                                    </span>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 text-center">
                                <a href="/chapters" class="btn btn-outline-primary btn-lg">
                                    <i class="fa fa-map"/> View All Chapters
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- FAQ Section -->
                <section class="pt64 pb64 bg-light">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 text-center mb-5">
                                <h2 class="display-4 mb-3">Frequently Asked Questions</h2>
                                <p class="lead text-muted">
                                    Get answers to common questions about our membership subscriptions.
                                </p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-8 mx-auto">
                                <div class="accordion" id="subscriptionFAQ">
                                    
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="faq1">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                                                What's included in a membership subscription?
                                            </button>
                                        </h2>
                                        <div id="collapse1" class="accordion-collapse collapse show" data-bs-parent="#subscriptionFAQ">
                                            <div class="accordion-body">
                                                <p>
                                                    Membership subscriptions include access to all association resources, chapter participation,
                                                    professional development programs, industry publications, networking events, and member-only benefits.
                                                    Specific benefits may vary by membership level.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="faq2">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                                                How does auto-renewal work?
                                            </button>
                                        </h2>
                                        <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#subscriptionFAQ">
                                            <div class="accordion-body">
                                                <p>
                                                    Auto-renewal automatically renews your subscription before it expires using your saved payment method.
                                                    You'll receive reminder emails before renewal, and you can disable auto-renewal at any time in your member portal.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="faq3">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                                                Can I join a chapter without a membership?
                                            </button>
                                        </h2>
                                        <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#subscriptionFAQ">
                                            <div class="accordion-body">
                                                <p>
                                                    Chapter membership typically requires an active association membership. However, some chapters may
                                                    offer guest participation or associate memberships. Contact your local chapter for specific requirements.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="faq4">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4">
                                                What happens if I don't renew on time?
                                            </button>
                                        </h2>
                                        <div id="collapse4" class="accordion-collapse collapse" data-bs-parent="#subscriptionFAQ">
                                            <div class="accordion-body">
                                                <p>
                                                    If you don't renew by your expiration date, your membership enters a grace period where you maintain
                                                    access to most benefits. After the grace period, your membership may be suspended and eventually
                                                    terminated if not renewed. Specific timeframes vary by membership type.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="faq5">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse5">
                                                Can I upgrade or downgrade my membership?
                                            </button>
                                        </h2>
                                        <div id="collapse5" class="accordion-collapse collapse" data-bs-parent="#subscriptionFAQ">
                                            <div class="accordion-body">
                                                <p>
                                                    Yes, you can upgrade or change your membership type at any time. Contact our member services team
                                                    or use your member portal to make changes. Prorated billing may apply depending on the timing
                                                    and type of change.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CTA Section -->
                <section class="pt64 pb64" style="background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%);">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8 mx-auto text-center">
                                <h2 class="display-4 text-white mb-3">Ready to Join?</h2>
                                <p class="lead text-white mb-4">
                                    Take the next step in your professional journey. Choose your membership and start connecting with professionals today.
                                </p>
                                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                                    <a href="#subscriptions" class="btn btn-light btn-lg me-md-2">
                                        <i class="fa fa-arrow-up"/> Choose Membership
                                    </a>
                                    <a href="/contactus" class="btn btn-outline-light btn-lg">
                                        <i class="fa fa-envelope"/> Contact Us
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </t>
    </template>

    <!-- Subscription Product Page Enhancement -->
    <template id="subscription_product_details" inherit_id="website_sale.product" priority="20">
        <xpath expr="//div[@id='product_details']" position="inside">
            <t t-if="product.is_subscription_product">
                <div class="alert alert-info mt-3" role="alert">
                    <h5 class="alert-heading">
                        <i class="fa fa-info-circle"/> Subscription Product
                    </h5>
                    <p class="mb-2">
                        This is a <strong><span t-field="product.subscription_type_id.name"/></strong> subscription product.
                    </p>
                    <ul class="mb-0">
                        <li t-if="product.is_recurring">
                            <strong>Billing:</strong> <span t-field="product.recurring_period"/>
                        </li>
                        <li t-if="product.auto_renewal">
                            <strong>Auto-renewal:</strong> Enabled by default
                        </li>
                        <li t-if="product.subscription_type_id.grace_period_days">
                            <strong>Grace period:</strong> <span t-field="product.subscription_type_id.grace_period_days"/> days
                        </li>
                    </ul>
                </div>
            </t>
        </xpath>
    </template>

    <!-- Chapter Directory Page -->
    <template id="chapter_directory" name="Chapter Directory" page="True">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <section class="pt64 pb64">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 text-center mb-5">
                                <h1 class="display-4 mb-3">Chapter Directory</h1>
                                <p class="lead text-muted">
                                    Find and connect with local chapters in your area.
                                </p>
                            </div>
                        </div>

                        <!-- Search and Filter -->
                        <div class="row mb-4">
                            <div class="col-lg-6 mx-auto">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Search by city, state, or chapter name" id="chapterSearch"/>
                                    <button class="btn btn-primary" type="button">
                                        <i class="fa fa-search"/>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Chapters Grid -->
                        <div class="row" id="chaptersGrid">
                            <t t-foreach="request.env['ams.chapter'].sudo().search([('active', '=', True)])" t-as="chapter">
                                <div class="col-lg-4 col-md-6 mb-4 chapter-card" 
                                     t-attf-data-search="#{chapter.name} #{chapter.city} #{chapter.state_province} #{chapter.region}">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">
                                                <span t-field="chapter.name"/>
                                            </h5>
                                            <p class="card-text">
                                                <small class="text-muted">
                                                    <i class="fa fa-map-marker"/> 
                                                    <span t-field="chapter.city"/>, <span t-field="chapter.state_province"/>
                                                    <br/>
                                                    <i class="fa fa-globe"/> <span t-field="chapter.region"/>
                                                </small>
                                            </p>
                                            <p class="card-text">
                                                <span t-field="chapter.description" t-options="{'widget': 'text', 'max_length': 150}"/>
                                            </p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-muted">
                                                    <i class="fa fa-users"/> <span t-field="chapter.active_member_count"/> members
                                                </small>
                                                <t t-if="chapter.chapter_fee > 0">
                                                    <span class="badge badge-success">
                                                        <span t-field="chapter.chapter_fee" 
                                                              t-options="{'widget': 'monetary', 'display_currency': chapter.currency_id}"/>
                                                    </span>
                                                </t>
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                                                <a t-if="chapter.email" t-attf-href="mailto:#{chapter.email}" 
                                                   class="btn btn-sm btn-outline-primary">
                                                    <i class="fa fa-envelope"/> Contact
                                                </a>
                                                <a t-if="chapter.website" t-att-href="chapter.website" 
                                                   class="btn btn-sm btn-outline-info" target="_blank">
                                                    <i class="fa fa-external-link"/> Website
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>

                        <!-- No chapters message -->
                        <div class="row" id="noChaptersMessage" style="display: none;">
                            <div class="col-lg-12">
                                <div class="alert alert-info text-center" role="alert">
                                    <h4 class="alert-heading">No Chapters Found</h4>
                                    <p>No chapters match your search criteria.</p>
                                    <hr/>
                                    <p class="mb-0">
                                        <button class="btn btn-primary" onclick="clearChapterSearch()">
                                            Clear Search
                                        </button>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Chapter Search JavaScript -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const searchInput = document.getElementById('chapterSearch');
                    const chapterCards = document.querySelectorAll('.chapter-card');
                    const noChaptersMessage = document.getElementById('noChaptersMessage');

                    function filterChapters() {
                        const searchTerm = searchInput.value.toLowerCase();
                        let visibleCount = 0;

                        chapterCards.forEach(function(card) {
                            const searchData = card.getAttribute('data-search').toLowerCase();
                            if (searchData.includes(searchTerm)) {
                                card.style.display = 'block';
                                visibleCount++;
                            } else {
                                card.style.display = 'none';
                            }
                        });

                        noChaptersMessage.style.display = visibleCount === 0 ? 'block' : 'none';
                    }

                    searchInput.addEventListener('input', filterChapters);
                    
                    // Search button click
                    document.querySelector('.btn[type="button"]').addEventListener('click', filterChapters);
                });

                function clearChapterSearch() {
                    document.getElementById('chapterSearch').value = '';
                    document.querySelectorAll('.chapter-card').forEach(function(card) {
                        card.style.display = 'block';
                    });
                    document.getElementById('noChaptersMessage').style.display = 'none';
                }
            </script>
        </t>
    </template>

    <!-- CSS for Subscription Shop -->
    <template id="subscription_shop_assets" inherit_id="website.assets_frontend">
        <xpath expr="." position="inside">
            <style>
                .subscription-card {
                    transition: transform 0.2s, box-shadow 0.2s;
                }
                
                .subscription-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
                }
                
                .ribbon-wrapper {
                    position: absolute;
                    top: -3px;
                    right: -3px;
                    z-index: 10;
                    overflow: hidden;
                    width: 85px;
                    height: 85px;
                }
                
                .ribbon {
                    position: absolute;
                    top: 17px;
                    right: -25px;
                    width: 120px;
                    text-align: center;
                    font-size: 12px;
                    font-weight: bold;
                    color: white;
                    transform: rotate(45deg);
                    padding: 2px 0;
                }
                
                .chapter-card {
                    transition: opacity 0.3s ease;
                }
                
                @media (max-width: 768px) {
                    .display-3 {
                        font-size: 2.5rem;
                    }
                    
                    .display-4 {
                        font-size: 2rem;
                    }
                }
            </style>
        </xpath>
    </template>

</odoo>