<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Main Membership Menu -->
    <menuitem id="menu_membership_root" 
              name="Membership" 
              sequence="60"/>
    
    <!-- Membership Management Section -->
    <menuitem id="menu_membership_management" 
              name="Management" 
              parent="menu_membership_root" 
              sequence="10"/>
    
    <!-- Memberships Menu Items -->
    <menuitem id="menu_membership_memberships" 
              name="Memberships" 
              parent="menu_membership_management" 
              action="action_membership_membership" 
              sequence="10"/>
    
    <menuitem id="menu_membership_active" 
              name="Active Memberships" 
              parent="menu_membership_management" 
              action="action_membership_active" 
              sequence="20"/>
    
    <menuitem id="menu_membership_expiring" 
              name="Expiring Soon" 
              parent="menu_membership_management" 
              action="action_membership_expiring" 
              sequence="30"/>
    
    <!-- Members Section -->
    <menuitem id="menu_membership_members" 
              name="Members" 
              parent="menu_membership_root" 
              sequence="20"/>
    
    <menuitem id="menu_membership_all_members" 
              name="All Members" 
              parent="menu_membership_members" 
              action="action_res_partner_members" 
              sequence="10"/>
    
    <menuitem id="menu_membership_active_members" 
              name="Active Members" 
              parent="menu_membership_members" 
              action="action_res_partner_active_members" 
              sequence="20"/>
    
    <menuitem id="menu_membership_expiring_members" 
              name="Expiring Members" 
              parent="menu_membership_members" 
              action="action_res_partner_expiring_members" 
              sequence="30"/>
    
    <!-- Configuration Section -->
    <menuitem id="menu_membership_configuration" 
              name="Configuration" 
              parent="menu_membership_root" 
              sequence="90"
              groups="membership_core.group_membership_manager"/>
    
    <menuitem id="menu_membership_types" 
              name="Membership Types" 
              parent="menu_membership_configuration" 
              action="action_membership_type" 
              sequence="10"
              groups="membership_core.group_membership_manager"/>
    
    <!-- Reports Section -->
    <menuitem id="menu_membership_reports" 
              name="Reports" 
              parent="menu_membership_root" 
              sequence="80"/>
    
    <menuitem id="menu_membership_analytics" 
              name="Membership Analytics" 
              parent="menu_membership_reports" 
              action="action_membership_analytics_report" 
              sequence="10"/>
    
    <menuitem id="menu_membership_revenue_report" 
              name="Revenue Report" 
              parent="menu_membership_reports" 
              action="action_membership_revenue_report" 
              sequence="20"/>
    
    <!-- Quick Actions in Management -->
    <menuitem id="menu_membership_create" 
              name="Create Membership" 
              parent="menu_membership_management" 
              action="action_membership_create_wizard" 
              sequence="40"
              groups="membership_core.group_membership_user"/>
    
    <!-- Dashboard/Overview -->
    <menuitem id="menu_membership_dashboard" 
              name="Dashboard" 
              parent="menu_membership_root" 
              action="action_membership_dashboard"
              sequence="5"/>

    <!-- Action Definitions -->
    
    <!-- Dashboard Action -->
    <record id="action_membership_dashboard" model="ir.actions.act_window">
        <field name="name">Membership Dashboard</field>
        <field name="res_model">membership.membership</field>
        <field name="view_mode">kanban,graph,pivot</field>
        <field name="context">{
            'search_default_active': 1,
            'search_default_group_by_type': 1,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Welcome to the Membership Dashboard!
            </p>
            <p>
                This dashboard provides an overview of your membership data including
                active memberships, revenue trends, and membership analytics.
            </p>
        </field>
    </record>
    
    <!-- Analytics Report Action -->
    <record id="action_membership_analytics_report" model="ir.actions.act_window">
        <field name="name">Membership Analytics</field>
        <field name="res_model">membership.membership</field>
        <field name="view_mode">pivot,graph,tree</field>
        <field name="context">{
            'search_default_group_by_type': 1,
            'search_default_group_by_state': 1,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No membership data to analyze yet!
            </p>
            <p>
                This view provides analytical insights into your membership data
                including trends, revenue analysis, and member statistics.
            </p>
        </field>
    </record>
    
    <!-- Revenue Report Action -->
    <record id="action_membership_revenue_report" model="ir.actions.act_window">
        <field name="name">Membership Revenue Report</field>
        <field name="res_model">membership.membership</field>
        <field name="view_mode">pivot,graph,tree</field>
        <field name="domain">[]</field>
        <field name="context">{
            'search_default_group_by_type': 1,
            'search_default_group_by_start_date': 1,
            'pivot_measures': ['amount_paid'],
            'pivot_column_groupby': ['start_date:month'],
            'pivot_row_groupby': ['membership_type_id'],
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No revenue data to display yet!
            </p>
            <p>
                This report shows membership revenue broken down by type, time period,
                and other dimensions to help you understand your membership income.
            </p>
        </field>
    </record>

    <!-- Members-only View Action -->
    <record id="action_res_partner_members" model="ir.actions.act_window">
        <field name="name">Members</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('is_member', '=', True)]</field>
        <field name="context">{
            'search_default_active_members': 1,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No members found!
            </p>
            <p>
                This view shows all partners who have active memberships with your organization.
                Members are automatically identified when they have active or grace period memberships.
            </p>
        </field>
    </record>
    
    <!-- Active Members View Action -->
    <record id="action_res_partner_active_members" model="ir.actions.act_window">
        <field name="name">Active Members</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('membership_state', '=', 'active')]</field>
        <field name="context">{
            'search_default_group_membership_type': 1,
        }</field>
    </record>
    
    <!-- Expiring Members View Action -->
    <record id="action_res_partner_expiring_members" model="ir.actions.act_window">
        <field name="name">Expiring Members</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('membership_expiry_date', '&lt;=', (context_today() + datetime.timedelta(days=30)).strftime('%Y-%m-%d')), ('membership_expiry_date', '&gt;=', context_today().strftime('%Y-%m-%d')), ('membership_state', 'in', ['active', 'grace'])]</field>
        <field name="context">{
            'search_default_group_by_membership_expiry_date': 1,
        }</field>
    </record>
    
    <!-- Action for Create Membership Wizard -->
    <record id="action_membership_create_wizard" model="ir.actions.act_window">
        <field name="name">Create Membership</field>
        <field name="res_model">membership.create.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_partner_id': active_id,
        }</field>
    </record>

</odoo>