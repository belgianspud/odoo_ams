<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Member Specialty Tree View -->
    <record id="view_member_specialty_tree" model="ir.ui.view">
        <field name="name">ams.member.specialty.tree</field>
        <field name="model">ams.member.specialty</field>
        <field name="arch" type="xml">
            <tree string="Member Specialties" default_order="sequence,name">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="code"/>
                <field name="specialty_type"/>
                <field name="parent_specialty_id"/>
                <field name="requires_certification" widget="boolean_toggle"/>
                <field name="has_continuing_education" widget="boolean_toggle"/>
                <field name="member_count"/>
                <field name="active" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>

    <!-- Member Specialty Form View -->
    <record id="view_member_specialty_form" model="ir.ui.view">
        <field name="name">ams.member.specialty.form</field>
        <field name="model">ams.member.specialty</field>
        <field name="arch" type="xml">
            <form string="Member Specialty">
                <header>
                    <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="%(action_member_specialty_line_by_specialty)d" 
                                type="action" 
                                class="oe_stat_button" 
                                icon="fa-users"
                                context="{'default_specialty_id': active_id}">
                            <field name="member_count" widget="statinfo" string="Members"/>
                        </button>
                    </div>
                    
                    <div class="oe_title">
                        <label for="name"/>
                        <h1><field name="name" placeholder="e.g., Cardiology"/></h1>
                        <label for="code"/>
                        <h2><field name="code" placeholder="e.g., CARD"/></h2>
                    </div>

                    <group>
                        <group name="basic_info">
                            <field name="specialty_type"/>
                            <field name="parent_specialty_id" options="{'no_create': True}" domain="[('id', '!=', active_id)]"/>
                            <field name="specialty_category"/>
                            <field name="sequence"/>
                        </group>
                        <group name="certification_info">
                            <field name="requires_certification"/>
                            <field name="certification_body" attrs="{'invisible': [('requires_certification', '=', False)]}"/>
                            <field name="board_certification_available"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Requirements" name="requirements">
                            <group>
                                <group name="training_requirements">
                                    <field name="requires_training"/>
                                    <field name="training_requirements" 
                                           attrs="{'invisible': [('requires_training', '=', False)]}"
                                           nolabel="1"/>
                                </group>
                                <group name="ce_requirements">
                                    <field name="has_continuing_education"/>
                                    <field name="ce_hours_annual" 
                                           attrs="{'invisible': [('has_continuing_education', '=', False)], 'required': [('has_continuing_education', '=', True)]}"/>
                                </group>
                            </group>
                        </page>

                        <page string="Description &amp; Notes" name="description">
                            <group>
                                <field name="description" nolabel="1" placeholder="Detailed description of this specialty area..."/>
                            </group>
                            <separator string="Internal Notes"/>
                            <group>
                                <field name="notes" nolabel="1" placeholder="Internal notes about this specialty..."/>
                            </group>
                        </page>

                        <page string="Sub-Specialties" name="children">
                            <field name="child_specialty_ids" readonly="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="code"/>
                                    <field name="specialty_type"/>
                                    <field name="requires_certification"/>
                                    <field name="member_count"/>
                                    <field name="active"/>
                                </tree>
                            </field>
                        </page>

                        <page string="Members" name="members">
                            <field name="member_specialty_ids" readonly="1">
                                <tree>
                                    <field name="partner_id"/>
                                    <field name="is_primary"/>
                                    <field name="proficiency_level"/>
                                    <field name="date_acquired"/>
                                    <field name="years_experience"/>
                                    <field name="is_certified"/>
                                    <field name="status"/>
                                    <field name="active"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Member Specialty Search View -->
    <record id="view_member_specialty_search" model="ir.ui.view">
        <field name="name">ams.member.specialty.search</field>
        <field name="model">ams.member.specialty</field>
        <field name="arch" type="xml">
            <search string="Member Specialties">
                <field name="name" string="Specialty" filter_domain="['|', ('name', 'ilike', self), ('code', 'ilike', self)]"/>
                <field name="code"/>
                <field name="specialty_type"/>
                <field name="specialty_category"/>
                <field name="parent_specialty_id"/>
                <field name="certification_body"/>
                
                <filter string="Active" name="active" domain="[('active', '=', True)]"/>
                <filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>
                <separator/>
                <filter string="Clinical" name="clinical" domain="[('specialty_type', '=', 'clinical')]"/>
                <filter string="Technical" name="technical" domain="[('specialty_type', '=', 'technical')]"/>
                <filter string="Administrative" name="administrative" domain="[('specialty_type', '=', 'administrative')]"/>
                <filter string="Research" name="research" domain="[('specialty_type', '=', 'research')]"/>
                <separator/>
                <filter string="Requires Certification" name="requires_certification" domain="[('requires_certification', '=', True)]"/>
                <filter string="Board Certification Available" name="board_cert_available" domain="[('board_certification_available', '=', True)]"/>
                <filter string="Has CE Requirements" name="has_ce" domain="[('has_continuing_education', '=', True)]"/>
                <filter string="Parent Specialties" name="parent_only" domain="[('parent_specialty_id', '=', False)]"/>
                <filter string="Sub-Specialties" name="sub_specialties" domain="[('parent_specialty_id', '!=', False)]"/>
                
                <group expand="0" string="Group By">
                    <filter string="Type" name="group_type" domain="[]" context="{'group_by': 'specialty_type'}"/>
                    <filter string="Category" name="group_category" domain="[]" context="{'group_by': 'specialty_category'}"/>
                    <filter string="Parent Specialty" name="group_parent" domain="[]" context="{'group_by': 'parent_specialty_id'}"/>
                    <filter string="Certification Body" name="group_cert_body" domain="[]" context="{'group_by': 'certification_body'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Member Specialty Line Tree View -->
    <record id="view_member_specialty_line_tree" model="ir.ui.view">
        <field name="name">ams.member.specialty.line.tree</field>
        <field name="model">ams.member.specialty.line</field>
        <field name="arch" type="xml">
            <tree string="Member Specialties" default_order="partner_id,is_primary desc,date_acquired desc">
                <field name="partner_id"/>
                <field name="specialty_id"/>
                <field name="is_primary" widget="boolean_toggle"/>
                <field name="proficiency_level"/>
                <field name="date_acquired"/>
                <field name="years_experience"/>
                <field name="is_certified" widget="boolean_toggle"/>
                <field name="is_board_certified" widget="boolean_toggle"/>
                <field name="practice_percentage"/>
                <field name="status" widget="badge" decoration-success="status == 'active'" decoration-muted="status == 'inactive'"/>
                <field name="active" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>

    <!-- Member Specialty Line Form View -->
    <record id="view_member_specialty_line_form" model="ir.ui.view">
        <field name="name">ams.member.specialty.line.form</field>
        <field name="model">ams.member.specialty.line</field>
        <field name="arch" type="xml">
            <form string="Member Specialty">
                <header>
                    <button name="action_renew_certification" 
                            string="Renew Certification" 
                            type="object" 
                            class="btn-primary"
                            attrs="{'invisible': [('is_certification_expired', '=', False)]}"/>
                    <field name="status" widget="statusbar" statusbar_visible="active,inactive"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <!-- Add smart buttons here if needed -->
                    </div>

                    <group>
                        <group name="basic_info">
                            <field name="partner_id" options="{'no_create': True}"/>
                            <field name="specialty_id" options="{'no_create': True}"/>
                            <field name="is_primary"/>
                            <field name="proficiency_level"/>
                            <field name="date_acquired"/>
                            <field name="years_experience"/>
                        </group>
                        <group name="practice_info">
                            <field name="practice_percentage"/>
                            <field name="practice_setting"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Certification" name="certification">
                            <group>
                                <group name="general_certification">
                                    <field name="is_certified"/>
                                    <field name="certification_number" attrs="{'invisible': [('is_certified', '=', False)]}"/>
                                    <field name="certification_date" attrs="{'invisible': [('is_certified', '=', False)]}"/>
                                    <field name="certification_expiration" attrs="{'invisible': [('is_certified', '=', False)]}"/>
                                    <field name="certifying_body" attrs="{'invisible': [('is_certified', '=', False)]}"/>
                                    <field name="is_certification_expired" readonly="1" attrs="{'invisible': [('is_certified', '=', False)]}"/>
                                    <field name="certification_days_until_expiration" readonly="1" 
                                           attrs="{'invisible': ['|', ('is_certified', '=', False), ('certification_expiration', '=', False)]}"
                                           decoration-warning="certification_days_until_expiration &lt; 90 and certification_days_until_expiration &gt; 0"
                                           decoration-danger="certification_days_until_expiration &lt; 30 and certification_days_until_expiration &gt; 0"/>
                                </group>
                                <group name="board_certification">
                                    <field name="is_board_certified"/>
                                    <field name="board_certification_date" attrs="{'invisible': [('is_board_certified', '=', False)]}"/>
                                    <field name="board_certification_number" attrs="{'invisible': [('is_board_certified', '=', False)]}"/>
                                    <field name="board_name" attrs="{'invisible': [('is_board_certified', '=', False)]}"/>
                                </group>
                            </group>
                        </page>

                        <page string="Notes" name="notes">
                            <field name="notes" nolabel="1" placeholder="Additional notes about this specialty..."/>
                        </page>
                    </notebook>

                    <field name="active" invisible="1"/>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Member Specialty Line Search View -->
    <record id="view_member_specialty_line_search" model="ir.ui.view">
        <field name="name">ams.member.specialty.line.search</field>
        <field name="model">ams.member.specialty.line</field>
        <field name="arch" type="xml">
            <search string="Member Specialties">
                <field name="partner_id" string="Member"/>
                <field name="specialty_id" string="Specialty"/>
                <field name="certification_number"/>
                <field name="certifying_body"/>
                <field name="board_name"/>
                
                <filter string="Active" name="active" domain="[('active', '=', True)]"/>
                <filter string="Active Status" name="active_status" domain="[('status', '=', 'active')]"/>
                <filter string="Primary Specialties" name="primary" domain="[('is_primary', '=', True)]"/>
                <separator/>
                <filter string="Certified" name="certified" domain="[('is_certified', '=', True)]"/>
                <filter string="Board Certified" name="board_certified" domain="[('is_board_certified', '=', True)]"/>
                <filter string="Certification Expired" name="cert_expired" domain="[('is_certification_expired', '=', True)]"/>
                <filter string="Certification Expiring Soon" name="cert_expiring_soon" domain="[('certification_days_until_expiration', '&lt;', 90), ('certification_days_until_expiration', '&gt;', 0)]"/>
                <separator/>
                <filter string="Basic Level" name="basic" domain="[('proficiency_level', '=', 'basic')]"/>
                <filter string="Intermediate Level" name="intermediate" domain="[('proficiency_level', '=', 'intermediate')]"/>
                <filter string="Advanced Level" name="advanced" domain="[('proficiency_level', '=', 'advanced')]"/>
                <filter string="Expert Level" name="expert" domain="[('proficiency_level', '=', 'expert')]"/>
                
                <group expand="0" string="Group By">
                    <filter string="Member" name="group_member" domain="[]" context="{'group_by': 'partner_id'}"/>
                    <filter string="Specialty" name="group_specialty" domain="[]" context="{'group_by': 'specialty_id'}"/>
                    <filter string="Proficiency Level" name="group_proficiency" domain="[]" context="{'group_by': 'proficiency_level'}"/>
                    <filter string="Practice Setting" name="group_practice_setting" domain="[]" context="{'group_by': 'practice_setting'}"/>
                    <filter string="Status" name="group_status" domain="[]" context="{'group_by': 'status'}"/>
                    <filter string="Certification Status" name="group_certification" domain="[]" context="{'group_by': 'is_certified'}"/>
                    <filter string="Acquired Year" name="group_acquired_year" domain="[]" context="{'group_by': 'date_acquired:year'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Kanban View for Member Specialty Lines -->
    <record id="view_member_specialty_line_kanban" model="ir.ui.view">
        <field name="name">ams.member.specialty.line.kanban</field>
        <field name="model">ams.member.specialty.line</field>
        <field name="arch" type="xml">
            <kanban default_group_by="specialty_id" class="o_kanban_mobile">
                <field name="partner_id"/>
                <field name="specialty_id"/>
                <field name="is_primary"/>
                <field name="proficiency_level"/>
                <field name="is_certified"/>
                <field name="is_board_certified"/>
                <field name="years_experience"/>
                <field name="practice_percentage"/>
                <field name="status"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="partner_id"/>
                                    </strong>
                                </div>
                                <div class="o_kanban_record_subtitle">
                                    <field name="specialty_id"/>
                                </div>
                            </div>
                            <div class="o_kanban_record_body">
                                <div class="o_kanban_tags_section">
                                    <span t-if="record.is_primary.raw_value" class="badge badge-primary">Primary</span>
                                    <span t-if="record.is_certified.raw_value" class="badge badge-success">Certified</span>
                                    <span t-if="record.is_board_certified.raw_value" class="badge badge-info">Board Certified</span>
                                </div>
                                <div class="o_kanban_record_details">
                                    <div t-if="record.proficiency_level.raw_value">
                                        Level: <field name="proficiency_level"/>
                                    </div>
                                    <div t-if="record.years_experience.raw_value">
                                        Experience: <field name="years_experience"/> years
                                    </div>
                                    <div t-if="record.practice_percentage.raw_value">
                                        Practice: <field name="practice_percentage"/>%
                                    </div>
                                </div>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <field name="status" widget="label_selection" options="{'classes': {'active': 'success', 'inactive': 'default'}}"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_member_specialty" model="ir.actions.act_window">
        <field name="name">Member Specialties</field>
        <field name="res_model">ams.member.specialty</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first member specialty!
            </p>
            <p>
                Member specialties define areas of expertise and practice that your members
                can specialize in. Set up certification requirements, training needs, and
                continuing education requirements for each specialty.
            </p>
        </field>
    </record>

    <record id="action_member_specialty_line" model="ir.actions.act_window">
        <field name="name">Member Specialty Assignments</field>
        <field name="res_model">ams.member.specialty.line</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No member specialties assigned yet!
            </p>
            <p>
                Track which specialties your members practice in, their proficiency levels,
                certification status, and years of experience in each area.
            </p>
        </field>
    </record>

    <record id="action_member_specialty_line_by_specialty" model="ir.actions.act_window">
        <field name="name">Members with this Specialty</field>
        <field name="res_model">ams.member.specialty.line</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="domain">[('specialty_id', '=', active_id)]</field>
        <field name="context">{'default_specialty_id': active_id, 'search_default_active': 1}</field>
    </record>

</odoo>