<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Extend Partner Form View with Professional Information -->
    <record id="view_partner_form_professional" model="ir.ui.view">
        <field name="name">res.partner.form.professional</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="ams_core_base.view_partner_form_ams"/>
        <field name="arch" type="xml">
            
            <!-- Add professional buttons to button box -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_professional_designations" 
                        type="object" 
                        class="oe_stat_button" 
                        icon="fa-certificate"
                        attrs="{'invisible': [('is_member', '=', False)]}">
                    <field name="designation_count" widget="statinfo" string="Designations"/>
                </button>
                <button name="action_view_specialties" 
                        type="object" 
                        class="oe_stat_button" 
                        icon="fa-stethoscope"
                        attrs="{'invisible': [('is_member', '=', False)]}">
                    <field name="specialty_count" widget="statinfo" string="Specialties"/>
                </button>
            </xpath>

            <!-- Add Professional tab after Member Information tab -->
            <xpath expr="//page[@name='member_info']" position="after">
                <page string="Professional" name="professional" attrs="{'invisible': [('is_member', '=', False)]}">
                    
                    <!-- Professional Summary Section -->
                    <group string="Professional Summary">
                        <group name="professional_summary_left">
                            <field name="professional_credentials" readonly="1"/>
                            <field name="specialty_summary" readonly="1"/>
                            <field name="primary_specialty_id" readonly="1"/>
                        </group>
                        <group name="professional_summary_right">
                            <field name="practice_name"/>
                            <field name="practice_type"/>
                            <field name="years_in_practice"/>
                            <field name="professional_compliance_status" readonly="1" widget="badge" 
                                   decoration-success="professional_compliance_status == 'compliant'"
                                   decoration-warning="professional_compliance_status == 'warning'"
                                   decoration-danger="professional_compliance_status == 'non_compliant'"/>
                        </group>
                    </group>

                    <!-- License Information Section -->
                    <group string="Primary License Information">
                        <group name="license_basic">
                            <field name="license_certification_number"/>
                            <field name="license_issuing_state"/>
                            <field name="license_issuing_country"/>
                        </group>
                        <group name="license_status">
                            <field name="license_expiration_date"/>
                            <field name="license_status" widget="badge"
                                   decoration-success="license_status == 'active'"
                                   decoration-warning="license_status == 'pending'"
                                   decoration-danger="license_status in ('expired', 'suspended', 'revoked')"/>
                        </group>
                    </group>

                    <!-- Continuing Education Section -->
                    <group string="Continuing Education">
                        <group name="ce_current">
                            <field name="continuing_education_hours"/>
                            <field name="ce_hours_required" readonly="1"/>
                            <field name="ce_reporting_period_start"/>
                            <field name="ce_reporting_period_end"/>
                        </group>
                        <group name="ce_compliance">
                            <field name="has_expired_designations" readonly="1" widget="boolean"/>
                            <field name="has_expiring_soon_designations" readonly="1" widget="boolean"/>
                        </group>
                    </group>

                    <!-- Professional Online Presence Section -->
                    <group string="Professional Online Presence">
                        <group name="professional_networks">
                            <field name="orcid_id" widget="url" placeholder="0000-0000-0000-0000"/>
                            <field name="researchgate_profile" widget="url"/>
                            <field name="google_scholar_profile" widget="url"/>
                            <field name="professional_website" widget="url"/>
                        </group>
                        <group name="other_info">
                            <field name="board_certifications"/>
                        </group>
                    </group>

                    <!-- Professional Designations Section -->
                    <separator string="Professional Designations"/>
                    <field name="professional_designation_ids" nolabel="1" context="{'default_partner_id': active_id}">
                        <tree editable="bottom" decoration-danger="status in ('expired', 'suspended', 'revoked')"
                              decoration-warning="days_until_expiration &lt; 90 and days_until_expiration &gt; 0">
                            <field name="designation_id" options="{'no_create': True}"/>
                            <field name="license_number"/>
                            <field name="earned_date"/>
                            <field name="expiration_date"/>
                            <field name="issuing_jurisdiction"/>
                            <field name="status" widget="badge" 
                                   decoration-success="status == 'active'"
                                   decoration-warning="status == 'expired'"
                                   decoration-danger="status in ('suspended', 'revoked')"/>
                            <field name="days_until_expiration" readonly="1"
                                   decoration-warning="days_until_expiration &lt; 90 and days_until_expiration &gt; 0"
                                   decoration-danger="days_until_expiration &lt; 30 and days_until_expiration &gt; 0"/>
                            <field name="active" widget="boolean_toggle"/>
                            <button name="action_renew_designation" 
                                    type="object" 
                                    icon="fa-refresh" 
                                    title="Renew Designation"
                                    attrs="{'invisible': [('status', '!=', 'expired')]}"/>
                        </tree>
                        <form>
                            <group>
                                <group>
                                    <field name="designation_id" options="{'no_create': True}"/>
                                    <field name="license_number"/>
                                    <field name="earned_date"/>
                                    <field name="expiration_date"/>
                                </group>
                                <group>
                                    <field name="issuing_jurisdiction"/>
                                    <field name="status"/>
                                    <field name="active"/>
                                </group>
                            </group>
                            <field name="notes" placeholder="Notes about this designation..."/>
                        </form>
                    </field>

                    <!-- Member Specialties Section -->
                    <separator string="Professional Specialties"/>
                    <field name="specialty_ids" nolabel="1" context="{'default_partner_id': active_id}">
                        <tree editable="bottom" decoration-info="is_primary == True">
                            <field name="specialty_id" options="{'no_create': True}"/>
                            <field name="is_primary" widget="boolean_toggle"/>
                            <field name="proficiency_level"/>
                            <field name="date_acquired"/>
                            <field name="years_experience"/>
                            <field name="practice_percentage"/>
                            <field name="is_certified" widget="boolean_toggle"/>
                            <field name="is_board_certified" widget="boolean_toggle"/>
                            <field name="practice_setting"/>
                            <field name="status" widget="badge" decoration-success="status == 'active'" decoration-muted="status == 'inactive'"/>
                            <field name="active" widget="boolean_toggle"/>
                        </tree>
                        <form>
                            <group>
                                <group>
                                    <field name="specialty_id" options="{'no_create': True}"/>
                                    <field name="is_primary"/>
                                    <field name="proficiency_level"/>
                                    <field name="date_acquired"/>
                                    <field name="years_experience"/>
                                    <field name="practice_percentage"/>
                                    <field name="practice_setting"/>
                                </group>
                                <group>
                                    <field name="is_certified"/>
                                    <field name="certification_number" attrs="{'invisible': [('is_certified', '=', False)]}"/>
                                    <field name="certification_date" attrs="{'invisible': [('is_certified', '=', False)]}"/>
                                    <field name="certification_expiration" attrs="{'invisible': [('is_certified', '=', False)]}"/>
                                    <field name="is_board_certified"/>
                                    <field name="board_certification_date" attrs="{'invisible': [('is_board_certified', '=', False)]}"/>
                                    <field name="status"/>
                                    <field name="active"/>
                                </group>
                            </group>
                            <field name="notes" placeholder="Notes about this specialty..."/>
                        </form>
                    </field>

                </page>
            </xpath>

        </field>
    </record>

    <!-- Extend Partner Tree View with Professional Information -->
    <record id="view_partner_tree_professional" model="ir.ui.view">
        <field name="name">res.partner.tree.professional</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="ams_core_base.view_partner_tree_ams"/>
        <field name="arch" type="xml">
            
            <!-- Add professional columns to tree view -->
            <xpath expr="//field[@name='profession_discipline']" position="after">
                <field name="professional_credentials" optional="hide"/>
                <field name="primary_specialty_id" optional="hide"/>
                <field name="practice_type" optional="hide"/>
                <field name="years_in_practice" optional="hide"/>
                <field name="designation_count" optional="hide"/>
                <field name="specialty_count" optional="hide"/>
                <field name="professional_compliance_status" optional="show" widget="badge"
                       decoration-success="professional_compliance_status == 'compliant'"
                       decoration-warning="professional_compliance_status == 'warning'"
                       decoration-danger="professional_compliance_status == 'non_compliant'"/>
            </xpath>

        </field>
    </record>

    <!-- Partner Search View Extensions -->
    <record id="view_partner_search_professional" model="ir.ui.view">
        <field name="name">res.partner.search.professional</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="ams_core_base.view_partner_search_ams"/>
        <field name="arch" type="xml">
            
            <!-- Add professional search fields -->
            <xpath expr="//field[@name='professional_designation_ids']" position="after">
                <field name="professional_credentials"/>
                <field name="primary_specialty_id"/>
                <field name="practice_name"/>
                <field name="license_certification_number"/>
                <field name="orcid_id"/>
            </xpath>

            <!-- Add professional filters -->
            <xpath expr="//filter[@name='prospects']" position="after">
                <separator/>
                <filter string="Has Professional Designations" name="has_designations" domain="[('designation_count', '>', 0)]"/>
                <filter string="Has Specialties" name="has_specialties" domain="[('specialty_count', '>', 0)]"/>
                <filter string="Licensed Professionals" name="licensed" domain="[('license_certification_number', '!=', False)]"/>
                <separator/>
                <filter string="Compliant" name="compliant" domain="[('professional_compliance_status', '=', 'compliant')]"/>
                <filter string="Warning Status" name="warning_status" domain="[('professional_compliance_status', '=', 'warning')]"/>
                <filter string="Non-Compliant" name="non_compliant" domain="[('professional_compliance_status', '=', 'non_compliant')]"/>
                <filter string="Expired Designations" name="expired_designations" domain="[('has_expired_designations', '=', True)]"/>
                <filter string="Expiring Soon" name="expiring_soon" domain="[('has_expiring_soon_designations', '=', True)]"/>
            </xpath>

            <!-- Add professional grouping options -->
            <xpath expr="//filter[@name='group_employer']" position="after">
                <filter string="Primary Specialty" name="group_primary_specialty" domain="[]" context="{'group_by': 'primary_specialty_id'}"/>
                <filter string="Practice Type" name="group_practice_type" domain="[]" context="{'group_by': 'practice_type'}"/>
                <filter string="License Status" name="group_license_status" domain="[]" context="{'group_by': 'license_status'}"/>
                <filter string="Compliance Status" name="group_compliance_status" domain="[]" context="{'group_by': 'professional_compliance_status'}"/>
                <filter string="License Issuing State" name="group_license_state" domain="[]" context="{'group_by': 'license_issuing_state'}"/>
            </xpath>

        </field>
    </record>

    <!-- Partner Kanban View Extensions -->
    <record id="view_partner_kanban_professional" model="ir.ui.view">
        <field name="name">res.partner.kanban.professional</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="ams_core_base.view_partner_kanban_ams"/>
        <field name="arch" type="xml">
            
            <!-- Add professional fields to kanban -->
            <xpath expr="//field[@name='profession_discipline']" position="after">
                <field name="professional_credentials"/>
                <field name="primary_specialty_id"/>
                <field name="practice_name"/>
                <field name="professional_compliance_status"/>
                <field name="designation_count"/>
                <field name="specialty_count"/>
            </xpath>

            <!-- Add professional information to kanban card -->
            <xpath expr="//div[@class='oe_kanban_profession']" position="after">
                <div t-if="record.is_member.raw_value and record.professional_credentials.raw_value" class="oe_kanban_profession">
                    <i class="fa fa-certificate"/> <field name="professional_credentials"/>
                </div>
                <div t-if="record.is_member.raw_value and record.primary_specialty_id.raw_value" class="oe_kanban_profession">
                    <i class="fa fa-stethoscope"/> <field name="primary_specialty_id"/>
                </div>
                <div t-if="record.is_member.raw_value and record.practice_name.raw_value" class="oe_kanban_profession">
                    <i class="fa fa-building"/> <field name="practice_name"/>
                </div>
            </xpath>

            <!-- Add professional badges -->
            <xpath expr="//div[@class='oe_kanban_member_info']" position="inside">
                <span t-if="record.is_member.raw_value and record.designation_count.raw_value" class="badge badge-info" title="Professional Designations">
                    <i class="fa fa-certificate"/> <field name="designation_count"/>
                </span>
                <span t-if="record.is_member.raw_value and record.specialty_count.raw_value" class="badge badge-success" title="Specialties">
                    <i class="fa fa-stethoscope"/> <field name="specialty_count"/>
                </span>
                <span t-if="record.is_member.raw_value and record.professional_compliance_status.raw_value" 
                      t-attf-class="badge badge-#{record.professional_compliance_status.raw_value == 'compliant' and 'success' or record.professional_compliance_status.raw_value == 'warning' and 'warning' or 'danger'}"
                      t-att-title="record.professional_compliance_status.value">
                    <i t-attf-class="fa fa-#{record.professional_compliance_status.raw_value == 'compliant' and 'check' or record.professional_compliance_status.raw_value == 'warning' and 'exclamation-triangle' or 'times'}"/>
                </span>
            </xpath>

        </field>
    </record>

    <!-- Menu items (will be added to main AMS menu structure) -->
    <menuitem id="menu_professional_root"
              name="Professional"
              parent="ams_core_base.menu_ams_root"
              sequence="30"
              groups="ams_core_base.group_ams_staff,ams_core_base.group_ams_admin"/>

    <menuitem id="menu_professional_designations"
              name="Professional Designations"
              parent="menu_professional_root"
              action="action_professional_designation"
              sequence="10"/>

    <menuitem id="menu_member_designations"
              name="Member Designations"
              parent="menu_professional_root"
              action="action_member_designation"
              sequence="20"/>

    <menuitem id="menu_member_specialties"
              name="Member Specialties"
              parent="menu_professional_root"
              action="action_member_specialty"
              sequence="30"/>

    <menuitem id="menu_member_specialty_assignments"
              name="Specialty Assignments"
              parent="menu_professional_root"
              action="action_member_specialty_line"
              sequence="40"/>

</odoo>