<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Mass Renewal Wizard Form View -->
        <record id="view_mass_renewal_wizard_form" model="ir.ui.view">
            <field name="name">ams.mass.renewal.wizard.form</field>
            <field name="model">ams.mass.renewal.wizard</field>
            <field name="arch" type="xml">
                <form string="Mass Renewal">
                    <sheet>
                        <div class="oe_title">
                            <h1>Mass Renewal Processing</h1>
                            <p>Process multiple membership and subscription renewals in batch.</p>
                        </div>

                        <group>
                            <group string="Batch Information">
                                <field name="name" required="True"/>
                                <field name="batch_code" readonly="True"/>
                                <field name="renewal_type" widget="radio"/>
                            </group>
                            <group string="Target Selection">
                                <field name="target_records" widget="radio"/>
                                <field name="expiry_days_ahead" 
                                       invisible="target_records != 'expiring'"/>
                                <field name="custom_start_date" 
                                       invisible="target_records != 'custom_date'"/>
                                <field name="custom_end_date" 
                                       invisible="target_records != 'custom_date'"/>
                            </group>
                        </group>

                        <group>
                            <group string="Filters">
                                <field name="member_type_ids" widget="many2many_tags"
                                       invisible="renewal_type == 'subscription'"/>
                                <field name="product_ids" widget="many2many_tags"/>
                            </group>
                            <group string="Status Filters">
                                <field name="include_active"/>
                                <field name="include_grace" 
                                       invisible="renewal_type == 'subscription'"/>
                                <field name="include_suspended"/>
                            </group>
                        </group>

                        <group>
                            <group string="Renewal Settings">
                                <field name="new_renewal_period"/>
                                <field name="apply_early_bird_discount"/>
                                <field name="early_bird_discount_percent" 
                                       invisible="not apply_early_bird_discount"/>
                            </group>
                            <group string="Processing Options">
                                <field name="create_invoices"/>
                                <field name="send_renewal_emails"/>
                                <field name="auto_confirm_renewals"/>
                            </group>
                        </group>

                        <group string="Preview">
                            <field name="eligible_count" readonly="True"/>
                            <div class="alert alert-info" role="alert" 
                                 invisible="not eligible_count">
                                <strong><field name="eligible_count"/> records</strong> 
                                match your criteria and will be processed.
                            </div>
                            <div class="alert alert-warning" role="alert" 
                                 invisible="eligible_count">
                                <strong>No records found</strong> that match your current criteria. 
                                Please adjust the filters above.
                            </div>
                        </group>
                    </sheet>
                    
                    <footer>
                        <button name="action_preview_records" 
                                string="Preview Records" 
                                type="object" 
                                class="btn-secondary"
                                invisible="not eligible_count"/>
                        <button name="action_process_renewals" 
                                string="Process Renewals" 
                                type="object" 
                                class="btn-primary"
                                invisible="not eligible_count"
                                confirm="Are you sure you want to process these renewals? This action cannot be undone."/>
                        <button string="Cancel" special="cancel" class="btn-secondary"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Mass Renewal Preview Form View -->
        <record id="view_mass_renewal_wizard_preview" model="ir.ui.view">
            <field name="name">ams.mass.renewal.wizard.preview</field>
            <field name="model">ams.mass.renewal.wizard</field>
            <field name="arch" type="xml">
                <form string="Mass Renewal Preview">
                    <sheet>
                        <div class="oe_title">
                            <h1>Renewal Preview</h1>
                            <p>Review the records that will be processed for renewal.</p>
                        </div>

                        <group>
                            <group string="Batch Information">
                                <field name="name" readonly="True"/>
                                <field name="batch_code" readonly="True"/>
                                <field name="eligible_count" readonly="True"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Preview Records" name="preview">
                                <field name="preview_line_ids" nolabel="1">
                                    <list editable="bottom">
                                        <field name="include_in_batch"/>
                                        <field name="record_type" readonly="True"/>
                                        <field name="partner_id" readonly="True"/>
                                        <field name="product_id" readonly="True"/>
                                        <field name="current_end_date" readonly="True"/>
                                        <field name="proposed_end_date" readonly="True"/>
                                        <field name="current_amount" readonly="True" widget="monetary"/>
                                        <field name="proposed_amount" readonly="True" widget="monetary"/>
                                        <field name="currency_id" invisible="True"/>
                                        <field name="membership_id" invisible="True"/>
                                        <field name="subscription_id" invisible="True"/>
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    
                    <footer>
                        <button name="action_process_renewals" 
                                string="Process Selected Renewals" 
                                type="object" 
                                class="btn-primary"
                                confirm="Are you sure you want to process the selected renewals? This action cannot be undone."/>
                        <button string="Back" special="cancel" class="btn-secondary"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Mass Renewal Results Form View -->
        <record id="view_mass_renewal_wizard_results" model="ir.ui.view">
            <field name="name">ams.mass.renewal.wizard.results</field>
            <field name="model">ams.mass.renewal.wizard</field>
            <field name="arch" type="xml">
                <form string="Mass Renewal Results">
                    <sheet>
                        <div class="oe_title">
                            <h1>Processing Complete</h1>
                            <p>Mass renewal batch has been processed. See results below.</p>
                        </div>

                        <group>
                            <group string="Batch Information">
                                <field name="name" readonly="True"/>
                                <field name="batch_code" readonly="True"/>
                            </group>
                        </group>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="card bg-info text-white mb-3">
                                    <div class="card-body text-center">
                                        <h3 class="card-title">
                                            <field name="processed_count" readonly="True"/>
                                        </h3>
                                        <p class="card-text">Records Processed</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-success text-white mb-3">
                                    <div class="card-body text-center">
                                        <h3 class="card-title">
                                            <field name="success_count" readonly="True"/>
                                        </h3>
                                        <p class="card-text">Successful Renewals</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-danger text-white mb-3" invisible="not error_count">
                                    <div class="card-body text-center">
                                        <h3 class="card-title">
                                            <field name="error_count" readonly="True"/>
                                        </h3>
                                        <p class="card-text">Errors</p>
                                    </div>
                                </div>
                                <div class="card bg-secondary text-white mb-3" invisible="error_count">
                                    <div class="card-body text-center">
                                        <h3 class="card-title">0</h3>
                                        <p class="card-text">Errors</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <group string="Processing Log">
                            <field name="processing_log" readonly="True" widget="text" 
                                   options="{'resizable': True}" nolabel="1"/>
                        </group>
                    </sheet>
                    
                    <footer>
                        <button name="action_view_renewals"
                                string="View Renewals" 
                                type="object" 
                                class="btn-primary"/>
                        <button string="Close" special="cancel" class="btn-secondary"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Mass Renewal Preview List View -->
        <record id="view_mass_renewal_preview_list" model="ir.ui.view">
            <field name="name">ams.mass.renewal.preview.list</field>
            <field name="model">ams.mass.renewal.preview</field>
            <field name="arch" type="xml">
                <list string="Renewal Preview" create="false" delete="false">
                    <field name="include_in_batch"/>
                    <field name="record_type"/>
                    <field name="partner_id"/>
                    <field name="product_id"/>
                    <field name="current_end_date"/>
                    <field name="proposed_end_date"/>
                    <field name="current_amount" widget="monetary"/>
                    <field name="proposed_amount" widget="monetary"/>
                    <field name="currency_id" invisible="True"/>
                </list>
            </field>
        </record>

        <!-- Mass Renewal Wizard Action -->
        <record id="action_mass_renewal_wizard" model="ir.actions.act_window">
            <field name="name">Mass Renewal</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">ams.mass.renewal.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Process multiple renewals at once
                </p>
                <p>
                    Use the mass renewal wizard to efficiently process renewal
                    reminders, create invoices, and extend membership or subscription
                    periods for multiple records simultaneously.
                </p>
            </field>
        </record>

    </data>
</odoo>