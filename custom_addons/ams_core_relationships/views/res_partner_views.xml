<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ===== PARTNER FORM VIEW EXTENSION FOR RELATIONSHIPS ===== -->
    <record id="view_partner_form_relationships" model="ir.ui.view">
        <field name="name">res.partner.form.relationships</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            
            <!-- Add relationship statistics to button box -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_all_relationships" type="object" 
                        class="oe_stat_button" icon="fa-sitemap">
                    <field name="all_relationships_count" widget="statinfo" string="Relationships"/>
                </button>
                <button name="action_create_relationship" type="object" 
                        class="oe_stat_button" icon="fa-plus"
                        groups="ams_core_relationships.group_relationship_manager">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">Add Relationship</span>
                    </div>
                </button>
            </xpath>
            
            <!-- Add Relationships tab after Extended Profile -->
            <xpath expr="//page[@name='extended_profile']" position="after">
                <page string="Relationships" name="relationships">
                    
                    <!-- Relationship Summary Cards -->
                    <div class="row mt16 mb16">
                        <div class="col-lg-3 col-md-6">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <h5 class="card-title">Employment</h5>
                                    <p class="card-text">
                                        <field name="current_employer_id" readonly="1"/>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <h5 class="card-title">Family</h5>
                                    <p class="card-text">
                                        <field name="spouse_id" readonly="1"/>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <h5 class="card-title">Emergency</h5>
                                    <p class="card-text">
                                        <field name="primary_emergency_contact_id" readonly="1"/>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <h5 class="card-title">Total</h5>
                                    <p class="card-text">
                                        <field name="active_relationships_count" readonly="1"/> Active
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <notebook>
                        
                        <!-- Employment Relationships -->
                        <page string="Employment" name="employment_relationships" 
                              attrs="{'invisible': [('is_company', '=', True)]}">
                            <group>
                                <group string="Current Employment">
                                    <field name="current_employer_id"/>
                                    <button name="action_view_employment_chart" string="View Org Chart" 
                                            type="object" class="btn-link" icon="fa-sitemap"/>
                                </group>
                                <group string="Employment Network">
                                    <label for="employees_ids"/>
                                    <field name="employees_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="supervisors_ids"/>
                                    <field name="supervisors_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="subordinates_ids"/>
                                    <field name="subordinates_ids" nolabel="1" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>
                        
                        <!-- Family Relationships -->
                        <page string="Family" name="family_relationships"
                              attrs="{'invisible': [('is_company', '=', True)]}">
                            <group>
                                <group string="Immediate Family">
                                    <field name="spouse_id"/>
                                    <button name="action_view_family_tree" string="View Family Tree" 
                                            type="object" class="btn-link" icon="fa-users"/>
                                </group>
                                <group string="Family Network">
                                    <label for="children_ids"/>
                                    <field name="children_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="parents_ids"/>
                                    <field name="parents_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="siblings_ids"/>
                                    <field name="siblings_ids" nolabel="1" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>
                        
                        <!-- Household Relationships -->
                        <page string="Household" name="household_relationships"
                              attrs="{'invisible': [('is_company', '=', True)]}">
                            <group>
                                <group string="Household Members">
                                    <label for="household_members_ids"/>
                                    <field name="household_members_ids" nolabel="1" widget="many2many_tags"/>
                                </group>
                                <group string="Dependencies">
                                    <label for="dependents_ids"/>
                                    <field name="dependents_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="guardians_ids"/>
                                    <field name="guardians_ids" nolabel="1" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>
                        
                        <!-- Emergency Contacts -->
                        <page string="Emergency Contacts" name="emergency_contacts">
                            <group>
                                <group string="Primary Contacts">
                                    <field name="primary_emergency_contact_id"/>
                                </group>
                                <group string="All Emergency Contacts">
                                    <label for="emergency_contacts_ids"/>
                                    <field name="emergency_contacts_ids" nolabel="1" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>
                        
                        <!-- Professional Network -->
                        <page string="Professional" name="professional_relationships">
                            <group>
                                <group string="Professional Network">
                                    <label for="colleagues_ids"/>
                                    <field name="colleagues_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="mentors_ids"/>
                                    <field name="mentors_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="mentees_ids"/>
                                    <field name="mentees_ids" nolabel="1" widget="many2many_tags"/>
                                </group>
                                <group string="Professional References">
                                    <label for="referrers_ids"/>
                                    <field name="referrers_ids" nolabel="1" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>
                        
                        <!-- Business Relationships -->
                        <page string="Business" name="business_relationships">
                            <group>
                                <group string="Business Network">
                                    <label for="clients_ids"/>
                                    <field name="clients_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="vendors_ids"/>
                                    <field name="vendors_ids" nolabel="1" widget="many2many_tags"/>
                                    <label for="partners_ids"/>
                                    <field name="partners_ids" nolabel="1" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>
                        
                        <!-- All Relationships (Detailed) -->
                        <page string="All Relationships" name="all_relationships"
                              groups="ams_core_relationships.group_relationship_viewer">
                            <field name="relationship_ids" nolabel="1">
                                <tree editable="false" create="true" delete="true">
                                    <field name="partner_b_id"/>
                                    <field name="relationship_type_id"/>
                                    <field name="start_date"/>
                                    <field name="end_date"/>
                                    <field name="is_active"/>
                                    <field name="relationship_strength" widget="badge"/>
                                    <field name="primary_contact"/>
                                    <field name="emergency_contact"/>
                                    <field name="contact_frequency"/>
                                </tree>
                                <form>
                                    <group>
                                        <field name="partner_b_id"/>
                                        <field name="relationship_type_id"/>
                                        <field name="start_date"/>
                                        <field name="end_date"/>
                                        <field name="contact_frequency"/>
                                        <field name="primary_contact"/>
                                        <field name="emergency_contact"/>
                                        <field name="description"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                        
                    </notebook>
                </page>
            </xpath>
            
        </field>
    </record>
    
    <!-- ===== PARTNER TREE VIEW EXTENSION FOR RELATIONSHIPS ===== -->
    <record id="view_partner_tree_relationships" model="ir.ui.view">
        <field name="name">res.partner.tree.relationships</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            
            <!-- Add relationship fields to tree view -->
            <xpath expr="//field[@name='employer_id']" position="after">
                <field name="current_employer_id" optional="hide"/>
                <field name="spouse_id" optional="hide"/>
                <field name="primary_emergency_contact_id" optional="hide"/>
                <field name="all_relationships_count" optional="show"/>
                <field name="active_relationships_count" optional="hide"/>
            </xpath>
            
        </field>
    </record>
    
    <!-- ===== PARTNER KANBAN VIEW EXTENSION FOR RELATIONSHIPS ===== -->
    <record id="view_partner_kanban_relationships" model="ir.ui.view">
        <field name="name">res.partner.kanban.relationships</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view"/>
        <field name="arch" type="xml">
            
            <!-- Add relationship information to kanban cards -->
            <xpath expr="//div[@class='oe_kanban_profession']" position="after">
                <div t-if="record.current_employer_id.raw_value" class="oe_kanban_employer">
                    <i class="fa fa-building"/> <t t-esc="record.current_employer_id.value"/>
                </div>
                <div t-if="record.spouse_id.raw_value" class="oe_kanban_spouse">
                    <i class="fa fa-heart"/> Spouse: <t t-esc="record.spouse_id.value"/>
                </div>
                <div t-if="record.primary_emergency_contact_id.raw_value" class="oe_kanban_emergency">
                    <i class="fa fa-phone text-danger"/> Emergency: <t t-esc="record.primary_emergency_contact_id.value"/>
                </div>
                <div t-if="record.all_relationships_count.raw_value > 0" class="oe_kanban_relationships">
                    <i class="fa fa-sitemap text-info"/> 
                    <t t-esc="record.all_relationships_count.value"/> relationships
                </div>
            </xpath>
            
        </field>
    </record>
    
    <!-- ===== PARTNER SEARCH VIEW EXTENSION FOR RELATIONSHIPS ===== -->
    <record id="view_partner_search_relationships" model="ir.ui.view">
        <field name="name">res.partner.search.relationships</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
            
            <!-- Add relationship search fields -->
            <xpath expr="//field[@name='employer_id']" position="after">
                <field name="current_employer_id"/>
                <field name="spouse_id"/>
                <field name="primary_emergency_contact_id"/>
                <field name="emergency_contacts_ids"/>
                <field name="colleagues_ids"/>
                <field name="mentors_ids"/>
                <field name="mentees_ids"/>
            </xpath>
            
            <!-- Add relationship filters -->
            <xpath expr="//filter[@name='prospects']" position="after">
                <separator/>
                <filter string="Has Employer" name="has_employer" 
                        domain="[('current_employer_id', '!=', False)]"/>
                <filter string="Has Spouse" name="has_spouse" 
                        domain="[('spouse_id', '!=', False)]"/>
                <filter string="Has Emergency Contact" name="has_emergency" 
                        domain="[('primary_emergency_contact_id', '!=', False)]"/>
                <filter string="Well Connected" name="well_connected" 
                        domain="[('all_relationships_count', '&gt;=', 5)]"/>
                <filter string="Highly Connected" name="highly_connected" 
                        domain="[('all_relationships_count', '&gt;=', 10)]"/>
            </xpath>
            
            <!-- Add relationship grouping -->
            <xpath expr="//filter[@name='group_employer']" position="after">
                <filter string="Current Employer" name="group_current_employer" 
                        domain="[]" context="{'group_by': 'current_employer_id'}"/>
                <filter string="Emergency Contact" name="group_emergency_contact" 
                        domain="[]" context="{'group_by': 'primary_emergency_contact_id'}"/>
                <filter string="Relationship Count" name="group_relationship_count" 
                        domain="[]" context="{'group_by': 'all_relationships_count'}"/>
            </xpath>
            
        </field>
    </record>
    
    <!-- ===== SPECIALIZED ACTIONS FOR MEMBER RELATIONSHIPS ===== -->
    
    <!-- Members with No Emergency Contact -->
    <record id="action_members_no_emergency_contact" model="ir.actions.act_window">
        <field name="name">Members Without Emergency Contact</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_member', '=', True), ('primary_emergency_contact_id', '=', False)]</field>
        <field name="context">{'default_is_member': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                All members have emergency contacts!
            </p>
            <p>
                This list shows members who haven't designated an emergency contact.
                Consider reaching out to help them complete their profile.
            </p>
        </field>
    </record>
    
    <!-- Well Connected Members -->
    <record id="action_well_connected_members" model="ir.actions.act_window">
        <field name="name">Well Connected Members</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('is_member', '=', True), ('all_relationships_count', '&gt;=', 5)]</field>
        <field name="context">{'default_is_member': True}</field>
    </record>
    
    <!-- Members by Employer -->
    <record id="action_members_by_employer" model="ir.actions.act_window">
        <field name="name">Members by Employer</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('is_member', '=', True), ('current_employer_id', '!=', False)]</field>
        <field name="context">{'search_default_group_current_employer': 1}</field>
    </record>
    
    <!-- Family Networks -->
    <record id="action_family_networks" model="ir.actions.act_window">
        <field name="name">Family Networks</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('is_member', '=', True), '|', ('spouse_id', '!=', False), ('children_ids', '!=', False)]</field>
        <field name="context">{'default_is_member': True}</field>
    </record>
    
    <!-- Professional Mentors -->
    <record id="action_professional_mentors" model="ir.actions.act_window">
        <field name="name">Professional Mentors</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('is_member', '=', True), ('mentees_ids', '!=', False)]</field>
        <field name="context">{'default_is_member': True}</field>
    </record>
    
</odoo>