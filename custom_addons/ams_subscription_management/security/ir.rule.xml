<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Record Rules for Subscription Management -->

    <!-- Subscription Product Rules -->
    <record id="rule_subscription_product_user" model="ir.rule">
        <field name="name">Subscription Product: User Access</field>
        <field name="model_id" ref="model_ams_subscription_product"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_member_user'))]"/>
        <field name="domain_force">[('active', '=', True)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_subscription_product_staff" model="ir.rule">
        <field name="name">Subscription Product: Staff Access</field>
        <field name="model_id" ref="model_ams_subscription_product"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_staff'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_subscription_product_admin" model="ir.rule">
        <field name="name">Subscription Product: Admin Access</field>
        <field name="model_id" ref="model_ams_subscription_product"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_admin'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Pricing Tier Rules -->
    <record id="rule_pricing_tier_user" model="ir.rule">
        <field name="name">Pricing Tier: User Access</field>
        <field name="model_id" ref="model_ams_subscription_pricing_tier"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_member_user'))]"/>
        <field name="domain_force">[
            ('active', '=', True),
            ('is_current', '=', True),
            ('subscription_product_id.active', '=', True)
        ]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_pricing_tier_staff" model="ir.rule">
        <field name="name">Pricing Tier: Staff Access</field>
        <field name="model_id" ref="model_ams_subscription_pricing_tier"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_staff'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <record id="rule_pricing_tier_admin" model="ir.rule">
        <field name="name">Pricing Tier: Admin Access</field>
        <field name="model_id" ref="model_ams_subscription_pricing_tier"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_admin'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Billing Period Rules -->
    <record id="rule_billing_period_user" model="ir.rule">
        <field name="name">Billing Period: User Access</field>
        <field name="model_id" ref="model_ams_billing_period"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_member_user'))]"/>
        <field name="domain_force">[('active', '=', True)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_billing_period_staff" model="ir.rule">
        <field name="name">Billing Period: Staff Access</field>
        <field name="model_id" ref="model_ams_billing_period"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_staff'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_billing_period_admin" model="ir.rule">
        <field name="name">Billing Period: Admin Access</field>
        <field name="model_id" ref="model_ams_billing_period"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_admin'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Product Template Rules for Subscription Features -->
    <record id="rule_product_template_subscription_user" model="ir.rule">
        <field name="name">Product Template: User Subscription Access</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_member_user'))]"/>
        <field name="domain_force">[
            '|',
            ('is_subscription_product', '=', False),
            '&amp;',
            ('is_subscription_product', '=', True),
            ('sale_ok', '=', True)
        ]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Special Rules for Verification and Approval -->
    <record id="rule_pricing_tier_requires_verification" model="ir.rule">
        <field name="name">Pricing Tier: Verification Required</field>
        <field name="model_id" ref="model_ams_subscription_pricing_tier"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_member_user'))]"/>
        <field name="domain_force">[
            '|',
            ('requires_verification', '=', False),
            '&amp;',
            ('requires_verification', '=', True),
            ('approval_required', '=', False)
        ]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Portal User Rules (if portal access is needed) -->
    <record id="rule_subscription_product_portal" model="ir.rule">
        <field name="name">Subscription Product: Portal User Access</field>
        <field name="model_id" ref="model_ams_subscription_product"/>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        <field name="domain_force">[
            ('active', '=', True),
            '|',
            ('member_only', '=', False),
            '&amp;',
            ('member_only', '=', True),
            ('id', '=', False)
        ]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_pricing_tier_portal" model="ir.rule">
        <field name="name">Pricing Tier: Portal User Access</field>
        <field name="model_id" ref="model_ams_subscription_pricing_tier"/>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        <field name="domain_force">[
            ('active', '=', True),
            ('is_current', '=', True),
            ('subscription_product_id.active', '=', True),
            ('subscription_product_id.member_only', '=', False),
            ('requires_verification', '=', False),
            ('approval_required', '=', False)
        ]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- System Administrator Rules (unrestricted access) -->
    <record id="rule_subscription_product_system_admin" model="ir.rule">
        <field name="name">Subscription Product: System Admin</field>
        <field name="model_id" ref="model_ams_subscription_product"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_system_admin'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <record id="rule_pricing_tier_system_admin" model="ir.rule">
        <field name="name">Pricing Tier: System Admin</field>
        <field name="model_id" ref="model_ams_subscription_pricing_tier"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_system_admin'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <record id="rule_billing_period_system_admin" model="ir.rule">
        <field name="name">Billing Period: System Admin</field>
        <field name="model_id" ref="model_ams_billing_period"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_system_admin'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Archive/Active State Rules -->
    <record id="rule_subscription_product_archived" model="ir.rule">
        <field name="name">Subscription Product: Hide Archived for Users</field>
        <field name="model_id" ref="model_ams_subscription_product"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_member_user')), (4, ref('base.group_portal'))]"/>
        <field name="domain_force">[('active', '=', True)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Time-based Rules for Pricing Tiers - FIXED -->
    <record id="rule_pricing_tier_current_only" model="ir.rule">
        <field name="name">Pricing Tier: Current Only for Users</field>
        <field name="model_id" ref="model_ams_subscription_pricing_tier"/>
        <field name="groups" eval="[(4, ref('ams_subscription_management.group_ams_member_user')), (4, ref('base.group_portal'))]"/>
        <field name="domain_force">[('is_current', '=', True)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

</odoo>