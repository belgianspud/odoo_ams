<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- AMS Subscription Product List View -->
    <record id="view_ams_subscription_product_list" model="ir.ui.view">
        <field name="name">ams.subscription.product.list</field>
        <field name="model">ams.subscription.product</field>
        <field name="arch" type="xml">
            <list string="Subscription Products" default_order="product_type,subscription_scope,name">
                <field name="name"/>
                <field name="code"/>
                <field name="product_type"/>
                <field name="subscription_scope"/>
                <field name="duration_display"/>
                <field name="default_price" widget="monetary"/>
                <field name="pricing_tier_count"/>
                <field name="is_renewable"/>
                <field name="auto_renewal_enabled"/>
                <field name="requires_approval"/>
                <field name="member_only"/>
                <field name="active"/>
                <field name="currency_id" invisible="1"/>
            </list>
        </field>
    </record>

    <!-- AMS Subscription Product Form View -->
    <record id="view_ams_subscription_product_form" model="ir.ui.view">
        <field name="name">ams.subscription.product.form</field>
        <field name="model">ams.subscription.product</field>
        <field name="arch" type="xml">
            <form string="Subscription Product">
                <header>
                    <button name="action_manage_pricing_tiers" string="Manage Pricing Tiers" 
                            type="object" class="oe_highlight"/>
                    <button name="action_view_product" string="View Base Product" 
                            type="object"/>
                </header>
                
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_product" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-cube">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Base Product</span>
                            </div>
                        </button>
                        
                        <button name="action_manage_pricing_tiers" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-tags">
                            <field name="pricing_tier_count" widget="statinfo" string="Pricing Tiers"/>
                        </button>
                    </div>

                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger"
                            invisible="active == True"/>

                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Subscription Product Name..."/>
                        </h1>
                        <div class="o_row">
                            <field name="code" placeholder="Unique Code"/>
                        </div>
                    </div>
                    
                    <group>
                        <group string="Basic Information">
                            <field name="product_id" options="{'no_create': True}"/>
                            <field name="subscription_scope"/>
                            <field name="product_type"/>
                            <field name="active"/>
                        </group>
                        <group string="Duration &amp; Pricing">
                            <label for="default_duration" string="Duration"/>
                            <div class="o_row">
                                <field name="default_duration"/>
                                <field name="duration_unit"/>
                            </div>
                            <field name="duration_display" readonly="1"/>
                            <field name="currency_id" invisible="1"/>
                            <field name="default_price" widget="monetary"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Configuration" name="configuration">
                            <group>
                                <group string="Renewal Settings">
                                    <field name="is_renewable"/>
                                    <field name="renewal_window_days" 
                                           invisible="not is_renewable"/>
                                    <field name="auto_renewal_enabled" 
                                           invisible="not is_renewable"/>
                                </group>
                                <group string="Access Control">
                                    <field name="requires_approval"/>
                                    <field name="member_only"/>
                                </group>
                            </group>
                        </page>

                        <page string="Enterprise Features" name="enterprise"
                              invisible="subscription_scope != 'enterprise'">
                            <group>
                                <group string="Seat Management">
                                    <field name="default_seat_count"/>
                                    <field name="allow_seat_purchase"/>
                                    <field name="seat_product_id" 
                                           domain="[('subscription_scope', '=', 'individual')]"
                                           invisible="not allow_seat_purchase"/>
                                </group>
                            </group>
                            
                            <div class="alert alert-info mt16" role="alert">
                                <h6><i class="fa fa-info-circle"/> Enterprise Subscription Features</h6>
                                <ul class="mb-0">
                                    <li><strong>Default Seats:</strong> Number of seats included in base subscription</li>
                                    <li><strong>Additional Seats:</strong> Allow purchasing extra seats beyond the default allocation</li>
                                    <li><strong>Seat Product:</strong> Product used for purchasing additional individual seats</li>
                                </ul>
                            </div>
                        </page>

                        <page string="Pricing Tiers" name="pricing_tiers">
                            <div class="row">
                                <div class="col-md-6">
                                    <group string="Pricing Overview">
                                        <field name="has_member_pricing" readonly="1"/>
                                        <field name="pricing_tier_count" readonly="1"/>
                                        <field name="min_member_price" widget="monetary" 
                                               invisible="not has_member_pricing"/>
                                        <field name="max_member_price" widget="monetary" 
                                               invisible="not has_member_pricing"/>
                                    </group>
                                </div>
                                <div class="col-md-6">
                                    <div class="alert alert-success" invisible="not has_member_pricing">
                                        <h6><i class="fa fa-check"/> Member Pricing Configured</h6>
                                        <p>This subscription has member-specific pricing tiers configured.</p>
                                    </div>
                                    <div class="alert alert-warning" invisible="has_member_pricing">
                                        <h6><i class="fa fa-exclamation-triangle"/> No Member Pricing</h6>
                                        <p>All members will pay the default price. Click "Manage Pricing Tiers" to set up member-specific pricing.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <field name="pricing_tier_ids" nolabel="1">
                                <list string="Member Pricing Tiers" editable="bottom">
                                    <field name="member_type_id" 
                                           domain="[('is_individual', '=', True)]" 
                                           invisible="parent.subscription_scope == 'enterprise'"/>
                                    <field name="member_type_id" 
                                           domain="[('is_organization', '=', True)]" 
                                           invisible="parent.subscription_scope == 'individual'"/>
                                    <field name="price" widget="monetary"/>
                                    <field name="discount_percentage" widget="percentage" readonly="1"/>
                                    <field name="valid_from"/>
                                    <field name="valid_to"/>
                                    <field name="requires_verification"/>
                                    <field name="is_currently_active" readonly="1"/>
                                    <field name="currency_id" invisible="1"/>
                                </list>
                            </field>
                            
                            <div class="mt16">
                                <button name="action_manage_pricing_tiers" string="Advanced Pricing Management" 
                                        type="object" class="btn-primary"/>
                            </div>
                        </page>

                        <page string="Benefits" name="benefits">
                            <div class="alert alert-info" role="alert">
                                <h6><i class="fa fa-info-circle"/> Subscription Benefits</h6>
                                <p>Benefits and features included with this subscription can be configured here.</p>
                            </div>
                            
                            <field name="benefit_assignment_ids" nolabel="1">
                                <list string="Included Benefits" editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="name"/>
                                    <field name="benefit_type"/>
                                    <field name="description"/>
                                    <field name="monetary_value" widget="monetary"/>
                                    <field name="is_currently_available"/>
                                    <field name="active"/>
                                    <field name="currency_id" invisible="1"/>
                                </list>
                                <form string="Benefit">
                                    <sheet>
                                        <group>
                                            <group>
                                                <field name="name"/>
                                                <field name="benefit_type"/>
                                                <field name="sequence"/>
                                            </group>
                                            <group>
                                                <field name="monetary_value" widget="monetary"/>
                                                <field name="discount_percentage" 
                                                       invisible="benefit_type != 'discount'"/>
                                                <field name="active"/>
                                            </group>
                                        </group>
                                        <group string="Description">
                                            <field name="description" nolabel="1"/>
                                        </group>
                                        <group string="Availability">
                                            <group>
                                                <field name="available_from"/>
                                                <field name="available_until"/>
                                            </group>
                                            <group>
                                                <field name="usage_limit"/>
                                                <field name="usage_period"/>
                                            </group>
                                        </group>
                                        <group string="Digital Access" 
                                               invisible="benefit_type != 'digital'">
                                            <field name="digital_access_url"/>
                                            <field name="access_code_required"/>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                        </page>

                        <page string="Description" name="description">
                            <field name="description" widget="html" 
                                   placeholder="Detailed subscription description for marketing and member information..."/>
                        </page>
                    </notebook>
                </sheet>
                
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- AMS Subscription Product Kanban View -->
    <record id="view_ams_subscription_product_kanban" model="ir.ui.view">
        <field name="name">ams.subscription.product.kanban</field>
        <field name="model">ams.subscription.product</field>
        <field name="arch" type="xml">
            <kanban default_order="product_type,subscription_scope">
                <field name="name"/>
                <field name="code"/>
                <field name="product_type"/>
                <field name="subscription_scope"/>
                <field name="default_price"/>
                <field name="currency_id"/>
                <field name="duration_display"/>
                <field name="has_member_pricing"/>
                <field name="pricing_tier_count"/>
                <field name="is_renewable"/>
                <field name="auto_renewal_enabled"/>
                <field name="requires_approval"/>
                <field name="member_only"/>
                <field name="active"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_dropdown_kanban dropdown">
                                <a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" data-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                    <span class="fa fa-ellipsis-v"/>
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <a t-if="widget.editable" role="menuitem" type="edit" class="dropdown-item">Edit</a>
                                    <a role="menuitem" type="object" name="action_manage_pricing_tiers" class="dropdown-item">Manage Pricing</a>
                                    <a role="menuitem" type="object" name="action_view_product" class="dropdown-item">View Product</a>
                                    <div class="dropdown-divider"/>
                                    <a t-if="widget.deletable" role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                </div>
                            </div>
                            
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <div class="o_kanban_record_subtitle text-muted">
                                            <field name="code"/>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="o_kanban_record_body">
                                    <div class="o_kanban_tags_section">
                                        <span class="badge badge-primary">
                                            <t t-esc="record.product_type.value"/>
                                        </span>
                                        <span t-attf-class="badge badge-#{record.subscription_scope.raw_value === 'individual' ? 'info' : 'warning'}">
                                            <t t-esc="record.subscription_scope.value"/>
                                        </span>
                                        <t t-if="record.requires_approval.raw_value">
                                            <span class="badge badge-secondary">Approval Required</span>
                                        </t>
                                        <t t-if="record.member_only.raw_value">
                                            <span class="badge badge-success">Members Only</span>
                                        </t>
                                        <t t-if="record.auto_renewal_enabled.raw_value">
                                            <span class="badge badge-info">Auto-Renew</span>
                                        </t>
                                    </div>
                                    
                                    <div class="o_kanban_record_details mt8">
                                        <div class="o_kanban_record_pricing">
                                            <strong class="text-primary">
                                                <field name="currency_id" invisible="1"/>
                                                <t t-esc="record.currency_id.value"/>
                                                <t t-esc="record.default_price.value"/>
                                            </strong>
                                            <span class="text-muted">
                                                / <t t-esc="record.duration_display.value"/>
                                            </span>
                                        </div>
                                        
                                        <t t-if="record.has_member_pricing.raw_value">
                                            <div class="text-success small">
                                                <i class="fa fa-tags"/> 
                                                <t t-esc="record.pricing_tier_count.value"/> pricing tiers
                                            </div>
                                        </t>
                                        
                                        <t t-if="record.subscription_scope.raw_value === 'enterprise'">
                                            <div class="text-info small">
                                                <i class="fa fa-users"/> Enterprise subscription
                                            </div>
                                        </t>
                                    </div>
                                </div>
                                
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <t t-if="record.is_renewable.raw_value">
                                            <span class="text-success">
                                                <i class="fa fa-refresh"/> Renewable
                                            </span>
                                        </t>
                                        <t t-if="!record.is_renewable.raw_value">
                                            <span class="text-muted">
                                                <i class="fa fa-clock-o"/> One-time
                                            </span>
                                        </t>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <t t-if="!record.active.raw_value">
                                            <span class="badge badge-danger">Archived</span>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- AMS Subscription Product Search View -->
    <record id="view_ams_subscription_product_search" model="ir.ui.view">
        <field name="name">ams.subscription.product.search</field>
        <field name="model">ams.subscription.product</field>
        <field name="arch" type="xml">
            <search string="Search Subscription Products">
                <field name="name"/>
                <field name="code"/>
                <field name="product_id"/>
                <field name="description"/>

                <!-- Filter by product type -->
                <filter string="Membership" name="membership" 
                        domain="[('product_type', '=', 'membership')]"/>
                <filter string="Chapter" name="chapter" 
                        domain="[('product_type', '=', 'chapter')]"/>
                <filter string="Committee" name="committee" 
                        domain="[('product_type', '=', 'committee')]"/>
                <filter string="Publication" name="publication" 
                        domain="[('product_type', '=', 'publication')]"/>
                
                <separator/>
                
                <!-- Filter by subscription scope -->
                <filter string="Individual" name="individual" 
                        domain="[('subscription_scope', '=', 'individual')]"/>
                <filter string="Enterprise" name="enterprise" 
                        domain="[('subscription_scope', '=', 'enterprise')]"/>
                
                <separator/>
                
                <!-- Filter by features -->
                <filter string="Has Member Pricing" name="has_member_pricing" 
                        domain="[('has_member_pricing', '=', True)]"/>
                <filter string="Auto-Renewable" name="auto_renewable" 
                        domain="[('auto_renewal_enabled', '=', True)]"/>
                <filter string="Requires Approval" name="requires_approval" 
                        domain="[('requires_approval', '=', True)]"/>
                <filter string="Members Only" name="members_only" 
                        domain="[('member_only', '=', True)]"/>
                
                <separator/>
                
                <!-- Filter by duration -->
                <filter string="Monthly" name="monthly" 
                        domain="[('default_duration', '=', 1), ('duration_unit', '=', 'months')]"/>
                <filter string="Quarterly" name="quarterly" 
                        domain="[('default_duration', '=', 3), ('duration_unit', '=', 'months')]"/>
                <filter string="Annual" name="annual" 
                        domain="[('default_duration', '=', 12), ('duration_unit', '=', 'months')]"/>
                <filter string="Multi-Year" name="multi_year" 
                        domain="[('duration_unit', '=', 'years')]"/>
                
                <separator/>
                
                <!-- Standard filters -->
                <filter string="Active" name="active" 
                        domain="[('active', '=', True)]"/>
                <filter string="Archived" name="inactive" 
                        domain="[('active', '=', False)]"/>

                <!-- Group by options -->
                <group expand="0" string="Group By">
                    <filter string="Product Type" name="group_by_type" 
                            context="{'group_by': 'product_type'}"/>
                    <filter string="Subscription Scope" name="group_by_scope" 
                            context="{'group_by': 'subscription_scope'}"/>
                    <filter string="Duration Unit" name="group_by_duration" 
                            context="{'group_by': 'duration_unit'}"/>
                    <filter string="Currency" name="group_by_currency" 
                            context="{'group_by': 'currency_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Main AMS Subscription Product Action -->
    <record id="action_ams_subscription_product" model="ir.actions.act_window">
        <field name="name">Subscription Products</field>
        <field name="res_model">ams.subscription.product</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first subscription product configuration
            </p>
            <p>
                Subscription products define the core configuration for membership 
                subscriptions, including pricing tiers, renewal settings, and access control.
            </p>
            <p>
                Start by enabling the "Subscription" toggle on any product, or create 
                subscription products directly here.
            </p>
        </field>
    </record>

    <!-- Specific subscription type actions -->
    <record id="action_membership_subscriptions" model="ir.actions.act_window">
        <field name="name">Membership Subscriptions</field>
        <field name="res_model">ams.subscription.product</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('product_type', '=', 'membership')]</field>
        <field name="context">{
            'search_default_active': 1,
            'search_default_membership': 1,
            'default_product_type': 'membership'
        }</field>
    </record>

    <record id="action_enterprise_subscriptions" model="ir.actions.act_window">
        <field name="name">Enterprise Subscriptions</field>
        <field name="res_model">ams.subscription.product</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('subscription_scope', '=', 'enterprise')]</field>
        <field name="context">{
            'search_default_active': 1,
            'search_default_enterprise': 1,
            'default_subscription_scope': 'enterprise'
        }</field>
    </record>

    <record id="action_publication_subscriptions" model="ir.actions.act_window">
        <field name="name">Publication Subscriptions</field>
        <field name="res_model">ams.subscription.product</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('product_type', '=', 'publication')]</field>
        <field name="context">{
            'search_default_active': 1,
            'search_default_publication': 1,
            'default_product_type': 'publication'
        }</field>
    </record>

    <!-- Menu items under Subscription Products -->
    <menuitem id="menu_subscription_product_management" 
              name="Subscription Management" 
              parent="ams_products_base.menu_ams_products_main"
              action="action_ams_subscription_product" 
              sequence="55"/>

    <menuitem id="menu_membership_subscriptions_mgmt" 
              name="Memberships" 
              parent="menu_subscription_product_management"
              action="action_membership_subscriptions" 
              sequence="10"/>

    <menuitem id="menu_enterprise_subscriptions_mgmt" 
              name="Enterprise" 
              parent="menu_subscription_product_management"
              action="action_enterprise_subscriptions" 
              sequence="20"/>

    <menuitem id="menu_publication_subscriptions_mgmt" 
              name="Publications" 
              parent="menu_subscription_product_management"
              action="action_publication_subscriptions" 
              sequence="30"/>

</odoo>