<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Subscription Builder Wizard Form View -->
    <record id="view_subscription_builder_wizard_form" model="ir.ui.view">
        <field name="name">ams.subscription.builder.wizard.form</field>
        <field name="model">ams.subscription.builder.wizard</field>
        <field name="arch" type="xml">
            <form string="Subscription Builder Wizard">
                <header>
                    <!-- Navigation buttons -->
                    <button name="action_previous_step" string="← Previous" 
                            type="object" class="btn-secondary float-left"
                            invisible="current_step == 'basic'"/>
                    
                    <button name="action_next_step" string="Next →" 
                            type="object" class="oe_highlight float-right"
                            invisible="current_step == 'review'"/>
                    
                    <button name="action_create_subscription" string="Create Subscription" 
                            type="object" class="oe_highlight float-right"
                            invisible="current_step != 'review'"/>
                    
                    <!-- Step indicator -->
                    <div class="text-center">
                        <strong>
                            Step <field name="current_step" invisible="1"/>
                            <span invisible="current_step != 'basic'">1</span>
                            <span invisible="current_step != 'pricing'">2</span>
                            <span invisible="current_step != 'enterprise'">3</span>
                            <span invisible="current_step != 'advanced'">4</span>
                            <span invisible="current_step != 'review'">5</span>
                            of <field name="total_steps" readonly="1"/>
                        </strong>
                    </div>
                </header>
                
                <sheet>
                    <!-- Progress bar -->
                    <div class="progress mb-3">
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: 20%" invisible="current_step != 'basic'"></div>
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: 40%" invisible="current_step != 'pricing'"></div>
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: 60%" invisible="current_step != 'enterprise'"></div>
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: 80%" invisible="current_step != 'advanced'"></div>
                        <div class="progress-bar bg-success" role="progressbar" 
                             style="width: 100%" invisible="current_step != 'review'"></div>
                    </div>

                    <!-- Step 1: Basic Information -->
                    <div invisible="current_step != 'basic'">
                        <div class="oe_title">
                            <h2>Basic Subscription Information</h2>
                            <p class="text-muted">Configure the fundamental properties of your subscription product.</p>
                        </div>
                        
                        <group>
                            <group string="Product Selection">
                                <field name="product_id" options="{'no_create': True}" required="1"/>
                                <field name="product_name" readonly="1"/>
                                <field name="base_price" widget="monetary" readonly="1"/>
                                <field name="currency_id" invisible="1"/>
                            </group>
                            <group string="Subscription Details">
                                <field name="subscription_name" placeholder="Auto-generated if empty"/>
                                <field name="subscription_scope" widget="radio"/>
                                <field name="product_type" widget="radio"/>
                            </group>
                        </group>
                        
                        <group>
                            <group string="Duration Configuration">
                                <label for="default_duration"/>
                                <div class="o_row">
                                    <field name="default_duration" class="oe_inline"/>
                                    <field name="duration_unit" class="oe_inline"/>
                                </div>
                                <field name="billing_period_id" options="{'no_create': True}"/>
                                <field name="is_renewable"/>
                            </group>
                        </group>
                        
                        <div class="alert alert-info mt-3">
                            <strong>Smart Configuration:</strong> The wizard has automatically suggested settings based on your product name and type. 
                            You can modify these settings as needed.
                        </div>
                    </div>

                    <!-- Step 2: Pricing Setup -->
                    <div invisible="current_step != 'pricing'">
                        <div class="oe_title">
                            <h2>Pricing Configuration</h2>
                            <p class="text-muted">Set up your subscription pricing strategy and member discounts.</p>
                        </div>
                        
                        <group>
                            <group string="Pricing Strategy">
                                <field name="pricing_strategy" widget="radio"/>
                                <field name="default_price" widget="monetary" required="1"/>
                                <field name="currency_id" invisible="1"/>
                            </group>
                        </group>
                        
                        <div invisible="pricing_strategy not in ['member_tiers', 'promotional']">
                            <h4>Member Pricing Tiers</h4>
                            <group>
                                <group string="Student Pricing">
                                    <field name="enable_student_pricing"/>
                                    <field name="student_discount_percentage" widget="percentage"
                                           invisible="not enable_student_pricing"/>
                                </group>
                                <group string="Senior Pricing">
                                    <field name="enable_senior_pricing"/>
                                    <field name="senior_discount_percentage" widget="percentage"
                                           invisible="not enable_senior_pricing"/>
                                </group>
                            </group>
                            <group>
                                <group string="International Pricing">
                                    <field name="enable_international_pricing"/>
                                    <field name="international_discount_percentage" widget="percentage"
                                           invisible="not enable_international_pricing"/>
                                </group>
                            </group>
                        </div>
                        
                        <div class="alert alert-warning mt-3" invisible="pricing_strategy != 'simple'">
                            <strong>Simple Pricing:</strong> All customers will pay the same price. 
                            You can add member pricing tiers later if needed.
                        </div>
                        
                        <div class="mt-3" invisible="not enable_student_pricing and not enable_senior_pricing and not enable_international_pricing">
                            <h5>Pricing Preview</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Member Type</th>
                                        <th>Price</th>
                                        <th>Discount</th>
                                        <th>Savings</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Standard</td>
                                        <td><field name="default_price" widget="monetary" readonly="1" nolabel="1"/></td>
                                        <td>-</td>
                                        <td>-</td>
                                    </tr>
                                    <tr invisible="not enable_student_pricing">
                                        <td>Student</td>
                                        <td>
                                            <span t-esc="'%.2f' % (default_price * (1 - student_discount_percentage / 100))"/>
                                            <field name="currency_id" readonly="1" nolabel="1" widget="monetary" invisible="1"/>
                                        </td>
                                        <td><field name="student_discount_percentage" widget="percentage" readonly="1" nolabel="1"/></td>
                                        <td class="text-success">
                                            <span t-esc="'%.2f' % (default_price * student_discount_percentage / 100)"/>
                                        </td>
                                    </tr>
                                    <tr invisible="not enable_senior_pricing">
                                        <td>Senior</td>
                                        <td>
                                            <span t-esc="'%.2f' % (default_price * (1 - senior_discount_percentage / 100))"/>
                                        </td>
                                        <td><field name="senior_discount_percentage" widget="percentage" readonly="1" nolabel="1"/></td>
                                        <td class="text-success">
                                            <span t-esc="'%.2f' % (default_price * senior_discount_percentage / 100)"/>
                                        </td>
                                    </tr>
                                    <tr invisible="not enable_international_pricing">
                                        <td>International</td>
                                        <td>
                                            <span t-esc="'%.2f' % (default_price * (1 - international_discount_percentage / 100))"/>
                                        </td>
                                        <td><field name="international_discount_percentage" widget="percentage" readonly="1" nolabel="1"/></td>
                                        <td class="text-success">
                                            <span t-esc="'%.2f' % (default_price * international_discount_percentage / 100)"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Step 3: Enterprise Settings -->
                    <div invisible="current_step != 'enterprise'">
                        <div class="oe_title">
                            <h2>Enterprise Subscription Settings</h2>
                            <p class="text-muted">Configure seat-based pricing for organization subscriptions.</p>
                        </div>
                        
                        <div class="alert alert-info" invisible="subscription_scope == 'enterprise'">
                            <strong>Individual Subscription:</strong> Enterprise settings are not applicable for individual subscriptions. 
                            Click Next to continue.
                        </div>
                        
                        <div invisible="subscription_scope != 'enterprise'">
                            <group>
                                <group string="Seat Configuration">
                                    <field name="default_seat_count" required="1"/>
                                    <field name="allow_additional_seats"/>
                                    <field name="additional_seat_price" widget="monetary"
                                           invisible="not allow_additional_seats"/>
                                    <field name="max_additional_seats" 
                                           invisible="not allow_additional_seats"/>
                                </group>
                                <group string="Enterprise Pricing">
                                    <div class="text-muted">
                                        <p><strong>Base Package:</strong></p>
                                        <ul>
                                            <li><field name="default_seat_count" readonly="1" nolabel="1"/> seats included</li>
                                            <li>Price: <field name="default_price" widget="monetary" readonly="1" nolabel="1"/></li>
                                            <li>Per seat: <span t-esc="'%.2f' % (default_price / default_seat_count if default_seat_count > 0 else 0)"/></li>
                                        </ul>
                                        
                                        <p invisible="not allow_additional_seats"><strong>Additional Seats:</strong></p>
                                        <ul invisible="not allow_additional_seats">
                                            <li>Price per additional seat: <field name="additional_seat_price" widget="monetary" readonly="1" nolabel="1"/></li>
                                            <li invisible="max_additional_seats == 0">Maximum additional: <field name="max_additional_seats" readonly="1" nolabel="1"/></li>
                                            <li invisible="max_additional_seats != 0">Maximum additional: Unlimited</li>
                                        </ul>
                                    </div>
                                </group>
                            </group>
                            
                            <h5>Enterprise Pricing Examples</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Total Seats</th>
                                        <th>Base Package</th>
                                        <th>Additional Seats</th>
                                        <th>Total Price</th>
                                        <th>Per Seat</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><field name="default_seat_count" readonly="1" nolabel="1"/></td>
                                        <td><field name="default_price" widget="monetary" readonly="1" nolabel="1"/></td>
                                        <td>$0.00</td>
                                        <td><field name="default_price" widget="monetary" readonly="1" nolabel="1"/></td>
                                        <td><span t-esc="'%.2f' % (default_price / default_seat_count if default_seat_count > 0 else 0)"/></td>
                                    </tr>
                                    <tr invisible="not allow_additional_seats">
                                        <td><span t-esc="default_seat_count + 10"/></td>
                                        <td><field name="default_price" widget="monetary" readonly="1" nolabel="1"/></td>
                                        <td><span t-esc="'%.2f' % (additional_seat_price * 10)"/></td>
                                        <td><span t-esc="'%.2f' % (default_price + additional_seat_price * 10)"/></td>
                                        <td><span t-esc="'%.2f' % ((default_price + additional_seat_price * 10) / (default_seat_count + 10))"/></td>
                                    </tr>
                                    <tr invisible="not allow_additional_seats">
                                        <td><span t-esc="default_seat_count + 25"/></td>
                                        <td><field name="default_price" widget="monetary" readonly="1" nolabel="1"/></td>
                                        <td><span t-esc="'%.2f' % (additional_seat_price * 25)"/></td>
                                        <td><span t-esc="'%.2f' % (default_price + additional_seat_price * 25)"/></td>
                                        <td><span t-esc="'%.2f' % ((default_price + additional_seat_price * 25) / (default_seat_count + 25))"/></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Step 4: Advanced Options -->
                    <div invisible="current_step != 'advanced'">
                        <div class="oe_title">
                            <h2>Advanced Subscription Options</h2>
                            <p class="text-muted">Configure access control, approval requirements, and renewal settings.</p>
                        </div>
                        
                        <group>
                            <group string="Access Control">
                                <field name="member_only"/>
                                <field name="eligible_member_types" widget="many2many_tags"
                                       invisible="not member_only"/>
                                <field name="requires_approval"/>
                            </group>
                            <group string="Renewal Settings">
                                <field name="auto_renewal_enabled" invisible="not is_renewable"/>
                                <field name="renewal_window_days" invisible="not is_renewable"/>
                            </group>
                        </group>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">Access Control Summary</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-unstyled mb-0">
                                            <li>
                                                <i class="fa fa-check text-success" invisible="not member_only"/>
                                                <i class="fa fa-times text-muted" invisible="member_only"/>
                                                Members Only Access
                                            </li>
                                            <li>
                                                <i class="fa fa-check text-success" invisible="not requires_approval"/>
                                                <i class="fa fa-times text-muted" invisible="requires_approval"/>
                                                Staff Approval Required
                                            </li>
                                            <li invisible="not member_only or not eligible_member_types">
                                                <i class="fa fa-info text-info"/>
                                                Restricted to specific member types
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">Renewal Summary</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-unstyled mb-0">
                                            <li>
                                                <i class="fa fa-check text-success" invisible="not is_renewable"/>
                                                <i class="fa fa-times text-muted" invisible="is_renewable"/>
                                                Subscription Renewable
                                            </li>
                                            <li invisible="not is_renewable">
                                                <i class="fa fa-check text-success" invisible="not auto_renewal_enabled"/>
                                                <i class="fa fa-times text-muted" invisible="auto_renewal_enabled"/>
                                                Auto-Renewal Available
                                            </li>
                                            <li invisible="not is_renewable">
                                                <i class="fa fa-info text-info"/>
                                                <field name="renewal_window_days" readonly="1" nolabel="1"/> days renewal window
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Review & Create -->
                    <div invisible="current_step != 'review'">
                        <div class="oe_title">
                            <h2>Review &amp; Create Subscription</h2>
                            <p class="text-muted">Review your configuration and create the subscription product.</p>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">Configuration Summary</h6>
                                    </div>
                                    <div class="card-body">
                                        <field name="configuration_summary" readonly="1" nolabel="1"/>
                                    </div>
                                </div>
                                
                                <div class="card mt-3">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">Additional Content</h6>
                                    </div>
                                    <div class="card-body">
                                        <field name="subscription_description" 
                                               placeholder="Optional: Detailed description of subscription benefits..."/>
                                        <field name="terms_and_conditions" 
                                               placeholder="Optional: Subscription-specific terms and conditions..."/>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">Pricing Summary</h6>
                                    </div>
                                    <div class="card-body">
                                        <field name="pricing_summary" readonly="1" nolabel="1"/>
                                    </div>
                                </div>
                                
                                <div class="card mt-3">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">Creation Options</h6>
                                    </div>
                                    <div class="card-body">
                                        <field name="create_immediately"/>
                                        <div class="text-muted mt-2">
                                            <small>
                                                When enabled, the subscription product will be created immediately 
                                                upon clicking "Create Subscription". You can modify settings later 
                                                if needed.
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-success mt-3">
                            <strong>Ready to Create!</strong> Your subscription product is configured and ready to be created. 
                            Click "Create Subscription" to complete the setup.
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Subscription Builder Wizard Action -->
    <record id="action_subscription_builder_wizard" model="ir.actions.act_window">
        <field name="name">Subscription Builder Wizard</field>
        <field name="res_model">ams.subscription.builder.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

</odoo>