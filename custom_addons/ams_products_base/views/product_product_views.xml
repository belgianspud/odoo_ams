<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ========================================================================== -->
    <!-- MINIMAL SAFE AMS PRODUCT VARIANT FORM VIEW -->
    <!-- ========================================================================== -->
    <record id="product_variant_form_view_ams" model="ir.ui.view">
        <field name="name">product.product.form.ams</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_normal_form_view"/>
        <field name="arch" type="xml">
            
            <!-- Add variant AMS fields after default_code -->
            <xpath expr="//field[@name='default_code']" position="after">
                <field name="variant_sku" invisible="not template_is_ams_product" placeholder="Leave blank to auto-generate"/>
                <field name="effective_sku" readonly="1" invisible="not template_is_ams_product"/>
            </xpath>

            <!-- Add simple AMS variant tab -->
            <xpath expr="//notebook" position="inside">
                <page string="AMS Variant Features" name="ams_variant" invisible="not template_is_ams_product">
                    <group>
                        <group string="Variant Configuration">
                            <field name="has_variant_pricing" widget="boolean_toggle"/>
                            <field name="has_variant_digital_content" widget="boolean_toggle"/>
                            <field name="has_variant_inventory_config" widget="boolean_toggle"/>
                        </group>
                        <group string="Template Info">
                            <field name="template_ams_product_type_id" readonly="1"/>
                            <field name="template_has_member_pricing" readonly="1" widget="boolean"/>
                            <field name="template_is_digital_product" readonly="1" widget="boolean"/>
                        </group>
                    </group>
                    
                    <!-- Variant Pricing Section -->
                    <group string="Variant Pricing" invisible="not has_variant_pricing">
                        <group>
                            <field name="variant_member_price" widget="monetary"/>
                            <field name="variant_non_member_price" widget="monetary"/>
                        </group>
                        <group>
                            <field name="final_member_price" readonly="1" widget="monetary"/>
                            <field name="final_non_member_price" readonly="1" widget="monetary"/>
                        </group>
                    </group>
                    
                    <!-- Digital Content Section -->
                    <group string="Variant Digital Content" invisible="not has_variant_digital_content">
                        <group>
                            <field name="variant_digital_url" widget="url"/>
                            <field name="variant_digital_attachment_id"/>
                        </group>
                        <group>
                            <field name="final_digital_url" readonly="1" widget="url"/>
                            <field name="is_digital_content_available" readonly="1" widget="boolean"/>
                        </group>
                    </group>
                    
                    <!-- Inventory Section -->
                    <group string="Variant Inventory" invisible="not has_variant_inventory_config">
                        <group>
                            <field name="variant_stock_controlled" widget="boolean_toggle"/>
                            <field name="variant_reorder_point"/>
                        </group>
                        <group>
                            <field name="current_stock_level" readonly="1"/>
                            <field name="variant_needs_reorder" readonly="1" widget="boolean"/>
                        </group>
                    </group>
                    
                    <!-- System Information -->
                    <group string="System Information" groups="base.group_system">
                        <group>
                            <field name="variant_legacy_id"/>
                            <field name="inventory_status_display" readonly="1"/>
                        </group>
                    </group>
                </page>
            </xpath>
            
        </field>
    </record>

    <!-- ========================================================================== -->
    <!-- ENHANCED PRODUCT VARIANT LIST VIEW -->
    <!-- ========================================================================== -->
    <record id="product_variant_tree_view_ams" model="ir.ui.view">
        <field name="name">product.product.tree.ams</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_product_tree_view"/>
        <field name="arch" type="xml">
            
            <xpath expr="//field[@name='default_code']" position="after">
                <field name="effective_sku" optional="show"/>
                <field name="template_is_ams_product" widget="boolean_toggle" optional="hide"/>
                <field name="has_variant_pricing" widget="boolean_toggle" optional="hide"/>
            </xpath>

            <xpath expr="//field[@name='lst_price']" position="after">
                <field name="final_member_price" optional="hide" widget="monetary" 
                       invisible="not template_has_member_pricing"/>
            </xpath>

        </field>
    </record>

    <!-- ========================================================================== -->
    <!-- ENHANCED PRODUCT VARIANT SEARCH VIEW -->
    <!-- ========================================================================== -->
    <record id="product_variant_search_view_ams" model="ir.ui.view">
        <field name="name">product.product.search.ams</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_search_form_view"/>
        <field name="arch" type="xml">
            
            <xpath expr="//field[@name='name']" position="after">
                <field name="effective_sku" filter_domain="[('effective_sku', 'ilike', self)]"/>
                <field name="variant_sku" filter_domain="[('variant_sku', 'ilike', self)]"/>
            </xpath>

            <xpath expr="//filter[@name='filter_to_sell']" position="after">
                <separator/>
                <filter name="ams_variants" string="AMS Product Variants" 
                        domain="[('template_is_ams_product', '=', True)]"/>
                <filter name="variant_pricing" string="Variant Pricing" 
                        domain="[('has_variant_pricing', '=', True)]"/>
                <filter name="digital_variants" string="Digital Variants" 
                        domain="[('template_is_digital_product', '=', True)]"/>
            </xpath>
            
        </field>
    </record>

    <!-- ========================================================================== -->
    <!-- BASIC AMS VARIANT ACTIONS -->
    <!-- ========================================================================== -->
    <record id="action_ams_product_variants" model="ir.actions.act_window">
        <field name="name">AMS Product Variants</field>
        <field name="res_model">product.product</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('template_is_ams_product', '=', True)]</field>
        <field name="context">{'search_default_ams_variants': 1}</field>
    </record>

    <record id="action_variant_pricing_products" model="ir.actions.act_window">
        <field name="name">Variant Pricing Products</field>
        <field name="res_model">product.product</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('has_variant_pricing', '=', True)]</field>
    </record>

</odoo>