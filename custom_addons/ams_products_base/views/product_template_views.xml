<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ========================================================================== -->
    <!-- SIMPLIFIED AMS PRODUCT TEMPLATE FORM VIEW -->
    <!-- ========================================================================== -->
    <record id="product_template_form_view_ams_simple" model="ir.ui.view">
        <field name="name">product.template.form.ams.simple</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            
            <!-- Add AMS indicator and category info after category -->
            <xpath expr="//field[@name='categ_id']" position="after">
                <field name="is_ams_product" readonly="1" widget="boolean_toggle"/>
                <field name="ams_category_display" readonly="1" invisible="not is_ams_product"/>
            </xpath>
            
            <!-- Add member pricing after list price -->
            <xpath expr="//field[@name='list_price']" position="after">
                <field name="member_price" readonly="1" widget="monetary"
                       invisible="not is_ams_product or not categ_id.requires_member_pricing"
                       string="Member Price"/>
                <field name="member_savings" readonly="1" widget="monetary"
                       invisible="not is_ams_product or not categ_id.requires_member_pricing or member_savings == 0"
                       string="Member Saves"/>
            </xpath>
            
            <!-- Add simplified AMS tab -->
            <xpath expr="//notebook" position="inside">
                <page string="AMS Integration" name="ams_integration" invisible="not is_ams_product">
                    
                    <!-- Category Information (Read-only) -->
                    <group string="Category Configuration" name="category_config">
                        <group>
                            <field name="categ_id" readonly="1"/>
                            <field name="ams_category_display" readonly="1"/>
                            <field name="requires_membership" readonly="1" widget="boolean"/>
                        </group>
                        <group>
                            <div class="alert alert-info" role="alert">
                                <strong><i class="fa fa-info-circle"></i> Configuration inherited from category:</strong>
                                <ul class="mb-1">
                                    <li invisible="not categ_id.requires_member_pricing">Member pricing available</li>
                                    <li invisible="not categ_id.is_digital_category">Digital product delivery</li>
                                    <li invisible="not categ_id.is_subscription_category">Subscription/recurring billing</li>
                                    <li invisible="not categ_id.requires_inventory">Inventory tracking required</li>
                                    <li invisible="not categ_id.grants_portal_access">Grants portal access</li>
                                </ul>
                            </div>
                        </group>
                    </group>
                    
                    <!-- Member Pricing Details -->
                    <group string="Member Pricing" name="member_pricing" 
                           invisible="not categ_id.requires_member_pricing">
                        <group>
                            <field name="list_price" readonly="1" string="Regular Price"/>
                            <field name="member_price" readonly="1"/>
                            <field name="member_savings" readonly="1"/>
                        </group>
                        <group>
                            <field name="pricing_summary" readonly="1" 
                                   widget="text" string="Pricing Summary"/>
                            <div class="text-muted">
                                <small>Member pricing is calculated from the category's discount percentage.</small>
                            </div>
                        </group>
                    </group>
                    
                    <!-- Digital Content -->
                    <group string="Digital Content" name="digital_content"
                           invisible="not categ_id.is_digital_category">
                        <group>
                            <field name="digital_url" widget="url" placeholder="https://example.com/download"/>
                            <field name="digital_attachment_id"/>
                        </group>
                        <group>
                            <field name="has_digital_content" readonly="1" widget="boolean"/>
                            <div class="alert alert-warning" role="alert" invisible="has_digital_content">
                                <strong><i class="fa fa-exclamation-triangle"></i> Missing Digital Content</strong><br/>
                                Please add either a download URL or file attachment for digital delivery.
                            </div>
                            <div class="alert alert-success" role="alert" invisible="not has_digital_content">
                                <strong><i class="fa fa-check-circle"></i> Digital Content Ready</strong><br/>
                                This product is ready for digital delivery.
                            </div>
                        </group>
                    </group>
                    
                    <!-- System Information -->
                    <group string="System Information" name="system_info">
                        <group>
                            <field name="default_code" string="SKU"/>
                            <field name="legacy_product_id" placeholder="Legacy system ID"/>
                        </group>
                        <group>
                            <button name="action_view_category" type="object" 
                                    string="View Category" class="btn-link"
                                    icon="fa-external-link"/>
                            <button name="action_test_member_pricing" type="object" 
                                    string="Test Member Pricing" class="btn-link"
                                    icon="fa-calculator" groups="base.group_system"/>
                        </group>
                    </group>
                    
                </page>
            </xpath>
            
        </field>
    </record>

    <!-- ========================================================================== -->
    <!-- ENHANCED PRODUCT TEMPLATE LIST VIEW -->
    <!-- ========================================================================== -->
    <record id="product_template_tree_view_ams_simple" model="ir.ui.view">
        <field name="name">product.template.tree.ams.simple</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_tree_view"/>
        <field name="arch" type="xml">
            
            <!-- Add AMS columns after category -->
            <xpath expr="//field[@name='categ_id']" position="after">
                <field name="is_ams_product" string="AMS" widget="boolean_toggle" optional="show"/>
                <field name="ams_category_display" string="AMS Type" optional="show"/>
                <field name="member_price" string="Member Price" optional="hide" widget="monetary"
                       invisible="not categ_id.requires_member_pricing"/>
                <field name="requires_membership" string="Membership Required" widget="boolean_toggle" optional="hide"/>
            </xpath>
            
        </field>
    </record>

    <!-- ========================================================================== -->
    <!-- ENHANCED PRODUCT TEMPLATE SEARCH VIEW -->
    <!-- ========================================================================== -->
    <record id="product_template_search_view_ams_simple" model="ir.ui.view">
        <field name="name">product.template.search.ams.simple</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_search_view"/>
        <field name="arch" type="xml">
            
            <!-- Add AMS search fields -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="default_code" string="SKU" filter_domain="[('default_code', 'ilike', self)]"/>
                <field name="ams_category_display" string="AMS Category"/>
                <field name="legacy_product_id" string="Legacy ID"/>
            </xpath>
            
            <!-- Add AMS filters -->
            <xpath expr="//filter[@name='filter_to_sell']" position="after">
                <separator/>
                <filter name="ams_products" string="AMS Products" 
                        domain="[('is_ams_product', '=', True)]"/>
                <filter name="member_pricing" string="Member Pricing" 
                        domain="[('categ_id.requires_member_pricing', '=', True)]"/>
                <filter name="digital_products" string="Digital Products" 
                        domain="[('categ_id.is_digital_category', '=', True)]"/>
                <filter name="membership_required" string="Membership Required" 
                        domain="[('requires_membership', '=', True)]"/>
                
                <separator/>
                <filter name="missing_digital_content" string="Missing Digital Content" 
                        domain="[('categ_id.is_digital_category', '=', True), ('has_digital_content', '=', False)]"/>
            </xpath>

            <!-- Add AMS grouping -->
            <xpath expr="//group[@expand='0']" position="inside">
                <filter string="AMS Category Type" name="group_ams_category" 
                        context="{'group_by': 'ams_category_display'}"/>
                <filter string="Member Pricing" name="group_member_pricing" 
                        context="{'group_by': 'categ_id.requires_member_pricing'}"/>
            </xpath>
            
        </field>
    </record>

    <!-- ========================================================================== -->
    <!-- AMS PRODUCT ACTIONS -->
    <!-- ========================================================================== -->
    
    <!-- Main AMS Products Action -->
    <record id="action_ams_products_simple" model="ir.actions.act_window">
        <field name="name">AMS Products</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('is_ams_product', '=', True)]</field>
        <field name="context">{'search_default_ams_products': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first AMS product!
            </p>
            <p>
                AMS products automatically inherit configuration from their enhanced categories.
                Simply select an AMS category when creating a product to enable member pricing,
                digital delivery, and other association-specific features.
            </p>
        </field>
    </record>

    <!-- Member Pricing Products -->
    <record id="action_member_pricing_products_simple" model="ir.actions.act_window">
        <field name="name">Member Pricing Products</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('categ_id.requires_member_pricing', '=', True)]</field>
        <field name="context">{'search_default_member_pricing': 1}</field>
    </record>

    <!-- Digital Products -->
    <record id="action_digital_products_simple" model="ir.actions.act_window">
        <field name="name">Digital Products</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('categ_id.is_digital_category', '=', True)]</field>
        <field name="context">{'search_default_digital_products': 1}</field>
    </record>

    <!-- Membership Required Products -->
    <record id="action_membership_required_products" model="ir.actions.act_window">
        <field name="name">Membership Required Products</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('requires_membership', '=', True)]</field>
        <field name="context">{'search_default_membership_required': 1}</field>
    </record>

    <!-- Digital Content Issues -->
    <record id="action_digital_content_issues" model="ir.actions.act_window">
        <field name="name">Digital Content Issues</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('categ_id.is_digital_category', '=', True), ('has_digital_content', '=', False)]</field>
        <field name="context">{'search_default_missing_digital_content': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No digital content issues found!
            </p>
            <p>
                This view shows digital products that are missing their download URL 
                or file attachment. All digital products should have content for delivery.
            </p>
        </field>
    </record>

    <!-- ========================================================================== -->
    <!-- SIMPLIFIED PRODUCT CREATION CONTEXT MENUS -->
    <!-- ========================================================================== -->
    
    <!-- Quick create actions for different AMS product types -->
    <record id="action_create_membership_product" model="ir.actions.act_window">
        <field name="name">Create Membership Product</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
        <field name="context">{
            'default_categ_id': %(ams_product_types.category_memberships)d,
            'form_view_ref': 'ams_products_base.product_template_form_view_ams_simple'
        }</field>
    </record>

    <record id="action_create_event_product" model="ir.actions.act_window">
        <field name="name">Create Event Product</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
        <field name="context">{
            'default_categ_id': %(ams_product_types.category_events)d,
            'form_view_ref': 'ams_products_base.product_template_form_view_ams_simple'
        }</field>
    </record>

    <record id="action_create_digital_product" model="ir.actions.act_window">
        <field name="name">Create Digital Product</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
        <field name="context">{
            'default_categ_id': %(ams_product_types.category_digital)d,
            'form_view_ref': 'ams_products_base.product_template_form_view_ams_simple'
        }</field>
    </record>

</odoo>