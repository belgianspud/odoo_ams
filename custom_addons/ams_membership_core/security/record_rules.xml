<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- Portal User Access Rules -->
        <!-- Members can only see their own membership records -->
        <record id="membership_portal_rule" model="ir.rule">
            <field name="name">Portal User: Own Memberships Only</field>
            <field name="model_id" ref="model_ams_membership"/>
            <field name="domain_force">[('partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Members can only see their own subscription records -->
        <record id="subscription_portal_rule" model="ir.rule">
            <field name="name">Portal User: Own Subscriptions Only</field>
            <field name="model_id" ref="model_ams_subscription"/>
            <field name="domain_force">[('partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Members can only see their own renewal records -->
        <record id="renewal_portal_rule" model="ir.rule">
            <field name="name">Portal User: Own Renewals Only</field>
            <field name="model_id" ref="model_ams_renewal"/>
            <field name="domain_force">[('partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Members can see all benefits (but not usage records of others) -->
        <record id="benefit_portal_rule" model="ir.rule">
            <field name="name">Portal User: All Benefits</field>
            <field name="model_id" ref="model_ams_benefit"/>
            <field name="domain_force">[('active', '=', True)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Members can only see their own benefit usage records -->
        <record id="benefit_usage_portal_rule" model="ir.rule">
            <field name="name">Portal User: Own Benefit Usage Only</field>
            <field name="model_id" ref="model_ams_benefit_usage"/>
            <field name="domain_force">[('partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Internal User Access Rules -->
        <!-- Membership users can see all records -->
        <record id="membership_user_rule" model="ir.rule">
            <field name="name">Membership User: All Memberships</field>
            <field name="model_id" ref="model_ams_membership"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="subscription_user_rule" model="ir.rule">
            <field name="name">Membership User: All Subscriptions</field>
            <field name="model_id" ref="model_ams_subscription"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="renewal_user_rule" model="ir.rule">
            <field name="name">Membership User: All Renewals</field>
            <field name="model_id" ref="model_ams_renewal"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="benefit_user_rule" model="ir.rule">
            <field name="name">Membership User: All Benefits</field>
            <field name="model_id" ref="model_ams_benefit"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="benefit_usage_user_rule" model="ir.rule">
            <field name="name">Membership User: All Benefit Usage</field>
            <field name="model_id" ref="model_ams_benefit_usage"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Manager Rules (Full Access) -->
        <record id="membership_manager_rule" model="ir.rule">
            <field name="name">Membership Manager: Full Access</field>
            <field name="model_id" ref="model_ams_membership"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="subscription_manager_rule" model="ir.rule">
            <field name="name">Subscription Manager: Full Access</field>
            <field name="model_id" ref="model_ams_subscription"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="renewal_manager_rule" model="ir.rule">
            <field name="name">Renewal Manager: Full Access</field>
            <field name="model_id" ref="model_ams_renewal"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="benefit_manager_rule" model="ir.rule">
            <field name="name">Benefit Manager: Full Access</field>
            <field name="model_id" ref="model_ams_benefit"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Chapter-Specific Rules -->
        <!-- Chapter users can see all chapter memberships -->
        <record id="chapter_membership_user_rule" model="ir.rule">
            <field name="name">Chapter User: All Chapter Memberships</field>
            <field name="model_id" ref="model_ams_membership"/>
            <field name="domain_force">[('is_chapter_membership', '=', True)]</field>
            <field name="groups" eval="[(4, ref('group_chapter_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Chapter managers have full access to chapter memberships -->
        <record id="chapter_membership_manager_rule" model="ir.rule">
            <field name="name">Chapter Manager: Full Chapter Access</field>
            <field name="model_id" ref="model_ams_membership"/>
            <field name="domain_force">[('is_chapter_membership', '=', True)]</field>
            <field name="groups" eval="[(4, ref('group_chapter_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Specialized Role Rules -->
        <!-- Renewal managers have full access to renewals -->
        <record id="renewal_specialist_rule" model="ir.rule">
            <field name="name">Renewal Manager: Full Renewal Access</field>
            <field name="model_id" ref="model_ams_renewal"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_renewal_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Benefit managers have full access to benefits -->
        <record id="benefit_specialist_rule" model="ir.rule">
            <field name="name">Benefit Manager: Full Benefit Access</field>
            <field name="model_id" ref="model_ams_benefit"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_benefit_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="benefit_usage_specialist_rule" model="ir.rule">
            <field name="name">Benefit Manager: Full Benefit Usage Access</field>
            <field name="model_id" ref="model_ams_benefit_usage"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_benefit_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Subscription Product Access -->
        <!-- All users can see active subscription products -->
        <record id="subscription_product_all_rule" model="ir.rule">
            <field name="name">All Users: Active Subscription Products</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="domain_force">['|', ('is_subscription_product', '=', False), ('active', '=', True)]</field>
            <field name="groups" eval="[(4, ref('base.group_user')), (4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Sales Integration Rules -->
        <!-- Membership users can access sales orders with subscription products -->
        <record id="sale_order_subscription_rule" model="ir.rule">
            <field name="name">Membership User: Subscription Sales Orders</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="domain_force">['|', ('has_membership_products', '=', True), ('has_subscription_products', '=', True), ('has_chapter_products', '=', True)]</field>
            <field name="groups" eval="[(4, ref('group_membership_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Financial Integration Rules -->
        <!-- Subscription billing users can access related invoices -->
        <record id="invoice_subscription_rule" model="ir.rule">
            <field name="name">Subscription Billing: Related Invoices</field>
            <field name="model_id" ref="account.model_account_move"/>
            <field name="domain_force">['|', ('has_subscription_lines', '=', True), ('has_chapter_lines', '=', True)]</field>
            <field name="groups" eval="[(4, ref('group_subscription_billing'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

    </data>
</odoo>