<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Portal User Wizard Form View -->
        <record id="view_portal_user_wizard_form" model="ir.ui.view">
            <field name="name">ams.portal.user.wizard.form</field>
            <field name="model">ams.portal.user.wizard</field>
            <field name="arch" type="xml">
                <form string="Create Portal Users for Members">
                    <sheet>
                        <div class="oe_title">
                            <h1>Create Portal Users</h1>
                            <div class="o_row">
                                <p>Select criteria to create or update portal users for members.</p>
                            </div>
                        </div>
                        
                        <group>
                            <group string="Selection Criteria">
                                <field name="member_type_ids" widget="many2many_tags"/>
                                <field name="member_status"/>
                                <field name="include_existing_users"/>
                                <field name="email_required"/>
                            </group>
                            <group string="Date Filters">
                                <field name="membership_start_after"/>
                                <field name="membership_start_before"/>
                            </group>
                        </group>

                        <group>
                            <group string="Action Options">
                                <field name="send_invitation_emails"/>
                                <field name="reset_existing_passwords" 
                                       invisible="not include_existing_users"/>
                                <field name="update_user_groups"/>
                            </group>
                            <group string="Preview">
                                <field name="eligible_member_count" readonly="True"/>
                                <button name="action_preview_members" 
                                        string="Preview Members" 
                                        type="object" 
                                        class="btn-secondary"
                                        icon="fa-eye"/>
                            </group>
                        </group>

                        <div class="alert alert-info" role="alert" invisible="eligible_member_count == 0">
                            <p><strong>Ready to process <field name="eligible_member_count"/> member(s)</strong></p>
                            <ul>
                                <li t-if="send_invitation_emails">Portal invitation emails will be sent</li>
                                <li t-if="not send_invitation_emails">No invitation emails will be sent</li>
                                <li t-if="reset_existing_passwords and include_existing_users">Existing user passwords will be reset</li>
                                <li t-if="update_user_groups">User security groups will be updated</li>
                            </ul>
                        </div>

                        <div class="alert alert-warning" role="alert" invisible="eligible_member_count > 0">
                            <p><strong>No eligible members found</strong></p>
                            <p>Adjust your selection criteria to find members who need portal users.</p>
                        </div>
                    </sheet>
                    <footer>
                        <button name="action_create_portal_users" 
                                string="Create Portal Users" 
                                type="object" 
                                class="btn-primary"
                                invisible="eligible_member_count == 0"/>
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Portal User Wizard Results View -->
        <record id="view_portal_user_wizard_results" model="ir.ui.view">
            <field name="name">ams.portal.user.wizard.results.form</field>
            <field name="model">ams.portal.user.wizard</field>
            <field name="arch" type="xml">
                <form string="Portal User Creation Results">
                    <sheet>
                        <div class="oe_title">
                            <h1>Portal User Creation Complete</h1>
                        </div>
                        
                        <group>
                            <group string="Results Summary">
                                <field name="created_user_count" readonly="True"/>
                                <field name="updated_user_count" readonly="True"/>
                                <field name="error_count" readonly="True"/>
                            </group>
                            <group>
                                <button name="action_download_log" 
                                        string="Download Log" 
                                        type="object" 
                                        class="btn-primary"
                                        icon="fa-download"/>
                            </group>
                        </group>

                        <separator string="Processing Log"/>
                        <field name="processing_log" readonly="True" nolabel="1"/>
                    </sheet>
                    <footer>
                        <button name="action_close" string="Close" type="object" class="btn-primary"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Portal User Wizard Action -->
        <record id="action_portal_user_wizard" model="ir.actions.act_window">
            <field name="name">Create Portal Users</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">ams.portal.user.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create portal users for members
                </p>
                <p>
                    Use this wizard to batch create or update portal users for your members. 
                    You can filter by member type, status, and dates.
                </p>
            </field>
        </record>

    </data>
</odoo>