<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- ========================================== -->
        <!-- MEMBERSHIP WIZARD VIEWS -->
        <!-- ========================================== -->

        <!-- Membership Wizard Form View -->
        <record id="view_membership_wizard_form" model="ir.ui.view">
            <field name="name">membership.wizard.form</field>
            <field name="model">membership.wizard</field>
            <field name="arch" type="xml">
                <form string="Membership Management Wizard">
                    <sheet>
                        <group>
                            <field name="action_type" widget="radio"/>
                        </group>

                        <group string="Member Information">
                            <group>
                                <field name="partner_id" 
                                       options="{'no_create': True}"
                                       attrs="{'readonly': [('action_type', 'in', ['renew', 'upgrade', 'downgrade'])]}"/>
                                <field name="is_organizational"/>
                                <field name="organization_id" 
                                       attrs="{'invisible': [('is_organizational', '=', False)],
                                               'required': [('is_organizational', '=', True)]}"
                                       options="{'no_create': True}"/>
                            </group>
                            <group>
                                <field name="current_subscription_id" 
                                       readonly="1"
                                       attrs="{'invisible': [('action_type', 'not in', ['renew', 'upgrade', 'downgrade'])]}"/>
                                <field name="current_category_id" 
                                       readonly="1"
                                       attrs="{'invisible': [('action_type', 'not in', ['renew', 'upgrade', 'downgrade'])]}"/>
                            </group>
                        </group>

                        <group string="Membership Details">
                            <group>
                                <field name="available_categories" invisible="1"/>
                                <field name="membership_category_id" 
                                       domain="[('id', 'in', available_categories)]"
                                       options="{'no_create': True}"/>
                                <field name="available_products" invisible="1"/>
                                <field name="product_id" 
                                       domain="[('id', 'in', available_products)]"
                                       options="{'no_create': True}"/>
                                <field name="subscription_product_type" readonly="1"/>
                            </group>
                            <group>
                                <field name="start_date"/>
                                <field name="use_trial" readonly="1"/>
                                <field name="trial_period" 
                                       readonly="1"
                                       attrs="{'invisible': [('use_trial', '=', False)]}"/>
                            </group>
                        </group>

                        <group string="Chapter Membership" 
                               attrs="{'invisible': [('is_chapter_membership', '=', False)]}">
                            <group>
                                <field name="is_chapter_membership" invisible="1"/>
                                <field name="requires_primary_membership" readonly="1"/>
                                <field name="primary_membership_valid" readonly="1"/>
                            </group>
                        </group>

                        <group string="Organizational Settings" 
                               attrs="{'invisible': ['|', ('is_organizational', '=', False), ('action_type', '=', 'add_chapter')]}">
                            <group>
                                <field name="number_of_seats" 
                                       attrs="{'required': [('is_organizational', '=', True)]}"/>
                            </group>
                            <group>
                                <label for="seat_members_ids"/>
                                <field name="seat_members_ids" 
                                       widget="many2many_tags"
                                       options="{'no_create': True}"
                                       nolabel="1"/>
                            </group>
                        </group>

                        <group string="Pricing">
                            <group>
                                <field name="list_price" readonly="1" widget="monetary"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="discount_percent" readonly="1"/>
                                <field name="discounted_price" readonly="1" widget="monetary"/>
                            </group>
                            <group>
                                <field name="override_price"/>
                                <field name="custom_price" 
                                       widget="monetary"
                                       attrs="{'invisible': [('override_price', '=', False)],
                                               'required': [('override_price', '=', True)]}"/>
                            </group>
                        </group>

                        <group string="Eligibility &amp; Verification" 
                               attrs="{'invisible': [('requires_verification', '=', False)]}">
                            <group>
                                <field name="requires_verification" readonly="1"/>
                                <field name="eligibility_verified" 
                                       attrs="{'required': [('requires_verification', '=', True)]}"/>
                            </group>
                            <group>
                                <field name="verification_notes" 
                                       placeholder="Notes about eligibility verification..."/>
                            </group>
                        </group>

                        <group string="Options">
                            <group>
                                <field name="create_invoice"/>
                                <field name="send_welcome_email"/>
                            </group>
                            <group>
                                <field name="auto_activate"/>
                            </group>
                        </group>

                        <group string="Results" 
                               attrs="{'invisible': [('result_subscription_id', '=', False)]}">
                            <group>
                                <field name="result_subscription_id" readonly="1"/>
                                <field name="result_invoice_id" readonly="1"/>
                            </group>
                        </group>

                    </sheet>

                    <footer>
                        <button string="Create Membership" 
                                name="action_create_membership" 
                                type="object" 
                                class="btn-primary"
                                attrs="{'invisible': [('result_subscription_id', '!=', False)]}"/>
                        <button string="Close" 
                                class="btn-secondary" 
                                special="cancel"
                                attrs="{'invisible': [('result_subscription_id', '=', False)]}"/>
                        <button string="Cancel" 
                                class="btn-secondary" 
                                special="cancel"
                                attrs="{'invisible': [('result_subscription_id', '!=', False)]}"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Membership Wizard Actions -->
        
        <!-- Create Membership Action -->
        <record id="action_create_membership_wizard" model="ir.actions.act_window">
            <field name="name">Create Membership</field>
            <field name="res_model">membership.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{
                'default_action_type': 'create'
            }</field>
        </record>

        <!-- Renew Membership Action -->
        <record id="action_renew_membership_wizard" model="ir.actions.act_window">
            <field name="name">Renew Membership</field>
            <field name="res_model">membership.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="binding_model_id" ref="subscription_management.model_subscription_subscription"/>
            <field name="binding_view_types">form</field>
            <field name="context">{
                'default_action_type': 'renew'
            }</field>
        </record>

        <!-- Upgrade Membership Action -->
        <record id="action_upgrade_membership_wizard" model="ir.actions.act_window">
            <field name="name">Upgrade Membership</field>
            <field name="res_model">membership.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="binding_model_id" ref="subscription_management.model_subscription_subscription"/>
            <field name="binding_view_types">form</field>
            <field name="context">{
                'default_action_type': 'upgrade'
            }</field>
        </record>

        <!-- Add Chapter Membership Action -->
        <record id="action_add_chapter_wizard" model="ir.actions.act_window">
            <field name="name">Add Chapter Membership</field>
            <field name="res_model">membership.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="binding_model_id" ref="base.model_res_partner"/>
            <field name="binding_view_types">form</field>
            <field name="context">{
                'default_action_type': 'add_chapter'
            }</field>
        </record>

    </data>
</odoo>