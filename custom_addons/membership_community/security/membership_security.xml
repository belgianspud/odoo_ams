<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <!-- ========================================== -->
        <!-- MODULE CATEGORY -->
        <!-- ========================================== -->
        
        <record id="module_category_membership" model="ir.module.category">
            <field name="name">Membership</field>
            <field name="description">Manage membership features and access rights</field>
            <field name="sequence">10</field>
        </record>

        <!-- ========================================== -->
        <!-- SECURITY GROUPS -->
        <!-- ========================================== -->

        <!-- Member (Portal User) -->
        <record id="group_membership_member" model="res.groups">
            <field name="name">Member (Portal)</field>
            <field name="category_id" ref="module_category_membership"/>
            <field name="implied_ids" eval="[(4, ref('base.group_portal'))]"/>
            <field name="comment">Portal members can view their own membership information</field>
        </record>

        <!-- Membership User -->
        <record id="group_membership_user" model="res.groups">
            <field name="name">Membership User</field>
            <field name="category_id" ref="module_category_membership"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
            <field name="comment">Can view and create memberships, limited editing</field>
        </record>

        <!-- Membership Manager -->
        <record id="group_membership_manager" model="res.groups">
            <field name="name">Membership Manager</field>
            <field name="category_id" ref="module_category_membership"/>
            <field name="implied_ids" eval="[(4, ref('group_membership_user'))]"/>
            <field name="comment">Full access to membership management</field>
        </record>

        <!-- Organization Admin -->
        <record id="group_organization_admin" model="res.groups">
            <field name="name">Organization Admin</field>
            <field name="category_id" ref="module_category_membership"/>
            <field name="implied_ids" eval="[(4, ref('base.group_portal'))]"/>
            <field name="comment">Portal admins for organizational memberships can manage their organization's seats</field>
        </record>

        <!-- ========================================== -->
        <!-- RECORD RULES - SUBSCRIPTION.SUBSCRIPTION -->
        <!-- ========================================== -->

        <!-- Members can see their own subscriptions -->
        <record id="subscription_subscription_member_rule" model="ir.rule">
            <field name="name">Member: Own Subscriptions</field>
            <field name="model_id" ref="subscription_management.model_subscription_subscription"/>
            <field name="domain_force">[('partner_id.user_ids', 'in', [user.id])]</field>
            <field name="groups" eval="[(4, ref('group_membership_member'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Membership Users can see all subscriptions -->
        <record id="subscription_subscription_user_rule" model="ir.rule">
            <field name="name">User: All Subscriptions</field>
            <field name="model_id" ref="subscription_management.model_subscription_subscription"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Membership Managers have full access -->
        <record id="subscription_subscription_manager_rule" model="ir.rule">
            <field name="name">Manager: All Subscriptions</field>
            <field name="model_id" ref="subscription_management.model_subscription_subscription"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Organization Admins can see their organization's subscriptions -->
        <record id="subscription_subscription_org_admin_rule" model="ir.rule">
            <field name="name">Org Admin: Organization Subscriptions</field>
            <field name="model_id" ref="subscription_management.model_subscription_subscription"/>
            <field name="domain_force">[
                '|',
                    ('partner_id.user_ids', 'in', [user.id]),
                    ('partner_id.parent_id.user_ids', 'in', [user.id])
            ]</field>
            <field name="groups" eval="[(4, ref('group_organization_admin'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ========================================== -->
        <!-- RECORD RULES - MEMBERSHIP.CATEGORY -->
        <!-- ========================================== -->

        <!-- All portal users can see categories -->
        <record id="membership_category_portal_rule" model="ir.rule">
            <field name="name">Portal: View Categories</field>
            <field name="model_id" ref="model_membership_category"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Membership Users can manage categories -->
        <record id="membership_category_user_rule" model="ir.rule">
            <field name="name">User: Manage Categories</field>
            <field name="model_id" ref="model_membership_category"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Membership Managers have full access to categories -->
        <record id="membership_category_manager_rule" model="ir.rule">
            <field name="name">Manager: Full Category Access</field>
            <field name="model_id" ref="model_membership_category"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- RECORD RULES - MEMBERSHIP.FEATURE -->
        <!-- ========================================== -->

        <!-- All portal users can see features -->
        <record id="membership_feature_portal_rule" model="ir.rule">
            <field name="name">Portal: View Features</field>
            <field name="model_id" ref="model_membership_feature"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Membership Managers can manage features -->
        <record id="membership_feature_manager_rule" model="ir.rule">
            <field name="name">Manager: Manage Features</field>
            <field name="model_id" ref="model_membership_feature"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- RECORD RULES - MEMBERSHIP.BENEFIT -->
        <!-- ========================================== -->

        <!-- All portal users can see benefits -->
        <record id="membership_benefit_portal_rule" model="ir.rule">
            <field name="name">Portal: View Benefits</field>
            <field name="model_id" ref="model_membership_benefit"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Membership Managers can manage benefits -->
        <record id="membership_benefit_manager_rule" model="ir.rule">
            <field name="name">Manager: Manage Benefits</field>
            <field name="model_id" ref="model_membership_benefit"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_membership_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ========================================== -->
        <!-- RECORD RULES - RES.PARTNER -->
        <!-- ========================================== -->

        <!-- Members can see their own contact info -->
        <record id="partner_member_rule" model="ir.rule">
            <field name="name">Member: Own Contact</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[
                '|',
                    ('user_ids', 'in', [user.id]),
                    ('id', 'child_of', [user.partner_id.commercial_partner_id.id])
            ]</field>
            <field name="groups" eval="[(4, ref('group_membership_member'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ========================================== -->
        <!-- RECORD RULES - PRODUCT.TEMPLATE -->
        <!-- ========================================== -->

        <!-- Portal users can view membership products -->
        <record id="product_template_portal_rule" model="ir.rule">
            <field name="name">Portal: View Membership Products</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="domain_force">[('is_membership_product', '=', True)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

    </data>
</odoo>