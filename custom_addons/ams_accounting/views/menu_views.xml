<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- AMS Accounting Complete Menu Structure -->
    
    <!-- ========================================== -->
    <!-- ACTIONS - Define all actions first        -->
    <!-- ========================================== -->
    
    <!-- Dashboard Actions -->
    <record id="action_ams_accounting_dashboard" model="ir.actions.act_window">
        <field name="name">AMS Accounting Dashboard</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list</field>
        <field name="domain">[('total_subscription_count', '>', 0)]</field>
        <field name="context">{
            'search_default_ams_customers': 1,
            'group_by': ['ams_payment_status']
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Welcome to AMS Accounting!
            </p>
            <p>Manage subscription accounting, revenue recognition, and financial reporting for your association members.</p>
        </field>
    </record>

    <record id="action_ams_financial_summary_dashboard" model="ir.actions.act_window">
        <field name="name">AMS Financial Summary</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">graph,pivot,list</field>
        <field name="domain">[('total_subscription_count', '>', 0)]</field>
        <field name="context">{
            'group_by': ['ams_payment_status'],
            'search_default_ams_customers': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No customer financial data yet!
            </p>
            <p>Financial analytics and summary data for all AMS customers will appear here.</p>
        </field>
    </record>

    <!-- Customer Management Actions -->
    <record id="action_ams_customers" model="ir.actions.act_window">
        <field name="name">AMS Customers</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('total_subscription_count', '>', 0)]</field>
        <field name="context">{
            'search_default_ams_customers': 1,
            'default_is_company': False,
            'default_customer_rank': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No AMS customers found!
            </p>
            <p>Customers with AMS subscriptions will appear here with their financial information.</p>
        </field>
    </record>

    <record id="action_overdue_customers" model="ir.actions.act_window">
        <field name="name">Overdue Customers</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('ams_payment_status', 'in', ['overdue', 'delinquent', 'suspended'])]</field>
        <field name="context">{
            'search_default_overdue_payment': 1,
            'search_default_delinquent': 1,
            'search_default_suspended': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No overdue customers!
            </p>
            <p>Customers with overdue AMS payments will appear here for collections follow-up.</p>
        </field>
    </record>

    <record id="action_credit_hold_customers" model="ir.actions.act_window">
        <field name="name">Credit Hold Customers</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('credit_hold', '=', True)]</field>
        <field name="context">{'search_default_credit_hold': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No customers on credit hold!
            </p>
            <p>Customers with active credit holds will appear here.</p>
        </field>
    </record>

    <record id="action_high_value_customers" model="ir.actions.act_window">
        <field name="name">High Value AMS Customers</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('ams_ytd_revenue', '>', 500)]</field>
        <field name="context">{
            'search_default_ams_customers': 1,
            'group_by': 'ams_payment_status'
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No high value customers yet!
            </p>
            <p>Customers with high AMS revenue will appear here for special attention.</p>
        </field>
    </record>

    <!-- Revenue Recognition Actions -->
    <record id="action_ams_revenue_recognition" model="ir.actions.act_window">
        <field name="name">Revenue Recognition Schedule</field>
        <field name="res_model">ams.revenue.recognition</field>
        <field name="view_mode">list,form,calendar,graph</field>
        <field name="context">{'search_default_scheduled': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No revenue recognition entries found!
            </p>
            <p>Revenue recognition entries will appear here when subscriptions use deferred revenue accounting.</p>
        </field>
    </record>

    <record id="action_due_revenue_recognition" model="ir.actions.act_window">
        <field name="name">Due Revenue Recognition</field>
        <field name="res_model">ams.revenue.recognition</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('state', '=', 'scheduled'), ('recognition_date', '&lt;=', context_today().strftime('%Y-%m-%d'))]</field>
        <field name="context">{
            'search_default_due_today': 1,
            'search_default_overdue': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No revenue recognition due!
            </p>
            <p>Revenue recognition entries that are due for processing will appear here.</p>
        </field>
    </record>

    <record id="action_revenue_recognition_dashboard" model="ir.actions.act_window">
        <field name="name">Revenue Recognition Dashboard</field>
        <field name="res_model">ams.revenue.recognition</field>
        <field name="view_mode">kanban,list,form,graph,pivot</field>
        <field name="domain">[('state', '=', 'scheduled')]</field>
        <field name="context">{'search_default_scheduled': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No pending revenue recognition!
            </p>
            <p>Scheduled revenue recognition entries will appear here.</p>
        </field>
    </record>

    <!-- Subscription Accounting Actions -->
    <record id="action_subscription_accounting_pending" model="ir.actions.act_window">
        <field name="name">Subscriptions Needing Accounting Setup</field>
        <field name="res_model">ams.subscription</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('accounting_status', '=', 'pending')]</field>
        <field name="context">{'search_default_accounting_pending': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                All subscriptions have accounting configured!
            </p>
            <p>Subscriptions that need accounting configuration will appear here.</p>
        </field>
    </record>

    <record id="action_subscription_accounting_active" model="ir.actions.act_window">
        <field name="name">Active Subscription Accounting</field>
        <field name="res_model">ams.subscription</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('accounting_status', '=', 'active')]</field>
        <field name="context">{
            'search_default_accounting_active': 1,
            'group_by': 'subscription_type_id'
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No active subscription accounting!
            </p>
            <p>Subscriptions with active accounting integration will appear here.</p>
        </field>
    </record>

    <record id="action_subscription_deferred_revenue" model="ir.actions.act_window">
        <field name="name">Subscriptions with Deferred Revenue</field>
        <field name="res_model">ams.subscription</field>
        <field name="view_mode">list,graph,pivot</field>
        <field name="domain">[('deferred_revenue_balance', '>', 0)]</field>
        <field name="context">{
            'search_default_has_deferred_revenue': 1,
            'group_by': ['subscription_type_id', 'accounting_status']
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No deferred revenue found!
            </p>
            <p>Subscriptions with outstanding deferred revenue balances will appear here.</p>
        </field>
    </record>

    <record id="action_subscription_revenue_analytics" model="ir.actions.act_window">
        <field name="name">Subscription Revenue Analytics</field>
        <field name="res_model">ams.subscription</field>
        <field name="view_mode">graph,pivot,list</field>
        <field name="domain">[('total_invoiced', '>', 0)]</field>
        <field name="context">{
            'group_by': ['subscription_type_id', 'accounting_status'],
            'search_default_accounting_active': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No subscription revenue data!
            </p>
            <p>Analytics for subscription revenue and accounting performance will appear here.</p>
        </field>
    </record>

    <!-- Product Account Mapping Actions -->
    <record id="action_product_account_mapping" model="ir.actions.act_window">
        <field name="name">Product Account Mappings</field>
        <field name="res_model">product.account.mapping</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first product account mapping!
            </p>
            <p>Configure how products are automatically mapped to accounting accounts for revenue recognition.</p>
        </field>
    </record>

    <record id="action_subscription_product_mappings" model="ir.actions.act_window">
        <field name="name">Subscription Product Mappings</field>
        <field name="res_model">product.account.mapping</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_subscription_mapping', '=', True)]</field>
        <field name="context">{
            'search_default_subscription_products': 1,
            'search_default_active': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No subscription product mappings found!
            </p>
            <p>Create account mappings for your subscription products to enable automated revenue recognition.</p>
        </field>
    </record>

    <record id="action_deferred_revenue_mappings" model="ir.actions.act_window">
        <field name="name">Deferred Revenue Mappings</field>
        <field name="res_model">product.account.mapping</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('use_deferred_revenue', '=', True)]</field>
        <field name="context">{
            'search_default_deferred_revenue': 1,
            'search_default_active': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No deferred revenue mappings found!
            </p>
            <p>Products with deferred revenue settings will automatically create journal entries.</p>
        </field>
    </record>

    <record id="action_mapping_revenue_analytics" model="ir.actions.act_window">
        <field name="name">Product Revenue Analytics</field>
        <field name="res_model">product.account.mapping</field>
        <field name="view_mode">graph,pivot,list</field>
        <field name="domain">[('total_revenue_ytd', '>', 0)]</field>
        <field name="context">{
            'group_by': ['subscription_type_id', 'product_id'],
            'search_default_has_revenue': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No revenue data available!
            </p>
            <p>Revenue analytics will appear here once products start generating income.</p>
        </field>
    </record>

    <!-- Chart of Accounts Actions -->
    <record id="action_ams_account_chart" model="ir.actions.act_window">
        <field name="name">AMS Charts of Accounts</field>
        <field name="res_model">ams.account.chart</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first AMS chart of accounts!
            </p>
            <p>Define and install charts of accounts specifically designed for Association Management Systems.</p>
        </field>
    </record>

    <record id="action_ams_account_template" model="ir.actions.act_window">
        <field name="name">AMS Account Templates</field>
        <field name="res_model">ams.account.template</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create account templates!
            </p>
            <p>Design account templates that will be used to create actual accounts when installing a chart.</p>
        </field>
    </record>

    <record id="action_ams_accounts" model="ir.actions.act_window">
        <field name="name">AMS Accounts</field>
        <field name="res_model">account.account</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('is_ams_account', '=', True)]</field>
        <field name="context">{'search_default_ams_accounts': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No AMS accounts found!
            </p>
            <p>Install an AMS chart of accounts to get started with subscription revenue tracking.</p>
        </field>
    </record>

    <record id="action_subscription_revenue_accounts" model="ir.actions.act_window">
        <field name="name">Subscription Revenue Accounts</field>
        <field name="res_model">account.account</field>
        <field name="view_mode">list,form,graph,pivot</field>
        <field name="domain">[('ams_account_type', 'in', ['membership_revenue', 'chapter_revenue', 'publication_revenue'])]</field>
        <field name="context">{
            'search_default_subscription_revenue': 1,
            'group_by': ['ams_account_type']
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No subscription revenue accounts found!
            </p>
            <p>Create revenue accounts for tracking membership, chapter, and publication income.</p>
        </field>
    </record>

    <record id="action_deferred_revenue_accounts" model="ir.actions.act_window">
        <field name="name">Deferred Revenue Accounts</field>
        <field name="res_model">account.account</field>
        <field name="view_mode">list,form,graph,pivot</field>
        <field name="domain">[('ams_account_type', '=', 'deferred_revenue')]</field>
        <field name="context">{'search_default_deferred_revenue': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No deferred revenue accounts found!
            </p>
            <p>Create deferred revenue accounts for tracking subscription revenue that will be recognized over time.</p>
        </field>
    </record>

    <!-- Invoice and Sales Actions -->
    <record id="action_ams_subscription_invoices" model="ir.actions.act_window">
        <field name="name">Subscription Invoices</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('subscription_id', '!=', False)]</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No subscription invoices yet!
            </p>
            <p>Invoices related to subscriptions will appear here.</p>
        </field>
    </record>

    <record id="action_ams_renewal_invoices" model="ir.actions.act_window">
        <field name="name">Renewal Invoices</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('is_renewal_invoice', '=', True)]</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No renewal invoices yet!
            </p>
            <p>Invoices for subscription renewals will appear here.</p>
        </field>
    </record>

    <!-- Wizard Actions -->
    <record id="action_quick_mapping_setup" model="ir.actions.act_window">
        <field name="name">Quick Account Mapping Setup</field>
        <field name="res_model">product.account.mapping</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_product_mapping_wizard"/>
        <field name="target">new</field>
        <field name="context">{'default_auto_create_entries': True}</field>
    </record>

    <!-- ========================================== -->
    <!-- MENU STRUCTURE                            -->
    <!-- ========================================== -->
    
    <!-- Main AMS Accounting Menu -->
    <menuitem id="menu_ams_accounting_root" 
              name="Accounting" 
              parent="ams_subscriptions.menu_ams_root" 
              sequence="50"
              groups="base.group_user"/>
    
    <!-- Dashboard Menu -->
    <menuitem id="menu_ams_accounting_dashboard" 
              name="Dashboard" 
              parent="menu_ams_accounting_root" 
              sequence="10"
              action="action_ams_accounting_dashboard"
              groups="base.group_user"/>
    
    <!-- Revenue Management Menu -->
    <menuitem id="menu_ams_revenue_management" 
              name="Revenue Management" 
              parent="menu_ams_accounting_root" 
              sequence="20"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_revenue_recognition" 
              name="Revenue Recognition" 
              parent="menu_ams_revenue_management" 
              sequence="10"
              action="action_ams_revenue_recognition"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_due_revenue_recognition" 
              name="Due Recognition" 
              parent="menu_ams_revenue_management" 
              sequence="20"
              action="action_due_revenue_recognition"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_deferred_revenue" 
              name="Deferred Revenue" 
              parent="menu_ams_revenue_management" 
              sequence="30"
              action="action_subscription_deferred_revenue"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_revenue_analytics" 
              name="Revenue Analytics" 
              parent="menu_ams_revenue_management" 
              sequence="40"
              action="action_subscription_revenue_analytics"
              groups="base.group_user"/>
    
    <!-- Customer Management Menu -->
    <menuitem id="menu_ams_customer_management" 
              name="Customers" 
              parent="menu_ams_accounting_root" 
              sequence="30"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_all_customers" 
              name="All AMS Customers" 
              parent="menu_ams_customer_management" 
              sequence="10"
              action="action_ams_customers"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_overdue_customers" 
              name="Overdue Customers" 
              parent="menu_ams_customer_management" 
              sequence="20"
              action="action_overdue_customers"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_credit_hold_customers" 
              name="Credit Hold" 
              parent="menu_ams_customer_management" 
              sequence="30"
              action="action_credit_hold_customers"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_high_value_customers" 
              name="High Value Customers" 
              parent="menu_ams_customer_management" 
              sequence="40"
              action="action_high_value_customers"
              groups="base.group_user"/>
    
    <!-- Subscription Accounting Menu -->
    <menuitem id="menu_ams_subscription_accounting" 
              name="Subscription Accounting" 
              parent="menu_ams_accounting_root" 
              sequence="40"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_subscription_accounting_active" 
              name="Active Accounting" 
              parent="menu_ams_subscription_accounting" 
              sequence="10"
              action="action_subscription_accounting_active"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_subscription_accounting_pending" 
              name="Pending Setup" 
              parent="menu_ams_subscription_accounting" 
              sequence="20"
              action="action_subscription_accounting_pending"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_subscription_invoices" 
              name="Subscription Invoices" 
              parent="menu_ams_subscription_accounting" 
              sequence="30"
              action="action_ams_subscription_invoices"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_renewal_invoices" 
              name="Renewal Invoices" 
              parent="menu_ams_subscription_accounting" 
              sequence="40"
              action="action_ams_renewal_invoices"
              groups="base.group_user"/>
    
    <!-- Analytics & Reports Menu -->
    <menuitem id="menu_ams_accounting_reports" 
              name="Analytics &amp; Reports" 
              parent="menu_ams_accounting_root" 
              sequence="70"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_financial_summary" 
              name="Financial Summary" 
              parent="menu_ams_accounting_reports" 
              sequence="10"
              action="action_ams_financial_summary_dashboard"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_revenue_recognition_dashboard" 
              name="Revenue Recognition Dashboard" 
              parent="menu_ams_accounting_reports" 
              sequence="20"
              action="action_revenue_recognition_dashboard"
              groups="base.group_user"/>
    
    <menuitem id="menu_ams_mapping_analytics" 
              name="Product Revenue Analytics" 
              parent="menu_ams_accounting_reports" 
              sequence="30"
              action="action_mapping_revenue_analytics"
              groups="base.group_user"/>
    
    <!-- Configuration Menu -->
    <menuitem id="menu_ams_accounting_configuration" 
              name="Configuration" 
              parent="menu_ams_accounting_root" 
              sequence="80"
              groups="account.group_account_manager,base.group_system"/>
    
    <menuitem id="menu_ams_account_mappings" 
              name="Product Account Mappings" 
              parent="menu_ams_accounting_configuration" 
              sequence="10"
              action="action_product_account_mapping"
              groups="account.group_account_manager,base.group_system"/>
    
    <menuitem id="menu_ams_subscription_mappings" 
              name="Subscription Mappings" 
              parent="menu_ams_accounting_configuration" 
              sequence="20"
              action="action_subscription_product_mappings"
              groups="account.group_account_manager,base.group_system"/>
    
    <menuitem id="menu_ams_deferred_mappings" 
              name="Deferred Revenue Mappings" 
              parent="menu_ams_accounting_configuration" 
              sequence="30"
              action="action_deferred_revenue_mappings"
              groups="account.group_account_manager,base.group_system"/>
    
    <menuitem id="menu_ams_quick_mapping_setup" 
              name="Quick Setup Wizard" 
              parent="menu_ams_accounting_configuration" 
              sequence="40"
              action="action_quick_mapping_setup"
              groups="account.group_account_manager,base.group_system"/>
    
    <!-- Chart of Accounts Menu -->
    <menuitem id="menu_ams_chart_of_accounts" 
              name="Chart of Accounts" 
              parent="menu_ams_accounting_configuration" 
              sequence="50"
              groups="account.group_account_manager,base.group_system"/>
    
    <menuitem id="menu_ams_charts" 
              name="AMS Charts" 
              parent="menu_ams_chart_of_accounts" 
              sequence="10"
              action="action_ams_account_chart"
              groups="account.group_account_manager,base.group_system"/>
    
    <menuitem id="menu_ams_chart_templates" 
              name="Chart Templates" 
              parent="menu_ams_chart_of_accounts" 
              sequence="20"
              action="action_ams_account_template"
              groups="account.group_account_manager,base.group_system"/>
    
    <menuitem id="menu_ams_accounts" 
              name="AMS Accounts" 
              parent="menu_ams_chart_of_accounts" 
              sequence="30"
              action="action_ams_accounts"
              groups="account.group_account_user,base.group_system"/>
    
    <menuitem id="menu_ams_revenue_accounts" 
              name="Revenue Accounts" 
              parent="menu_ams_chart_of_accounts" 
              sequence="40"
              action="action_subscription_revenue_accounts"
              groups="account.group_account_user,base.group_system"/>
    
    <menuitem id="menu_ams_deferred_accounts" 
              name="Deferred Revenue Accounts" 
              parent="menu_ams_chart_of_accounts" 
              sequence="50"
              action="action_deferred_revenue_accounts"
              groups="account.group_account_user,base.group_system"/>

</odoo>