<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- ==============================================
         AMS REVENUE RECOGNITION VIEWS
         ============================================== -->
    
    <!-- Revenue Recognition Tree View -->
    <record id="view_ams_revenue_recognition_tree" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.tree</field>
        <field name="model">ams.revenue.recognition</field>
        <field name="arch" type="xml">
            <tree string="Revenue Recognition" 
                  decoration-success="state == 'posted'"
                  decoration-info="state == 'confirmed'"
                  decoration-muted="state == 'draft'"
                  decoration-warning="is_automated == True">
                <field name="name"/>
                <field name="subscription_id"/>
                <field name="partner_id"/>
                <field name="recognition_date"/>
                <field name="period_start"/>
                <field name="period_end"/>
                <field name="recognition_amount" sum="Total Recognition"/>
                <field name="recognition_method"/>
                <field name="state"/>
                <field name="is_automated" invisible="1"/>
                <field name="move_id"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <button name="action_confirm" type="object" 
                        string="Confirm" class="btn-link"
                        attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                <button name="action_post" type="object" 
                        string="Post" class="btn-link"
                        attrs="{'invisible': [('state', '!=', 'confirmed')]}"/>
            </tree>
        </field>
    </record>
    
    <!-- Revenue Recognition Form View -->
    <record id="view_ams_revenue_recognition_form" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.form</field>
        <field name="model">ams.revenue.recognition</field>
        <field name="arch" type="xml">
            <form string="Revenue Recognition">
                <header>
                    <button name="action_confirm" type="object" 
                            class="btn-primary" string="Confirm"
                            attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                    <button name="action_post" type="object" 
                            class="btn-primary" string="Post"
                            attrs="{'invisible': [('state', '!=', 'confirmed')]}"/>
                    <button name="action_cancel" type="object" 
                            class="btn-secondary" string="Cancel"
                            attrs="{'invisible': [('state', 'in', ['posted', 'cancelled'])]}"/>
                    <button name="action_reset_to_draft" type="object" 
                            class="btn-secondary" string="Reset to Draft"
                            attrs="{'invisible': ['|', ('state', '!=', 'cancelled'), ('move_id', '!=', False)]}"/>
                    <field name="state" widget="statusbar" 
                           statusbar_visible="draft,confirmed,posted"/>
                </header>
                
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_journal_entry" type="object" 
                                class="oe_stat_button" icon="fa-book"
                                attrs="{'invisible': [('move_id', '=', False)]}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Journal Entry</span>
                            </div>
                        </button>
                        <button name="action_view_subscription" type="object" 
                                class="oe_stat_button" icon="fa-refresh">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Subscription</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Automated Entry Banner -->
                    <div class="alert alert-info" role="alert" 
                         attrs="{'invisible': [('is_automated', '=', False)]}">
                        <p><strong><i class="fa fa-robot"/> Automated Entry</strong></p>
                        <p>This revenue recognition entry was created automatically by the system.</p>
                    </div>
                    
                    <!-- Manual Entry Banner -->
                    <div class="alert alert-warning" role="alert" 
                         attrs="{'invisible': ['|', ('is_automated', '=', True), ('state', '!=', 'draft')]}">
                        <p><strong><i class="fa fa-hand-paper-o"/> Manual Entry</strong></p>
                        <p>This is a manual revenue recognition entry. Please review carefully before posting.</p>
                    </div>
                    
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group>
                            <field name="subscription_id" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
                                   domain="[('state', '=', 'active')]"/>
                            <field name="partner_id" readonly="1"/>
                            <field name="product_id" readonly="1"/>
                            <field name="company_id" groups="base.group_multi_company" readonly="1"/>
                        </group>
                        <group>
                            <field name="recognition_date" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="is_automated" readonly="1"/>
                            <field name="auto_post" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="move_id" readonly="1"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page name="recognition_details" string="Recognition Details">
                            <group>
                                <group string="Recognition Period">
                                    <field name="period_start" 
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                    <field name="period_end" 
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                    <field name="period_days" readonly="1"/>
                                </group>
                                <group string="Amount Calculation">
                                    <field name="total_subscription_amount" readonly="1"/>
                                    <field name="recognition_amount" 
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                    <field name="recognition_percentage" readonly="1" widget="percentage"/>
                                    <field name="recognition_method" 
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                </group>
                            </group>
                            
                            <separator string="Calculation Details"/>
                            <group>
                                <field name="calculation_details" readonly="1" nolabel="1" widget="html"/>
                            </group>
                        </page>
                        
                        <page name="accounting" string="Accounting">
                            <group>
                                <group string="Accounts">
                                    <field name="revenue_account_id" 
                                           domain="[('account_type', 'in', ['income', 'income_membership', 'income_chapter', 'income_publication']), ('company_id', '=', company_id)]"
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                    <field name="deferred_revenue_account_id" 
                                           domain="[('account_type', '=', 'liability_deferred_revenue'), ('company_id', '=', company_id)]"
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                </group>
                                <group string="Journal Settings">
                                    <field name="journal_id" 
                                           domain="[('company_id', '=', company_id)]"
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                    <field name="journal_entry_date" 
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                </group>
                            </group>
                            
                            <separator string="Journal Entry Preview" 
                                       attrs="{'invisible': [('state', 'in', ['draft'])]}"/>
                            <field name="journal_entry_preview" readonly="1" nolabel="1" widget="html"
                                   attrs="{'invisible': [('state', 'in', ['draft'])]}"/>
                        </page>
                        
                        <page name="schedule" string="Schedule Information"
                              attrs="{'invisible': [('schedule_id', '=', False)]}">
                            <group>
                                <group string="Schedule Details">
                                    <field name="schedule_id" readonly="1"/>
                                    <field name="schedule_line_id" readonly="1"/>
                                    <field name="sequence_number" readonly="1"/>
                                </group>
                                <group string="Schedule Progress">
                                    <field name="is_first_recognition" readonly="1"/>
                                    <field name="is_last_recognition" readonly="1"/>
                                    <field name="total_schedule_amount" readonly="1"/>
                                    <field name="cumulative_recognized_amount" readonly="1"/>
                                </group>
                            </group>
                            
                            <separator string="Related Schedule Entries"/>
                            <field name="related_schedule_entries" readonly="1" nolabel="1">
                                <tree string="Schedule Entries" create="false" edit="false">
                                    <field name="sequence_number"/>
                                    <field name="recognition_date"/>
                                    <field name="period_start"/>
                                    <field name="period_end"/>
                                    <field name="recognition_amount"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                        
                        <page name="history" string="History">
                            <group>
                                <group string="Timestamps">
                                    <field name="create_date" readonly="1"/>
                                    <field name="create_uid" readonly="1"/>
                                    <field name="write_date" readonly="1"/>
                                    <field name="write_uid" readonly="1"/>
                                </group>
                                <group string="State Changes">
                                    <field name="confirmed_date" readonly="1"/>
                                    <field name="confirmed_by" readonly="1"/>
                                    <field name="posted_date" readonly="1"/>
                                    <field name="posted_by" readonly="1"/>
                                </group>
                            </group>
                            
                            <separator string="Processing Notes"/>
                            <field name="processing_notes" nolabel="1" 
                                   attrs="{'readonly': [('state', '=', 'posted')]}"/>
                        </page>
                    </notebook>
                </sheet>
                
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>
    
    <!-- Revenue Recognition Search View -->
    <record id="view_ams_revenue_recognition_search" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.search</field>
        <field name="model">ams.revenue.recognition</field>
        <field name="arch" type="xml">
            <search string="Search Revenue Recognition">
                <field name="name"/>
                <field name="subscription_id"/>
                <field name="partner_id"/>
                <field name="product_id"/>
                <field name="recognition_date"/>
                <field name="company_id" groups="base.group_multi_company"/>
                
                <separator/>
                <filter name="draft" string="Draft" domain="[('state', '=', 'draft')]"/>
                <filter name="confirmed" string="Confirmed" domain="[('state', '=', 'confirmed')]"/>
                <filter name="posted" string="Posted" domain="[('state', '=', 'posted')]"/>
                <filter name="cancelled" string="Cancelled" domain="[('state', '=', 'cancelled')]"/>
                
                <separator/>
                <filter name="automated" string="Automated" domain="[('is_automated', '=', True)]"/>
                <filter name="manual" string="Manual" domain="[('is_automated', '=', False)]"/>
                <filter name="auto_post" string="Auto Post" domain="[('auto_post', '=', True)]"/>
                
                <separator/>
                <filter name="current_month" string="Current Month" 
                        domain="[('recognition_date', '>=', context_today().strftime('%Y-%m-01')), ('recognition_date', '&lt;', (context_today().replace(day=1) + relativedelta(months=1)).strftime('%Y-%m-%d'))]"/>
                <filter name="last_month" string="Last Month" 
                        domain="[('recognition_date', '>=', (context_today().replace(day=1) - relativedelta(months=1)).strftime('%Y-%m-%d')), ('recognition_date', '&lt;', context_today().strftime('%Y-%m-01'))]"/>
                <filter name="current_year" string="Current Year" 
                        domain="[('recognition_date', '>=', context_today().strftime('%Y-01-01')), ('recognition_date', '&lt;=', context_today().strftime('%Y-12-31'))]"/>
                
                <separator/>
                <filter name="due_today" string="Due Today" 
                        domain="[('recognition_date', '=', context_today()), ('state', 'in', ['draft', 'confirmed'])]"/>
                <filter name="overdue" string="Overdue" 
                        domain="[('recognition_date', '&lt;', context_today()), ('state', 'in', ['draft', 'confirmed'])]"/>
                <filter name="upcoming" string="Upcoming (Next 7 Days)" 
                        domain="[('recognition_date', '>=', context_today()), ('recognition_date', '&lt;=', (context_today() + relativedelta(days=7)).strftime('%Y-%m-%d')), ('state', 'in', ['draft', 'confirmed'])]"/>
                
                <group expand="0" string="Group By">
                    <filter name="group_state" string="State" context="{'group_by': 'state'}"/>
                    <filter name="group_recognition_date" string="Recognition Date" context="{'group_by': 'recognition_date'}"/>
                    <filter name="group_subscription" string="Subscription" context="{'group_by': 'subscription_id'}"/>
                    <filter name="group_partner" string="Customer" context="{'group_by': 'partner_id'}"/>
                    <filter name="group_product" string="Product" context="{'group_by': 'product_id'}"/>
                    <filter name="group_method" string="Recognition Method" context="{'group_by': 'recognition_method'}"/>
                    <filter name="group_journal" string="Journal" context="{'group_by': 'journal_id'}"/>
                    <filter name="group_company" string="Company" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Revenue Recognition Calendar View -->
    <record id="view_ams_revenue_recognition_calendar" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.calendar</field>
        <field name="model">ams.revenue.recognition</field>
        <field name="arch" type="xml">
            <calendar string="Revenue Recognition Calendar" 
                      date_start="recognition_date" 
                      color="state" 
                      quick_add="False"
                      event_open_popup="true">
                <field name="name"/>
                <field name="subscription_id"/>
                <field name="recognition_amount"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>
    
    <!-- Revenue Recognition Kanban View -->
    <record id="view_ams_revenue_recognition_kanban" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.kanban</field>
        <field name="model">ams.revenue.recognition</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" default_group_by="state">
                <field name="name"/>
                <field name="subscription_id"/>
                <field name="partner_id"/>
                <field name="recognition_date"/>
                <field name="recognition_amount"/>
                <field name="state"/>
                <field name="is_automated"/>
                <field name="move_id"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="row">
                                <div class="col-8">
                                    <strong t-esc="record.name.value"/>
                                </div>
                                <div class="col-4 text-right">
                                    <span t-if="record.is_automated.raw_value" 
                                          class="badge badge-info" title="Automated">
                                        <i class="fa fa-robot"/>
                                    </span>
                                    <span t-if="record.move_id.raw_value" 
                                          class="badge badge-success" title="Journal Entry Created">
                                        <i class="fa fa-book"/>
                                    </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <i class="fa fa-refresh"/> <span t-esc="record.subscription_id.value"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <i class="fa fa-user"/> <span t-esc="record.partner_id.value"/>
                                </div>
                            </div>
                            
                            <hr class="mt-2 mb-2"/>
                            
                            <div class="row">
                                <div class="col-6">
                                    <small>
                                        <strong>Date:</strong><br/>
                                        <span t-esc="record.recognition_date.value"/>
                                    </small>
                                </div>
                                <div class="col-6 text-right">
                                    <small>
                                        <strong>Amount:</strong><br/>
                                        <span t-esc="record.recognition_amount.value" t-options="{'widget': 'monetary'}"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Revenue Recognition Pivot View -->
    <record id="view_ams_revenue_recognition_pivot" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.pivot</field>
        <field name="model">ams.revenue.recognition</field>
        <field name="arch" type="xml">
            <pivot string="Revenue Recognition Analysis">
                <field name="recognition_date" type="row" interval="month"/>
                <field name="state" type="col"/>
                <field name="recognition_amount" type="measure"/>
            </pivot>
        </field>
    </record>
    
    <!-- Revenue Recognition Graph View -->
    <record id="view_ams_revenue_recognition_graph" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.graph</field>
        <field name="model">ams.revenue.recognition</field>
        <field name="arch" type="xml">
            <graph string="Revenue Recognition Trends" type="line">
                <field name="recognition_date" type="row" interval="month"/>
                <field name="recognition_amount" type="measure"/>
            </graph>
        </field>
    </record>
    
    <!-- ==============================================
         REVENUE RECOGNITION SCHEDULE VIEWS
         ============================================== -->
    
    <!-- Schedule Tree View -->
    <record id="view_ams_revenue_recognition_schedule_tree" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.schedule.tree</field>
        <field name="model">ams.revenue.recognition.schedule</field>
        <field name="arch" type="xml">
            <tree string="Revenue Recognition Schedules"
                  decoration-success="state == 'active'"
                  decoration-info="state == 'draft'"
                  decoration-muted="state == 'complete'">
                <field name="name"/>
                <field name="subscription_id"/>
                <field name="partner_id"/>
                <field name="product_id"/>
                <field name="start_date"/>
                <field name="end_date"/>
                <field name="total_amount" sum="Total Amount"/>
                <field name="recognized_amount" sum="Recognized"/>
                <field name="remaining_amount" sum="Remaining"/>
                <field name="schedule_line_count" string="Entries"/>
                <field name="state"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </tree>
        </field>
    </record>
    
    <!-- Schedule Form View -->
    <record id="view_ams_revenue_recognition_schedule_form" model="ir.ui.view">
        <field name="name">ams.revenue.recognition.schedule.form</field>
        <field name="model">ams.revenue.recognition.schedule</field>
        <field name="arch" type="xml">
            <form string="Revenue Recognition Schedule">
                <header>
                    <button name="action_activate" type="object" 
                            class="btn-primary" string="Activate"
                            attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                    <button name="action_regenerate_schedule" type="object" 
                            class="btn-secondary" string="Regenerate"
                            attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                    <button name="action_complete" type="object" 
                            class="btn-secondary" string="Complete"
                            attrs="{'invisible': ['|', ('state', '!=', 'active'), ('remaining_amount', '>', 0)]}"/>
                    <field name="state" widget="statusbar" 
                           statusbar_visible="draft,active,complete"/>
                </header>
                
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_schedule_lines" type="object" 
                                class="oe_stat_button" icon="fa-list">
                            <field name="schedule_line_count" widget="statinfo" string="Schedule Lines"/>
                        </button>
                        <button name="action_view_recognition_entries" type="object" 
                                class="oe_stat_button" icon="fa-line-chart">
                            <field name="recognition_entry_count" widget="statinfo" string="Recognition Entries"/>
                        </button>
                    </div>
                    
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group>
                            <field name="subscription_id" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="partner_id" readonly="1"/>
                            <field name="product_id" readonly="1"/>
                            <field name="company_id" groups="base.group_multi_company" readonly="1"/>
                        </group>
                        <group>
                            <field name="start_date" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="end_date" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="recognition_method" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="frequency" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Amounts">
                            <field name="total_amount" 
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="recognized_amount" readonly="1"/>
                            <field name="remaining_amount" readonly="1"/>
                            <field name="recognition_percentage" readonly="1" widget="percentage"/>
                        </group>
                        <group string="Progress">
                            <field name="schedule_line_count" readonly="1"/>
                            <field name="completed_lines" readonly="1"/>
                            <field name="next_recognition_date" readonly="1"/>
                            <field name="last_recognition_date" readonly="1"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page name="schedule_lines" string="Schedule Lines">
                            <field name="schedule_line_ids" nolabel="1">
                                <tree string="Schedule Lines" 
                                      decoration-success="state == 'recognized'"
                                      decoration-info="state == 'pending'"
                                      decoration-muted="state == 'skipped'">
                                    <field name="sequence"/>
                                    <field name="recognition_date"/>
                                    <field name="period_start"/>
                                    <field name="period_end"/>
                                    <field name="scheduled_amount"/>
                                    <field name="actual_amount"/>
                                    <field name="state"/>
                                    <field name="recognition_entry_id"/>
                                    <button name="action_create_recognition" type="object" 
                                            string="Create Recognition" class="btn-link"
                                            attrs="{'invisible': ['|', ('state', '!=', 'pending'), ('recognition_date', '>', context_today().strftime('%Y-%m-%d'))]}"/>
                                </tree>
                            </field>
                        </page>
                        
                        <page name="configuration" string="Configuration">
                            <group>
                                <group string="Recognition Settings">
                                    <field name="auto_create_entries" 
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                    <field name="auto_post_entries" 
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                    <field name="journal_id" 
                                           domain="[('company_id', '=', company_id)]"
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                </group>
                                <group string="Account Settings">
                                    <field name="revenue_account_id" 
                                           domain="[('account_type', 'in', ['income', 'income_membership', 'income_chapter', 'income_publication']), ('company_id', '=', company_id)]"
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                    <field name="deferred_revenue_account_id" 
                                           domain="[('account_type', '=', 'liability_deferred_revenue'), ('company_id', '=', company_id)]"
                                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                </group>
                            </group>
                        </page>
                        
                        <page name="history" string="History">
                            <group>
                                <group string="Creation">
                                    <field name="create_date" readonly="1"/>
                                    <field name="create_uid" readonly="1"/>
                                    <field name="activated_date" readonly="1"/>
                                    <field name="activated_by" readonly="1"/>
                                </group>
                                <group string="Completion">
                                    <field name="completed_date" readonly="1"/>
                                    <field name="completed_by" readonly="1"/>
                                    <field name="last_processed_date" readonly="1"/>
                                </group>
                            </group>
                            
                            <separator string="Processing Log"/>
                            <field name="processing_log" readonly="1" nolabel="1" widget="html"/>
                        </page>
                    </notebook>
                </sheet>
                
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>
    
    <!-- ==============================================
         ACTIONS
         ============================================== -->
    
    <!-- Main Revenue Recognition Action -->
    <record id="action_ams_revenue_recognition" model="ir.actions.act_window">
        <field name="name">Revenue Recognition</field>
        <field name="res_model">ams.revenue.recognition</field>
        <field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
        <field name="view_id" ref="view_ams_revenue_recognition_tree"/>
        <field name="search_view_id" ref="view_ams_revenue_recognition_search"/>
        <field name="context">{
            'search_default_current_month': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No revenue recognition entries found!
            </p>
            <p>
                Revenue recognition entries are created automatically based on 
                subscription schedules or can be created manually.
            </p>
        </field>
    </record>
    
    <!-- Due for Processing Action -->
    <record id="action_revenue_recognition_due" model="ir.actions.act_window">
        <field name="name">Due for Processing</field>
        <field name="res_model">ams.revenue.recognition</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('recognition_date', '<=', context_today()), ('state', 'in', ['draft', 'confirmed'])]</field>
        <field name="context">{'search_default_due_today': 1, 'search_default_overdue': 1}</field>
    </record>
    
    <!-- Automated Entries Action -->
    <record id="action_revenue_recognition_automated" model="ir.actions.act_window">
        <field name="name">Automated Revenue Recognition</field>
        <field name="res_model">ams.revenue.recognition</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_automated', '=', True)]</field>
        <field name="context">{'search_default_automated': 1}</field>
    </record>
    
    <!-- Posted Entries Action -->
    <record id="action_revenue_recognition_posted" model="ir.actions.act_window">
        <field name="name">Posted Revenue Recognition</field>
        <field name="res_model">ams.revenue.recognition</field>
        <field name="view_mode">tree,form,graph,pivot</field>
        <field name="domain">[('state', '=', 'posted')]</field>
        <field name="context">{'search_default_posted': 1}</field>
    </record>
    
    <!-- Revenue Recognition Schedules Action -->
    <record id="action_ams_revenue_recognition_schedule" model="ir.actions.act_window">
        <field name="name">Revenue Recognition Schedules</field>
        <field name="res_model">ams.revenue.recognition.schedule</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_ams_revenue_recognition_schedule_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first revenue recognition schedule!
            </p>
            <p>
                Schedules automate the creation of revenue recognition entries
                over the subscription period.
            </p>
        </field>
    </record>
    
    <!-- ==============================================
         WIZARD ACTIONS
         ============================================== -->
    
    <!-- Revenue Recognition Wizard Action -->
    <record id="action_revenue_recognition_wizard" model="ir.actions.act_window">
        <field name="name">Revenue Recognition Wizard</field>
        <field name="res_model">ams.revenue.recognition.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_wizard_type': 'single_subscription'
        }</field>
    </record>
    
    <!-- Monthly Processing Wizard Action -->
    <record id="action_monthly_revenue_recognition" model="ir.actions.act_window">
        <field name="name">Monthly Revenue Recognition</field>
        <field name="res_model">ams.revenue.recognition.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_wizard_type': 'monthly_processing',
            'default_recognition_period': 'current_month'
        }</field>
    </record>
    
    <!-- Bulk Recognition Wizard Action -->
    <record id="action_bulk_revenue_recognition" model="ir.actions.act_window">
        <field name="name">Bulk Revenue Recognition</field>
        <field name="res_model">ams.revenue.recognition.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_wizard_type': 'bulk_subscriptions'
        }</field>
    </record>
    
    <!-- ==============================================
         SERVER ACTIONS
         ============================================== -->
    
    <!-- Process Revenue Recognition Server Action -->
    <record id="server_action_process_revenue_recognition" model="ir.actions.server">
        <field name="name">Process Revenue Recognition</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="binding_model_id" ref="model_ams_revenue_recognition"/>
        <field name="binding_view_types">form,list</field>
        <field name="state">code</field>
        <field name="code">
for record in records:
    if record.state == 'draft':
        record.action_confirm()
    if record.state == 'confirmed':
        record.action_post()
        </field>
    </record>
    
    <!-- Create Recognition Entry Server Action -->
    <record id="server_action_create_recognition_entry" model="ir.actions.server">
        <field name="name">Create Recognition Entry</field>
        <field name="model_id" ref="model_ams_subscription"/>
        <field name="binding_model_id" ref="model_ams_subscription"/>
        <field name="binding_view_types">form,list</field>
        <field name="state">code</field>
        <field name="code">
action = {
    'type': 'ir.actions.act_window',
    'res_model': 'ams.revenue.recognition.wizard',
    'view_mode': 'form',
    'target': 'new',
    'context': {
        'default_wizard_type': 'single_subscription',
        'default_subscription_id': records[0].id if len(records) == 1 else False,
        'active_ids': records.ids
    }
}
        </field>
    </record>
    
    <!-- ==============================================
         SCHEDULED ACTIONS (CRON JOBS)
         ============================================== -->
    
    <!-- Monthly Revenue Recognition Cron -->
    <record id="cron_monthly_revenue_recognition" model="ir.cron">
        <field name="name">Monthly Revenue Recognition Processing</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="state">code</field>
        <field name="code">
# Process monthly revenue recognition for all eligible subscriptions
model.create_monthly_recognition_entries()
        </field>
        <field name="interval_number">1</field>
        <field name="interval_type">months</field>
        <field name="numbercall">-1</field>
        <field name="active" eval="True"/>
        <field name="doall" eval="False"/>
        <field name="user_id" ref="base.user_root"/>
    </record>
    
    <!-- Daily Revenue Recognition Check Cron -->
    <record id="cron_daily_revenue_recognition_check" model="ir.cron">
        <field name="name">Daily Revenue Recognition Check</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="state">code</field>
        <field name="code">
# Process due revenue recognition entries
due_entries = model.search([
    ('recognition_date', '<=', fields.Date.today()),
    ('state', 'in', ['draft', 'confirmed']),
    ('auto_post', '=', True)
])
for entry in due_entries:
    try:
        if entry.state == 'draft':
            entry.action_confirm()
        if entry.state == 'confirmed':
            entry.action_post()
    except Exception as e:
        entry.message_post(body=f'Auto-processing failed: {str(e)}')
        </field>
        <field name="interval_number">1</field>
        <field name="interval_type">days</field>
        <field name="numbercall">-1</field>
        <field name="active" eval="True"/>
        <field name="doall" eval="False"/>
        <field name="user_id" ref="base.user_root"/>
    </record>
    
</odoo>