<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Enhanced participation view - simplified to avoid field resolution issues -->
    <record id="view_partner_form_participation" model="ir.ui.view">
        <field name="name">res.partner.form.participation</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <!-- Enhanced smart buttons -->
            <div name="button_box" position="inside">
                <button name="action_view_participations" type="object" 
                        class="oe_stat_button" icon="fa-users"
                        invisible="participation_count == 0">
                    <field name="participation_count" widget="statinfo" string="Participations"/>
                </button>
                
                <button name="action_view_active_participations" type="object" 
                        class="oe_stat_button" icon="fa-check-circle"
                        invisible="active_participation_count == 0">
                    <field name="active_participation_count" widget="statinfo" string="Active"/>
                </button>
                
                <button name="action_create_participation" type="object" 
                        class="oe_stat_button" icon="fa-plus-circle"
                        help="Create new participation">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">New Participation</span>
                    </div>
                </button>
            </div>

            <!-- Enhanced participations notebook page -->
            <notebook position="inside">
                <page string="Participations" name="participations">
                    
                    <!-- Participation Status Dashboard -->
                    <group string="Member Status Overview" name="participation_dashboard">
                        <field name="active_participation_count" invisible="1"/>
                        <field name="has_active_membership" invisible="1"/>
                        <field name="primary_membership_id" invisible="1"/>
                        
                        <!-- Status Indicators -->
                        <div class="row">
                            <div class="col-md-4">
                                <div class="alert alert-success" role="alert" 
                                     invisible="active_participation_count == 0">
                                    <i class="fa fa-check-circle"/> <strong>Active Member</strong><br/>
                                    <field name="active_participation_count" readonly="1" style="display: inline"/> 
                                    active participation(s)
                                </div>
                                <div class="alert alert-warning" role="alert" 
                                     invisible="active_participation_count > 0">
                                    <i class="fa fa-exclamation-triangle"/> <strong>Inactive Member</strong><br/>
                                    No active participations
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="alert alert-info" role="alert" 
                                     invisible="not has_active_membership">
                                    <strong>Primary Membership:</strong><br/>
                                    <field name="primary_membership_id" readonly="1" style="display: inline"/>
                                </div>
                            </div>
                        </div>
                    </group>

                    <!-- Professional Association Specific Section -->
                    <group string="Professional Association Details" 
                           invisible="not has_active_membership">
                        <group>
                            <field name="member_since" string="Member Since" readonly="1"/>
                            <field name="membership_grade" string="Membership Grade" readonly="1"/>
                            <field name="professional_designation" string="Designation" readonly="1"/>
                        </group>
                        <group>
                            <field name="chapter_memberships" string="Chapter Affiliations" readonly="1"/>
                            <field name="committee_roles" string="Committee Roles" readonly="1"/>
                            <field name="continuing_education_status" string="CE Status" readonly="1"/>
                        </group>
                    </group>

                    <!-- Participation Management Actions -->
                    <div class="oe_clear mt16">
                        <div class="row">
                            <div class="col-md-6">
                                <h3>Current Active Participations</h3>
                                <p class="text-muted">
                                    <span invisible="active_participation_count == 0">
                                        This member has <field name="active_participation_count" readonly="1" style="display: inline"/> active participation(s).
                                    </span>
                                    <span invisible="active_participation_count > 0">
                                        This member has no active participations.
                                    </span>
                                </p>
                                <div class="mt8">
                                    <button name="action_view_active_participations" string="View Active Participations" 
                                            type="object" class="btn-primary"
                                            invisible="active_participation_count == 0"/>
                                    <button name="action_create_participation" string="Add New Participation" 
                                            type="object" class="btn-success"/>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h3>Participation History</h3>
                                <p class="text-muted">
                                    <span invisible="historical_participation_count == 0">
                                        This member has <field name="historical_participation_count" readonly="1" style="display: inline"/> historical participation(s).
                                    </span>
                                    <span invisible="historical_participation_count > 0">
                                        No historical participations.
                                    </span>
                                </p>
                                <div class="mt8">
                                    <button name="action_view_all_participations" string="View All Participations" 
                                            type="object" class="btn-primary"
                                            invisible="participation_count == 0"/>
                                    <button name="action_export_participation_history" string="Export History" 
                                            type="object" class="btn-secondary"
                                            invisible="participation_count == 0"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Help Text for New Members -->
                    <div class="oe_clear mt16" invisible="participation_count > 0">
                        <div class="alert alert-info" role="alert">
                            <i class="fa fa-info-circle"/> 
                            <strong>New Member:</strong> This contact has no participations yet. 
                            Use "Add New Participation" to create their first membership, chapter, or committee participation.
                        </div>
                    </div>
                </page>
            </notebook>
        </field>
    </record>

    <!-- Member-specific participation action -->
    <record id="action_member_participations" model="ir.actions.act_window">
        <field name="name">Member Participations</field>
        <field name="res_model">ams.participation</field>
        <field name="view_mode">list,form</field>
        <field name="context">{
            'search_default_active': 1,
            'default_partner_id': active_id if not context.get('default_is_company') else False,
            'default_company_id': active_id if context.get('default_is_company') else False
        }</field>
    </record>
</odoo>