<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Benefit Views -->
    <record id="view_membership_benefit_tree" model="ir.ui.view">
        <field name="name">membership.benefit.tree</field>
        <field name="model">membership.benefit</field>
        <field name="arch" type="xml">
            <tree decoration-muted="not active">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="code"/>
                <field name="benefit_type"/>
                <field name="usage_limit"/>
                <field name="total_usage_count"/>
                <field name="unique_users_count"/>
                <field name="cost_to_organization"/>
                <field name="active"/>
                <field name="currency_id" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="view_membership_benefit_form" model="ir.ui.view">
        <field name="name">membership.benefit.form</field>
        <field name="model">membership.benefit</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_view_usage" string="View Usage" type="object" class="oe_highlight"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object" name="action_view_usage" icon="fa-bar-chart">
                            <field string="Total Uses" name="total_usage_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="action_view_usage" icon="fa-users">
                            <field string="Unique Users" name="unique_users_count" widget="statinfo"/>
                        </button>
                    </div>
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="Benefit Name"/>
                        </h1>
                    </div>
                    <group>
                        <group name="basic_info">
                            <field name="code"/>
                            <field name="benefit_type"/>
                            <field name="sequence"/>
                            <field name="active"/>
                        </group>
                        <group name="usage_limits">
                            <field name="usage_limit"/>
                            <field name="usage_period"/>
                            <field name="currency_id"/>
                        </group>
                    </group>
                    <group name="financial" string="Financial Information">
                        <group>
                            <field name="cost_to_organization"/>
                            <field name="member_price"/>
                            <field name="non_member_price"/>
                        </group>
                        <group>
                            <field name="total_cost"/>
                        </group>
                    </group>
                    <group name="availability" string="Availability">
                        <field name="level_ids" widget="many2many_tags"/>
                        <field name="chapter_ids" widget="many2many_tags"/>
                    </group>
                    <group name="integration" string="External Integration">
                        <field name="external_system"/>
                        <field name="external_url" widget="url"/>
                        <field name="api_endpoint"/>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description" nolabel="1" placeholder="Detailed description of this benefit..."/>
                        </page>
                        <page string="Usage Statistics">
                            <group>
                                <group>
                                    <field name="total_usage_count"/>
                                    <field name="unique_users_count"/>
                                </group>
                                <group>
                                    <field name="total_cost"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="view_membership_benefit_kanban" model="ir.ui.view">
        <field name="name">membership.benefit.kanban</field>
        <field name="model">membership.benefit</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="name"/>
                <field name="benefit_type"/>
                <field name="usage_limit"/>
                <field name="total_usage_count"/>
                <field name="cost_to_organization"/>
                <field name="currency_id"/>
                <field name="active"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click #{record.active.raw_value ? '' : 'oe_kanban_color_7'}">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                    <div class="o_kanban_record_top_right">
                                        <span t-attf-class="badge badge-pill badge-#{record.benefit_type.raw_value == 'discount' and 'success' or record.benefit_type.raw_value == 'access' and 'info' or 'secondary'}">
                                            <field name="benefit_type"/>
                                        </span>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div t-if="record.usage_limit.value &gt; 0">
                                        <i class="fa fa-limit"/> Limit: <field name="usage_limit"/> per period
                                    </div>
                                    <div t-if="record.usage_limit.value == 0">
                                        <i class="fa fa-infinity"/> Unlimited usage
                                    </div>
                                    <div t-if="record.cost_to_organization.value &gt; 0">
                                        <i class="fa fa-money"/> Cost: <field name="cost_to_organization"/>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span class="badge badge-pill badge-info">
                                            <field name="total_usage_count"/> uses
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Benefit Usage Views -->
    <record id="view_benefit_usage_tree" model="ir.ui.view">
        <field name="name">membership.benefit.usage.tree</field>
        <field name="model">membership.benefit.usage</field>
        <field name="arch" type="xml">
            <tree decoration-success="verified">
                <field name="usage_date"/>
                <field name="partner_id"/>
                <field name="benefit_id"/>
                <field name="membership_level_id"/>
                <field name="usage_count"/>
                <field name="usage_value"/>
                <field name="verified"/>
                <field name="external_reference"/>
                <field name="currency_id" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="view_benefit_usage_form" model="ir.ui.view">
        <field name="name">membership.benefit.usage.form</field>
        <field name="model">membership.benefit.usage</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_verify_usage" string="Verify Usage" type="object" 
                            attrs="{'invisible': [('verified', '=', True)]}" 
                            class="oe_highlight"/>
                    <field name="verified" invisible="1"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="benefit_id" readonly="1"/>
                        </h1>
                        <div class="o_row">
                            <field name="partner_id" readonly="1"/> - <field name="usage_date"/>
                        </div>
                    </div>
                    <group>
                        <group name="usage_info">
                            <field name="usage_count"/>
                            <field name="usage_value" readonly="1"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                        <group name="member_info">
                            <field name="membership_id" readonly="1"/>
                            <field name="membership_level_id" readonly="1"/>
                            <field name="chapter_id" readonly="1"/>
                        </group>
                    </group>
                    <group name="verification" string="Verification" attrs="{'invisible': [('verified', '=', False)]}">
                        <field name="verified_by" readonly="1"/>
                        <field name="verification_date" readonly="1"/>
                    </group>
                    <group name="external" string="External System">
                        <field name="external_reference"/>
                    </group>
                    <field name="usage_description" placeholder="Description of how the benefit was used..."/>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Enhanced Level Form with Benefits -->
    <record id="view_membership_level_form_benefits" model="ir.ui.view">
        <field name="name">membership.level.form.benefits</field>
        <field name="model">membership.level</field>
        <field name="inherit_id" ref="membership_level.view_membership_level_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" type="object" name="action_view_benefits" icon="fa-gift">
                    <field string="Benefits" name="benefit_count" widget="statinfo"/>
                </button>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string="Member Benefits">
                    <field name="benefit_ids">
                        <tree>
                            <field name="name"/>
                            <field name="benefit_type"/>
                            <field name="usage_limit"/>
                            <field name="cost_to_organization"/>
                            <field name="total_usage_count"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Enhanced Partner Form with Benefits -->
    <record id="view_partner_form_benefits" model="ir.ui.view">
        <field name="name">res.partner.form.benefits</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="membership_base.view_partner_form_membership"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" type="object" name="action_view_benefit_usage" icon="fa-gift">
                    <field string="Benefit Uses" name="total_benefit_usage_count" widget="statinfo"/>
                </button>
            </xpath>
            <xpath expr="//group[1]/group[2]" position="inside">
                <field name="benefit_value_received"/>
            </xpath>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_membership_benefit" model="ir.actions.act_window">
        <field name="name">Member Benefits</field>
        <field name="res_model">membership.benefit</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first member benefit!
            </p>
            <p>
                Define benefits that members receive and track their usage.
            </p>
        </field>
    </record>

    <record id="action_benefit_usage" model="ir.actions.act_window">
        <field name="name">Benefit Usage</field>
        <field name="res_model">membership.benefit.usage</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_this_month': 1}</field>
    </record>

    <!-- Menu Items -->
    <menuitem id="menu_member_benefits" name="Member Benefits" 
              parent="membership_base.menu_membership_main" 
              action="action_membership_benefit" sequence="23"/>
    <menuitem id="menu_benefit_usage" name="Benefit Usage" 
              parent="menu_member_benefits" 
              action="action_benefit_usage" sequence="10"/>

</odoo>