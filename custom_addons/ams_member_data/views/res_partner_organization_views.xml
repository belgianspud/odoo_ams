<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Organization Member Form View -->
    <record id="view_partner_organization_form" model="ir.ui.view">
        <field name="name">res.partner.organization.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            
            <!-- Add Member ID after name -->
            <field name="name" position="after">
                <field name="member_id" readonly="1" invisible="not is_company"/>
            </field>

            <!-- Add organization identity section -->
            <field name="category_id" position="after">
                <group string="Organization Identity" invisible="not is_company">
                    <group>
                        <field name="acronym"/>
                        <field name="website_url" widget="url"/>
                        <field name="organization_type"/>
                    </group>
                    <group>
                        <field name="year_established"/>
                        <field name="industry_sector"/>
                        <field name="naics_code"/>
                    </group>
                </group>
            </field>

            <!-- Add business details section -->
            <xpath expr="//group[@name='sale']" position="after">
                <group string="Business Details" invisible="not is_company">
                    <group>
                        <field name="employee_count"/>
                        <field name="employee_count_computed" readonly="1"/>
                        <field name="annual_revenue"/>
                    </group>
                    <group>
                        <field name="tin_number"/>
                        <field name="ein_number"/>
                    </group>
                </group>
            </xpath>

            <!-- Add portal management section -->
            <xpath expr="//page[@name='contact_addresses']" position="after">
                <page string="Portal &amp; Access" invisible="not is_company">
                    <group>
                        <group string="Portal Management">
                            <field name="portal_primary_contact_id" options="{'no_create': True}"/>
                        </group>
                        <group string="Employee Access">
                            <button name="action_view_employees" 
                                    type="object" 
                                    string="View Employees" 
                                    class="btn-primary"
                                    invisible="employee_count_computed == 0"/>
                            <field name="employee_count_computed" readonly="1"/>
                        </group>
                    </group>
                    
                    <!-- Employee list within the form -->
                    <separator string="Organization Employees"/>
                    <field name="employee_ids" mode="list" readonly="1">
                        <list>
                            <field name="member_id"/>
                            <field name="display_name"/>
                            <field name="email"/>
                            <field name="phone"/>
                            <field name="mobile_phone"/>
                        </list>
                    </field>
                </page>
            </xpath>

            <!-- System information tab -->
            <xpath expr="//notebook" position="inside">
                <page string="System Information" groups="base.group_system" invisible="not is_company">
                    <group>
                        <group string="Integration">
                            <field name="legacy_organization_id"/>
                            <field name="legacy_contact_id"/>
                            <field name="portal_id"/>
                            <field name="original_join_date"/>
                        </group>
                        <group string="Computed Information">
                            <field name="display_name"/>
                            <field name="formatted_address"/>
                        </group>
                    </group>
                </page>
            </xpath>

        </field>
    </record>

    <!-- Organization Members List View -->
    <record id="view_partner_organization_tree" model="ir.ui.view">
        <field name="name">res.partner.organization.list</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <list string="Organization Members">
                <field name="member_id"/>
                <field name="display_name"/>
                <field name="acronym"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="website_url" widget="url"/>
                <field name="organization_type"/>
                <field name="employee_count_computed"/>
                <field name="city"/>
                <field name="state_id"/>
                <field name="country_id"/>
            </list>
        </field>
    </record>

    <!-- Organization Members Kanban View -->
    <record id="view_partner_organization_kanban" model="ir.ui.view">
        <field name="name">res.partner.organization.kanban</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <kanban string="Organization Members">
                <field name="member_id"/>
                <field name="display_name"/>
                <field name="acronym"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="website_url"/>
                <field name="organization_type"/>
                <field name="employee_count_computed"/>
                <field name="image_128"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_image">
                                <img t-att-src="kanban_image('res.partner', 'image_128', record.id.raw_value)" alt="Organization"/>
                            </div>
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="display_name"/>
                                </strong>
                                <div t-if="record.member_id.value">
                                    <i class="fa fa-id-card" title="Member ID"/>
                                    <field name="member_id"/>
                                </div>
                                <div t-if="record.organization_type.value">
                                    <i class="fa fa-building" title="Organization Type"/>
                                    <field name="organization_type"/>
                                </div>
                                <div t-if="record.email.value">
                                    <i class="fa fa-envelope" title="Email"/>
                                    <field name="email"/>
                                </div>
                                <div t-if="record.website_url.value">
                                    <i class="fa fa-globe" title="Website"/>
                                    <field name="website_url" widget="url"/>
                                </div>
                                <div t-if="record.employee_count_computed.value">
                                    <i class="fa fa-users" title="Employees"/>
                                    <field name="employee_count_computed"/> employees
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Organization Members Search View -->
    <record id="view_partner_organization_search" model="ir.ui.view">
        <field name="name">res.partner.organization.search</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <search string="Search Organization Members">
                <field name="display_name" string="Name" 
                       filter_domain="['|', ('display_name', 'ilike', self), ('acronym', 'ilike', self)]"/>
                <field name="member_id"/>
                <field name="acronym"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="website"/> <!-- ✅ replaced website_url with website -->
                <field name="organization_type"/>
                <field name="industry_sector"/>
                <field name="naics_code"/>
                <field name="city"/>
                <field name="state_id"/>
                <field name="country_id"/>
                
                <filter string="Has Member ID" name="has_member_id" domain="[('member_id', '!=', False)]"/>
                <filter string="Missing Member ID" name="no_member_id" domain="[('member_id', '=', False)]"/>
                <filter string="Has Email" name="has_email" domain="[('email', '!=', False)]"/>
                <filter string="Has Website" name="has_website" domain="[('website', '!=', False)]"/> <!-- ✅ fixed -->
                <filter string="Has Employees" name="has_employees" domain="[('employee_count_computed', '>', 0)]"/>
                
                <separator/>
                <filter string="Corporation" name="corporation" domain="[('organization_type', '=', 'corporation')]"/>
                <filter string="Non-profit" name="nonprofit" domain="[('organization_type', '=', 'nonprofit')]"/>
                <filter string="Government" name="government" domain="[('organization_type', '=', 'government')]"/>
                <filter string="Educational" name="educational" domain="[('organization_type', '=', 'educational')]"/>
                
                <separator/>
                <filter string="Organizations Only" name="organizations_only" domain="[('is_company', '=', True)]"/>
                
                <group expand="0" string="Group By">
                    <filter string="Organization Type" name="group_org_type" context="{'group_by': 'organization_type'}"/>
                    <filter string="Industry Sector" name="group_industry" context="{'group_by': 'industry_sector'}"/>
                    <filter string="State" name="group_state" context="{'group_by': 'state_id'}"/>
                    <filter string="Country" name="group_country" context="{'group_by': 'country_id'}"/>
                    <filter string="Year Established" name="group_year" context="{'group_by': 'year_established'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Organization Members Action -->
    <record id="action_partner_organization" model="ir.actions.act_window">
        <field name="name">Organization Members</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_company', '=', True)]</field>
        <field name="context">{
            'default_is_company': True,
            'default_customer_rank': 1,
        }</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_partner_organization_kanban')}),
            (0, 0, {'view_mode': 'list', 'view_id': ref('view_partner_organization_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_partner_organization_form')})]"/>
        <field name="search_view_id" ref="view_partner_organization_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first organization member!
            </p>
            <p>
                Organization members are companies, institutions, and other entities that hold
                corporate memberships with your association. This includes businesses, non-profits,
                government agencies, and educational institutions.
            </p>
        </field>
    </record>

    <!-- All Members Combined Action -->
    <record id="action_partner_all_members" model="ir.actions.act_window">
        <field name="name">All Members</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('member_id', '!=', False)]</field>
        <field name="context">{
            'default_customer_rank': 1,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first member!
            </p>
            <p>
                This view shows all members (both individuals and organizations) who have been
                assigned member IDs. Use the filters to narrow down to specific member types.
            </p>
        </field>
    </record>

    <!-- Menu Items -->
    <menuitem id="menu_ams_root" 
              name="AMS" 
              sequence="10"/>

    <menuitem id="menu_ams_members" 
              name="Members" 
              parent="menu_ams_root" 
              sequence="10"/>

    <menuitem id="menu_individual_members" 
              name="Individual Members" 
              parent="menu_ams_members" 
              action="action_partner_individual" 
              sequence="10"/>

    <menuitem id="menu_organization_members" 
              name="Organization Members" 
              parent="menu_ams_members" 
              action="action_partner_organization" 
              sequence="20"/>

    <menuitem id="menu_all_members" 
              name="All Members" 
              parent="menu_ams_members" 
              action="action_partner_all_members" 
              sequence="30"/>

    <menuitem id="menu_ams_configuration" 
              name="Configuration" 
              parent="menu_ams_root" 
              sequence="90"/>

</odoo>
