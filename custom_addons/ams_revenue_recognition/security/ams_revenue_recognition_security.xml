<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- AMS Revenue Recognition Security Groups -->
    
    <!-- Revenue Recognition Manager Group -->
    <record id="group_ams_revenue_recognition_manager" model="res.groups">
        <field name="name">AMS Revenue Recognition Manager</field>
        <field name="category_id" ref="base.module_category_accounting"/>
        <field name="implied_ids" eval="[(4, ref('account.group_account_manager'))]"/>
        <field name="comment">Full access to AMS revenue recognition features including:
        - Create, modify, and delete recognition schedules
        - Process contract modifications
        - Access to all revenue recognition reports and dashboards
        - Ability to override system controls
        - Manual revenue recognition adjustments</field>
    </record>

    <!-- Revenue Recognition User Group -->
    <record id="group_ams_revenue_recognition_user" model="res.groups">
        <field name="name">AMS Revenue Recognition User</field>
        <field name="category_id" ref="base.module_category_accounting"/>
        <field name="implied_ids" eval="[(4, ref('account.group_account_user'))]"/>
        <field name="comment">Standard access to AMS revenue recognition features including:
        - View recognition schedules and entries
        - Create basic contract modifications
        - Access to standard reports
        - Limited manual adjustment capabilities</field>
    </record>

    <!-- Revenue Recognition Viewer Group -->
    <record id="group_ams_revenue_recognition_viewer" model="res.groups">
        <field name="name">AMS Revenue Recognition Viewer</field>
        <field name="category_id" ref="base.module_category_accounting"/>
        <field name="comment">Read-only access to AMS revenue recognition features including:
        - View recognition schedules and entries
        - Access to reports and dashboards
        - No modification capabilities</field>
    </record>

    <!-- Auditor Group (Special access for auditing) -->
    <record id="group_ams_revenue_recognition_auditor" model="res.groups">
        <field name="name">AMS Revenue Recognition Auditor</field>
        <field name="category_id" ref="base.module_category_accounting"/>
        <field name="comment">Auditor access to AMS revenue recognition including:
        - Read-only access to all revenue recognition data
        - Access to audit trails and compliance reports
        - View modification history and journal entries
        - No modification capabilities</field>
    </record>

    <!-- Portal User Access (Customer Self-Service) -->
    <record id="group_ams_revenue_recognition_portal" model="res.groups">
        <field name="name">AMS Revenue Recognition Portal</field>
        <field name="category_id" ref="base.module_category_website"/>
        <field name="implied_ids" eval="[(4, ref('base.group_portal'))]"/>
        <field name="comment">Portal access for customers to view their own revenue recognition information</field>
    </record>

    <!-- Multi-Company Rules -->
    
    <!-- Revenue Schedule Multi-Company Rule -->
    <record id="ams_revenue_schedule_comp_rule" model="ir.rule">
        <field name="name">AMS Revenue Schedule Multi-Company</field>
        <field name="model_id" ref="model_ams_revenue_schedule"/>
        <field name="domain_force">['|',('company_id','=',False),('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <!-- Revenue Recognition Multi-Company Rule -->
    <record id="ams_revenue_recognition_comp_rule" model="ir.rule">
        <field name="name">AMS Revenue Recognition Multi-Company</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="domain_force">['|',('schedule_id.company_id','=',False),('schedule_id.company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <!-- Contract Modification Multi-Company Rule -->
    <record id="ams_contract_modification_comp_rule" model="ir.rule">
        <field name="name">AMS Contract Modification Multi-Company</field>
        <field name="model_id" ref="model_ams_contract_modification"/>
        <field name="domain_force">['|',('schedule_id.company_id','=',False),('schedule_id.company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <!-- User Access Rules -->
    
    <!-- Revenue Schedule Manager Access Rule -->
    <record id="ams_revenue_schedule_manager_rule" model="ir.rule">
        <field name="name">AMS Revenue Schedule Manager Access</field>
        <field name="model_id" ref="model_ams_revenue_schedule"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_manager'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Revenue Schedule User Access Rule -->
    <record id="ams_revenue_schedule_user_rule" model="ir.rule">
        <field name="name">AMS Revenue Schedule User Access</field>
        <field name="model_id" ref="model_ams_revenue_schedule"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_user'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Revenue Schedule Viewer Access Rule -->
    <record id="ams_revenue_schedule_viewer_rule" model="ir.rule">
        <field name="name">AMS Revenue Schedule Viewer Access</field>
        <field name="model_id" ref="model_ams_revenue_schedule"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_viewer'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Revenue Recognition User Access -->
    <record id="ams_revenue_recognition_user_rule" model="ir.rule">
        <field name="name">AMS Revenue Recognition User Access</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_user'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Revenue Recognition Manager Access -->
    <record id="ams_revenue_recognition_manager_rule" model="ir.rule">
        <field name="name">AMS Revenue Recognition Manager Access</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_manager'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Revenue Recognition Viewer Access -->
    <record id="ams_revenue_recognition_viewer_rule" model="ir.rule">
        <field name="name">AMS Revenue Recognition Viewer Access</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_viewer'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Contract Modification User Access -->
    <record id="ams_contract_modification_user_rule" model="ir.rule">
        <field name="name">AMS Contract Modification User Access</field>
        <field name="model_id" ref="model_ams_contract_modification"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_user'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Contract Modification Manager Access -->
    <record id="ams_contract_modification_manager_rule" model="ir.rule">
        <field name="name">AMS Contract Modification Manager Access</field>
        <field name="model_id" ref="model_ams_contract_modification"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_manager'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Portal User Access Rules -->
    
    <!-- Portal Revenue Schedule Access -->
    <record id="ams_revenue_schedule_portal_rule" model="ir.rule">
        <field name="name">AMS Revenue Schedule Portal Access</field>
        <field name="model_id" ref="model_ams_revenue_schedule"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_portal'))]"/>
        <field name="domain_force">[('partner_id', '=', user.partner_id.id)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Portal Revenue Recognition Access -->
    <record id="ams_revenue_recognition_portal_rule" model="ir.rule">
        <field name="name">AMS Revenue Recognition Portal Access</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_portal'))]"/>
        <field name="domain_force">[('partner_id', '=', user.partner_id.id)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Auditor Access Rules -->
    
    <!-- Auditor Read-Only Access to All Records -->
    <record id="ams_revenue_schedule_auditor_rule" model="ir.rule">
        <field name="name">AMS Revenue Schedule Auditor Access</field>
        <field name="model_id" ref="model_ams_revenue_schedule"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_auditor'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="ams_revenue_recognition_auditor_rule" model="ir.rule">
        <field name="name">AMS Revenue Recognition Auditor Access</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_auditor'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="ams_contract_modification_auditor_rule" model="ir.rule">
        <field name="name">AMS Contract Modification Auditor Access</field>
        <field name="model_id" ref="model_ams_contract_modification"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_auditor'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- State-Based Access Controls -->
    
    <!-- Revenue Recognition Posted Entry Protection -->
    <record id="ams_revenue_recognition_posted_write_rule" model="ir.rule">
        <field name="name">AMS Revenue Recognition Posted Write Protection</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_user'))]"/>
        <field name="domain_force">[('state', '!=', 'posted')]</field>
        <field name="perm_read" eval="False"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Contract Modification State Protection -->
    <record id="ams_contract_modification_processed_rule" model="ir.rule">
        <field name="name">AMS Contract Modification Processed Protection</field>
        <field name="model_id" ref="model_ams_contract_modification"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_user'))]"/>
        <field name="domain_force">[('state', '!=', 'processed')]</field>
        <field name="perm_read" eval="False"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Manager Override for Posted/Processed Records -->
    <record id="ams_revenue_recognition_manager_override" model="ir.rule">
        <field name="name">AMS Revenue Recognition Manager Override</field>
        <field name="model_id" ref="model_ams_revenue_recognition"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_manager'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="False"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="ams_contract_modification_manager_override" model="ir.rule">
        <field name="name">AMS Contract Modification Manager Override</field>
        <field name="model_id" ref="model_ams_contract_modification"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_manager'))]"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="perm_read" eval="False"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Audit Trail Access -->
    <record id="audit_trail_access" model="ir.rule">
        <field name="name">Revenue Recognition Audit Trail Access</field>
        <field name="model_id" ref="mail.model_mail_message"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_auditor')), (4, ref('group_ams_revenue_recognition_manager'))]"/>
        <field name="domain_force">[('model', 'in', ['ams.revenue.schedule', 'ams.revenue.recognition', 'ams.contract.modification'])]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Activity Tracking Access -->
    <record id="activity_tracking_access" model="ir.rule">
        <field name="name">Revenue Recognition Activity Access</field>
        <field name="model_id" ref="mail.model_mail_activity"/>
        <field name="groups" eval="[(4, ref('group_ams_revenue_recognition_user')), (4, ref('group_ams_revenue_recognition_manager'))]"/>
        <field name="domain_force">[('res_model', 'in', ['ams.revenue.schedule', 'ams.revenue.recognition', 'ams.contract.modification'])]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

</odoo>