<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- =================================================================== -->
    <!-- ACTIONS - Define ALL actions FIRST, then menu items                -->
    <!-- =================================================================== -->

    <!-- Invoice Revenue Recognition Action (moved from account_move_views.xml) -->
    <record id="action_invoice_revenue_recognition" model="ir.actions.act_window">
        <field name="name">Invoices - Revenue Recognition</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('move_type', '=', 'out_invoice'), ('has_revenue_recognition', '=', True)]</field>
        <field name="context">{
            'default_move_type': 'out_invoice',
            'search_default_filter_has_revenue_recognition': 1,
            'search_default_group_by_revenue_recognition_status': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No invoices with revenue recognition found!
            </p>
            <p>
                This view shows invoices that contain subscription products with revenue recognition.
                Monitor recognition status and manage revenue schedules.
            </p>
        </field>
    </record>

    <!-- Invoice Lines Needing Revenue Recognition Action (moved from account_move_views.xml) -->
    <record id="action_invoice_lines_need_revenue_recognition" model="ir.actions.act_window">
        <field name="name">Invoice Lines - Need Revenue Recognition</field>
        <field name="res_model">account.move.line</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('needs_revenue_recognition', '=', True)]</field>
        <field name="context">{'search_default_needs_revenue_recognition': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No invoice lines need revenue recognition!
            </p>
            <p>
                This view shows invoice lines from subscription products that need revenue recognition schedules.
                Use this to identify and create missing recognition schedules.
            </p>
        </field>
    </record>

    <!-- Products with Deferred Revenue Action -->
    <record id="action_products_with_deferred_revenue" model="ir.actions.act_window">
        <field name="name">Products with Deferred Revenue</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('is_subscription_product', '=', True), ('revenue_recognition_method', '=', 'deferred')]</field>
        <field name="context">{
            'search_default_filter_deferred_recognition': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No products with deferred revenue found!
            </p>
            <p>
                This view shows subscription products that use deferred revenue recognition.
                Monitor deferred revenue balances and processing status.
            </p>
        </field>
    </record>

    <!-- Products Needing Review Action -->
    <record id="action_products_needing_review" model="ir.actions.act_window">
        <field name="name">Products Needing Recognition Review</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('is_subscription_product', '=', True), ('use_ams_accounting', '=', True)]</field>
        <field name="context">{
            'search_default_filter_auto_recognition': 1,
            'search_default_group_by_recognition_method': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Review product revenue recognition settings!
            </p>
            <p>
                Use this view to review and configure revenue recognition for subscription products.
            </p>
        </field>
    </record>

    <!-- =================================================================== -->
    <!-- MENU ITEMS - Now reference the actions defined above                -->
    <!-- =================================================================== -->
    
    <!-- Revenue Recognition Schedules -->
    <menuitem id="menu_ams_revenue_schedules"
              name="Revenue Schedules"
              parent="ams_base_accounting.menu_ams_accounting"
              action="action_ams_revenue_schedule"
              sequence="30"/>

    <!-- Revenue Recognition Entries -->
    <menuitem id="menu_ams_revenue_recognition_entries"
              name="Recognition Entries"
              parent="ams_base_accounting.menu_ams_accounting"
              action="action_ams_revenue_recognition"
              sequence="31"/>

    <!-- Due Revenue Recognition -->
    <menuitem id="menu_ams_revenue_recognition_due"
              name="Recognition Due"
              parent="ams_base_accounting.menu_ams_accounting"
              action="action_ams_revenue_recognition_due"
              sequence="32"/>

    <!-- Revenue Recognition Dashboard -->
    <menuitem id="menu_ams_revenue_recognition_dashboard"
              name="Recognition Dashboard"
              parent="ams_base_accounting.menu_ams_accounting"
              action="action_ams_revenue_recognition_dashboard"
              sequence="33"/>

    <!-- Reporting Menu Items -->
    <menuitem id="menu_ams_revenue_reporting"
              name="Revenue Reporting"
              parent="ams_base_accounting.menu_ams_accounting"
              sequence="40"/>

    <!-- Products with Revenue Recognition -->
    <menuitem id="menu_ams_products_revenue_recognition"
              name="Products - Revenue Recognition"
              parent="menu_ams_revenue_reporting"
              action="action_product_revenue_recognition"
              sequence="10"/>

    <!-- Subscriptions with Revenue Recognition -->
    <menuitem id="menu_ams_subscriptions_revenue_recognition"
              name="Subscriptions - Revenue Recognition"
              parent="menu_ams_revenue_reporting"
              action="action_subscription_revenue_recognition_dashboard"
              sequence="20"/>

    <!-- Invoices with Revenue Recognition (NOW WORKS - action defined above) -->
    <menuitem id="menu_ams_invoices_revenue_recognition"
              name="Invoices - Revenue Recognition"
              parent="menu_ams_revenue_reporting"
              action="action_invoice_revenue_recognition"
              sequence="30"/>

    <!-- Invoice Lines Needing Recognition (NOW WORKS - action defined above) -->
    <menuitem id="menu_ams_invoice_lines_need_recognition"
              name="Lines Needing Recognition"
              parent="menu_ams_revenue_reporting"
              action="action_invoice_lines_need_revenue_recognition"
              sequence="40"/>

    <!-- Products with Deferred Revenue (NOW WORKS - action defined above) -->
    <menuitem id="menu_ams_products_with_deferred_revenue"
              name="Products with Deferred Revenue"
              parent="menu_ams_revenue_reporting"
              action="action_products_with_deferred_revenue"
              sequence="50"/>

    <!-- Add to AMS Members section for easy access to subscription revenue -->
    <menuitem id="menu_ams_subscription_revenue_schedules"
              name="Revenue Recognition"
              parent="ams_subscriptions.menu_ams_members"
              action="action_subscription_revenue_recognition_dashboard"
              sequence="40"/>

</odoo>