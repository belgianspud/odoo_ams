<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Enhanced Partner Tree View -->
        <record id="view_res_partner_tree_ams" model="ir.ui.view">
            <field name="name">res.partner.tree.ams</field>
            <field name="model">res.partner</field>
            <field name="arch" type="xml">
                <tree string="Contacts">
                    <field name="display_name"/>
                    <field name="member_id"/>
                    <field name="is_ams_member" widget="boolean_toggle"/>
                    <field name="member_type_id"/>
                    <field name="professional_category_id" 
                           attrs="{'invisible': [('industry_fields_visible', '=', False)]}"/>
                    <field name="phone"/>
                    <field name="email"/>
                    <field name="city"/>
                    <field name="country_id"/>
                    <field name="member_status"/>
                    <field name="engagement_level"/>
                    <field name="is_company" invisible="1"/>
                    <field name="industry_fields_visible" invisible="1"/>
                </tree>
            </field>
        </record>

        <!-- Enhanced Partner Form View -->
        <record id="view_res_partner_form_ams" model="ir.ui.view">
            <field name="name">res.partner.form.ams</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                
                <!-- Add AMS fields after the name -->
                <xpath expr="//field[@name='category_id']" position="after">
                    <field name="member_id" readonly="1" attrs="{'invisible': [('is_ams_member', '=', False)]}"/>
                    <field name="is_ams_member"/>
                    <field name="member_type_id" attrs="{'invisible': [('is_ams_member', '=', False)]}"/>
                    <field name="member_status" attrs="{'invisible': [('is_ams_member', '=', False)]}"/>
                </xpath>

                <!-- Add engagement info -->
                <xpath expr="//field[@name='user_ids']" position="after">
                    <field name="engagement_score" attrs="{'invisible': [('is_ams_member', '=', False)]}"/>
                    <field name="engagement_level" attrs="{'invisible': [('is_ams_member', '=', False)]}"/>
                    <field name="last_engagement_update" readonly="1" attrs="{'invisible': [('is_ams_member', '=', False)]}"/>
                </xpath>

                <!-- Add notebook pages for AMS data -->
                <xpath expr="//notebook" position="inside">
                    
                    <!-- Professional Information Tab -->
                    <page string="Professional Info" name="professional_info" 
                          attrs="{'invisible': ['|', ('is_company', '=', True), ('industry_fields_visible', '=', False)]}">
                        <group>
                            <group name="professional_basic" string="Professional Details">
                                <field name="professional_category_id"/>
                                <field name="job_title"/>
                                <field name="primary_license_number"/>
                                <field name="secondary_license_number"/>
                            </group>
                            <group name="professional_settings" string="Work Environment">
                                <field name="employment_setting_id"/>
                                <field name="employment_setting_other" 
                                       attrs="{'invisible': [('employment_setting_id', '!=', False)]}"/>
                            </group>
                        </group>
                        
                        <group name="credentials_group" string="Credentials & Designations">
                            <field name="designation_ids" widget="many2many_tags"/>
                            <field name="designation_other"/>
                        </group>
                        
                        <group name="practice_areas_group" string="Areas of Practice/Expertise">
                            <field name="practice_area_ids" widget="many2many_tags"/>
                            <field name="practice_area_other"/>
                            <field name="patient_type_ids" widget="many2many_tags"/>
                        </group>
                    </page>

                    <!-- Personal Information Tab -->
                    <page string="Personal Info" name="personal_info" 
                          attrs="{'invisible': [('is_company', '=', True)]}">
                        <group>
                            <group name="personal_basic" string="Personal Details">
                                <field name="pronouns_id"/>
                                <field name="primary_language_id"/>
                                <field name="secondary_language_id"/>
                                <field name="preferred_communication_id"/>
                            </group>
                            <group name="demographics" string="Demographics">
                                <field name="gender_identity_id"/>
                                <field name="gender_identity_other" 
                                       attrs="{'invisible': [('gender_identity_id', '!=', False)]}"/>
                                <field name="sexual_orientation_id"/>
                                <field name="ethnic_culture_id"/>
                                <field name="ethnic_culture_other" 
                                       attrs="{'invisible': [('ethnic_culture_id', '!=', False)]}"/>
                            </group>
                        </group>
                        
                        <group name="emergency_contact" string="Emergency Contact">
                            <field name="emergency_contact_name"/>
                            <field name="emergency_contact_phone"/>
                            <field name="emergency_contact_relationship"/>
                        </group>
                    </page>

                    <!-- Additional Addresses Tab -->
                    <page string="Additional Addresses" name="additional_addresses"
                          attrs="{'invisible': [('address_type_ids', '=', [])]}">
                        <field name="address_type_ids">
                            <tree editable="bottom">
                                <field name="address_type_id"/>
                                <field name="name"/>
                                <field name="street"/>
                                <field name="city"/>
                                <field name="state_id"/>
                                <field name="country_id"/>
                                <field name="is_primary" widget="boolean_toggle"/>
                                <field name="is_billing" widget="boolean_toggle"/>
                                <field name="is_shipping" widget="boolean_toggle"/>
                                <field name="active" widget="boolean_toggle"/>
                            </tree>
                        </field>
                    </page>

                    <!-- Relationships Tab -->
                    <page string="Relationships" name="relationships"
                          attrs="{'invisible': [('relationship_ids', '=', [])]}">
                        <group>
                            <group name="outgoing_relationships" string="Relationships">
                                <field name="relationship_ids" nolabel="1">
                                    <tree>
                                        <field name="relationship_type_id"/>
                                        <field name="related_partner_id"/>
                                        <field name="role_title"/>
                                        <field name="start_date"/>
                                        <field name="end_date"/>
                                        <field name="is_current" widget="boolean_toggle"/>
                                    </tree>
                                </field>
                            </group>
                            <group name="incoming_relationships" string="Reverse Relationships">
                                <field name="reverse_relationship_ids" nolabel="1">
                                    <tree>
                                        <field name="relationship_type_id"/>
                                        <field name="partner_id"/>
                                        <field name="role_title"/>
                                        <field name="start_date"/>
                                        <field name="end_date"/>
                                        <field name="is_current" widget="boolean_toggle"/>
                                    </tree>
                                </field>
                            </group>
                        </group>
                    </page>

                    <!-- Membership Information Tab -->
                    <page string="Membership" name="membership_info" 
                          attrs="{'invisible': [('is_ams_member', '=', False)]}">
                        <group>
                            <group name="membership_dates" string="Membership Dates">
                                <field name="membership_join_date" readonly="1"/>
                                <field name="membership_original_join_date" readonly="1"/>
                                <field name="membership_paid_through_date" readonly="1"/>
                                <field name="membership_renewal_date" readonly="1"/>
                            </group>
                            <group name="membership_tracking" string="Tracking">
                                <field name="contact_source_id"/>
                                <field name="display_name_with_credentials" readonly="1"/>
                            </group>
                        </group>
                    </page>
                </xpath>

                <!-- Add computed fields as invisible -->
                <xpath expr="//field[@name='is_company']" position="after">
                    <field name="industry_fields_visible" invisible="1"/>
                </xpath>

            </field>
        </record>

        <!-- Partner Kanban View -->
        <record id="view_res_partner_kanban_ams" model="ir.ui.view">
            <field name="name">res.partner.kanban.ams</field>
            <field name="model">res.partner</field>
            <field name="arch" type="xml">
                <kanban>
                    <field name="id"/>
                    <field name="name"/>
                    <field name="email"/>
                    <field name="phone"/>
                    <field name="member_id"/>
                    <field name="is_ams_member"/>
                    <field name="member_type_id"/>
                    <field name="professional_category_id"/>
                    <field name="engagement_level"/>
                    <field name="city"/>
                    <field name="country_id"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_image">
                                    <img alt="Contact" t-att-src="kanban_image('res.partner', 'image_128', record.id.raw_value)"/>
                                </div>
                                <div class="oe_kanban_details">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                    <ul>
                                        <li t-if="record.member_id.value">
                                            Member ID: <field name="member_id"/>
                                        </li>
                                        <li t-if="record.professional_category_id.value">
                                            <field name="professional_category_id"/>
                                        </li>
                                        <li t-if="record.email.value">
                                            <field name="email"/>
                                        </li>
                                        <li t-if="record.phone.value">
                                            <field name="phone"/>
                                        </li>
                                        <li t-if="record.city.value">
                                            <field name="city"/> <field name="country_id"/>
                                        </li>
                                    </ul>
                                    <div class="o_kanban_tags_section">
                                        <span t-if="record.is_ams_member.value" class="badge badge-success">Member</span>
                                        <span t-if="record.engagement_level.value" 
                                              t-att-class="'badge badge-' + (record.engagement_level.value == 'diamond' ? 'primary' : 'secondary')">
                                            <t t-esc="record.engagement_level.value"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Enhanced Partner Search View -->
        <record id="view_res_partner_filter_ams" model="ir.ui.view">
            <field name="name">res.partner.filter.ams</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
                
                <!-- Add AMS search fields -->
                <xpath expr="//field[@name='name']" position="after">
                    <field name="member_id" string="Member ID"/>
                    <field name="professional_category_id" string="Professional Category"/>
                    <field name="member_type_id" string="Member Type"/>
                    <field name="designation_ids" string="Credentials"/>
                </xpath>

                <!-- Add AMS filters -->
                <xpath expr="//filter[@name='customer']" position="after">
                    <filter string="AMS Members" name="ams_members" domain="[('is_ams_member', '=', True)]"/>
                    <filter string="Active Members" name="active_members" 
                            domain="[('is_ams_member', '=', True), ('member_status', '=', 'active')]"/>
                    <filter string="Inactive Members" name="inactive_members" 
                            domain="[('is_ams_member', '=', True), ('member_status', '!=', 'active')]"/>
                    <separator/>
                    <filter string="Standard Members" name="standard_members" 
                            domain="[('member_type_id.code', '=', 'standard')]"/>
                    <filter string="Premium Members" name="premium_members" 
                            domain="[('member_type_id.code', '=', 'premium')]"/>
                    <separator/>
                </xpath>

                <!-- Add AMS grouping -->
                <xpath expr="//group[@expand='0']" position="inside">
                    <filter string="Member Type" name="group_member_type" context="{'group_by': 'member_type_id'}"/>
                    <filter string="Professional Category" name="group_professional" context="{'group_by': 'professional_category_id'}"/>
                    <filter string="Member Status" name="group_member_status" context="{'group_by': 'member_status'}"/>
                    <filter string="Engagement Level" name="group_engagement" context="{'group_by': 'engagement_level'}"/>
                </xpath>
            </field>
        </record>

        <!-- All Contacts Action -->
        <record id="action_ams_contacts" model="ir.actions.act_window">
            <field name="name">All Contacts</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="view_id" ref="view_res_partner_kanban_ams"/>
            <field name="search_view_id" ref="view_res_partner_filter_ams"/>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first contact
                </p>
                <p>
                    Manage all contacts including members, prospects, and organizations.
                </p>
            </field>
        </record>

        <!-- Members Only Action -->
        <record id="action_ams_members_only" model="ir.actions.act_window">
            <field name="name">Members</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="view_id" ref="view_res_partner_kanban_ams"/>
            <field name="search_view_id" ref="view_res_partner_filter_ams"/>
            <field name="domain">[('is_ams_member', '=', True)]</field>
            <field name="context">{'search_default_active_members': 1, 'default_is_ams_member': True}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No members found
                </p>
                <p>
                    Create your first member or convert existing contacts to members.
                </p>
            </field>
        </record>

        <!-- Organizations Action -->
        <record id="action_ams_organizations" model="ir.actions.act_window">
            <field name="name">Organizations</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="view_id" ref="view_res_partner_kanban_ams"/>
            <field name="search_view_id" ref="view_res_partner_filter_ams"/>
            <field name="domain">[('is_company', '=', True)]</field>
            <field name="context">{'default_is_company': True}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first organization
                </p>
                <p>
                    Manage companies, hospitals, institutions and other organizations.
                </p>
            </field>
        </record>

    </data>
</odoo>