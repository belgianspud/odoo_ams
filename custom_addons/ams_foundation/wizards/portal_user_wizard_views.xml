<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Portal User Wizard Form View -->
        <record id="view_portal_user_wizard_form" model="ir.ui.view">
            <field name="name">ams.portal.user.wizard.form</field>
            <field name="model">ams.portal.user.wizard</field>
            <field name="arch" type="xml">
                <form string="Create Portal Users for Members">
                    <sheet>
                        <div class="oe_title">
                            <h1>Create Portal Users</h1>
                            <p>This wizard will create portal users for association members based on your criteria.</p>
                        </div>

                        <group>
                            <group string="Member Selection Criteria">
                                <field name="member_type_ids" widget="many2many_tags"/>
                                <field name="member_status"/>
                                <field name="email_required"/>
                                <field name="include_existing_users"/>
                            </group>
                            <group string="Date Filters">
                                <field name="membership_start_after"/>
                                <field name="membership_start_before"/>
                            </group>
                        </group>

                        <group>
                            <group string="Processing Options">
                                <field name="send_invitation_emails"/>
                                <field name="reset_existing_passwords" 
                                       invisible="not include_existing_users"/>
                                <field name="update_user_groups" 
                                       invisible="not include_existing_users"/>
                            </group>
                            <group string="Preview">
                                <field name="eligible_member_count" readonly="True"/>
                                <button name="action_preview_members" 
                                        string="Preview Members" 
                                        type="object" 
                                        class="btn-secondary"
                                        invisible="not eligible_member_count"/>
                            </group>
                        </group>

                        <div class="alert alert-info" role="alert" invisible="not eligible_member_count">
                            <strong><field name="eligible_member_count"/> members</strong> match your criteria and will be processed.
                        </div>

                        <div class="alert alert-warning" role="alert" invisible="eligible_member_count">
                            <strong>No members found</strong> that match your current criteria. Please adjust the filters above.
                        </div>

                    </sheet>
                    <footer>
                        <button name="action_create_portal_users" 
                                string="Create Portal Users" 
                                type="object" 
                                class="btn-primary"
                                invisible="not eligible_member_count"/>
                        <button string="Cancel" special="cancel" class="btn-secondary"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Portal User Wizard Results Form View -->
        <record id="view_portal_user_wizard_results" model="ir.ui.view">
            <field name="name">ams.portal.user.wizard.results.form</field>
            <field name="model">ams.portal.user.wizard</field>
            <field name="arch" type="xml">
                <form string="Portal User Creation Results">
                    <sheet>
                        <div class="oe_title">
                            <h1>Processing Complete</h1>
                            <p>Portal user creation process has completed. See results below.</p>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="card bg-success text-white mb-3">
                                    <div class="card-body text-center">
                                        <h3 class="card-title">
                                            <field name="created_user_count" readonly="True"/>
                                        </h3>
                                        <p class="card-text">Users Created</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-info text-white mb-3">
                                    <div class="card-body text-center">
                                        <h3 class="card-title">
                                            <field name="updated_user_count" readonly="True"/>
                                        </h3>
                                        <p class="card-text">Users Updated</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-danger text-white mb-3" invisible="not error_count">
                                    <div class="card-body text-center">
                                        <h3 class="card-title">
                                            <field name="error_count" readonly="True"/>
                                        </h3>
                                        <p class="card-text">Errors</p>
                                    </div>
                                </div>
                                <div class="card bg-secondary text-white mb-3" invisible="error_count">
                                    <div class="card-body text-center">
                                        <h3 class="card-title">0</h3>
                                        <p class="card-text">Errors</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <group string="Processing Log">
                            <field name="processing_log" readonly="True" widget="text" 
                                   options="{'resizable': True}" nolabel="1"/>
                        </group>

                    </sheet>
                    <footer>
                        <button name="action_download_log" 
                                string="Download Log" 
                                type="object" 
                                class="btn-secondary"
                                invisible="not processing_log"/>
                        <button name="action_close" 
                                string="Close" 
                                type="object" 
                                class="btn-primary"/>
                    </footer>
                </form>
            </field>
        </record>

        <!-- Portal User Preview List View -->
        <record id="view_portal_user_preview_list" model="ir.ui.view">
            <field name="name">res.partner.portal.preview.list</field>
            <field name="model">res.partner</field>
            <field name="arch" type="xml">
                <list string="Portal User Preview" create="false" edit="false" delete="false">
                    <field name="name"/>
                    <field name="member_number"/>
                    <field name="member_type_id"/>
                    <field name="member_status"/>
                    <field name="email"/>
                    <field name="membership_start_date"/>
                    <field name="portal_user_id"/>
                    <field name="portal_user_created"/>
                </list>
            </field>
        </record>

        <!-- Portal User Wizard Action -->
        <record id="action_portal_user_wizard" model="ir.actions.act_window">
            <field name="name">Create Portal Users</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">ams.portal.user.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create portal users for your members
                </p>
                <p>
                    This wizard helps you create portal access for your association members,
                    allowing them to log in and access member-only features through the website.
                </p>
            </field>
        </record>

    </data>
</odoo>